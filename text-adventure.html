<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>æ–‡å­—å†’éšª - ç¶²é å°éŠæˆ²</title>
    <meta name="game-id" content="text-adventure" />
    <meta name="game-name" content="æ–‡å­—å†’éšª" />
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="styles.css" />
    <style>
      .game-container {
        position: relative;
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 20px;
      }

      .text-adventure-container {
        width: 100%;
        max-width: 800px;
        margin: 0 auto;
        background-color: #fff;
        border-radius: 8px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        overflow: hidden;
      }

      .story-header {
        background-color: var(--primary-color);
        color: white;
        padding: 15px 20px;
        display: flex;
        align-items: center;
        justify-content: space-between;
      }

      .story-title {
        margin: 0;
        font-size: 1.5rem;
      }

      .story-stats {
        display: flex;
        gap: 20px;
      }

      .stat-item {
        display: flex;
        align-items: center;
        gap: 5px;
      }

      .stat-icon {
        font-size: 1.2rem;
      }

      .story-display {
        padding: 20px;
        min-height: 300px;
        max-height: 400px;
        overflow-y: auto;
        border-bottom: 1px solid #eee;
        line-height: 1.6;
      }

      .story-paragraph {
        margin-bottom: 15px;
      }

      .story-image {
        width: 100%;
        max-height: 200px;
        object-fit: cover;
        border-radius: 5px;
        margin: 10px 0;
      }

      .choice-container {
        padding: 20px;
      }

      .choice-title {
        font-weight: bold;
        margin-bottom: 10px;
      }

      .choice-list {
        display: flex;
        flex-direction: column;
        gap: 10px;
      }

      .choice-btn {
        background-color: #f5f5f5;
        border: none;
        border-radius: 5px;
        padding: 12px 15px;
        text-align: left;
        cursor: pointer;
        transition: all 0.2s;
        font-size: 16px;
      }

      .choice-btn:hover {
        background-color: #e0e0e0;
        transform: translateY(-2px);
      }

      .inventory-btn {
        background-color: var(--info-color);
        color: white;
        border: none;
        border-radius: 5px;
        padding: 10px 15px;
        cursor: pointer;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        gap: 5px;
      }

      .inventory-btn:hover {
        background-color: var(--info-hover);
      }

      .game-controls {
        display: flex;
        justify-content: center;
        gap: 15px;
        margin-top: 20px;
      }

      .control-btn {
        background-color: var(--primary-color);
        color: white;
        border: none;
        border-radius: 5px;
        padding: 10px 20px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s;
      }

      .control-btn:hover {
        background-color: var(--primary-hover);
      }

      .story-selection {
        margin-bottom: 20px;
      }

      .story-buttons {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-top: 10px;
      }

      .story-select-btn {
        background-color: #f0f0f0;
        border: none;
        border-radius: 5px;
        padding: 10px 15px;
        cursor: pointer;
        transition: all 0.2s;
      }

      .story-select-btn:hover {
        background-color: #e0e0e0;
      }

      .story-select-btn.active {
        background-color: var(--primary-color);
        color: white;
      }

      /* æç¤ºæ–‡å­—æ·¡å…¥æ•ˆæœ */
      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }

      .fade-in {
        animation: fadeIn 0.5s forwards;
      }

      .story-paragraph {
        opacity: 0;
        animation: fadeIn 0.5s forwards;
      }

      .story-paragraph:nth-child(2) {
        animation-delay: 0.3s;
      }

      .story-paragraph:nth-child(3) {
        animation-delay: 0.6s;
      }

      /* å¥åº·å’Œé«”åŠ›æ¢ */
      .status-bar {
        width: 100%;
        height: 12px;
        background-color: #e0e0e0;
        border-radius: 10px;
        overflow: hidden;
      }

      .status-bar-fill {
        height: 100%;
        transition: width 0.3s;
      }

      .health-bar .status-bar-fill {
        background-color: #f44336;
      }

      .energy-bar .status-bar-fill {
        background-color: #4caf50;
      }

      .inventory-modal .modal-body {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 10px;
      }

      .inventory-item {
        background-color: #f5f5f5;
        border-radius: 5px;
        padding: 10px;
        text-align: center;
        cursor: pointer;
      }

      .inventory-item:hover {
        background-color: #e0e0e0;
      }

      .inventory-item.active {
        background-color: #bbdefb;
      }

      .item-icon {
        font-size: 24px;
        margin-bottom: 5px;
      }

      @media (max-width: 768px) {
        .story-stats {
          display: grid;
          grid-template-columns: 1fr 1fr;
          gap: 10px;
        }
      }

      @media (max-width: 480px) {
        .story-header {
          flex-direction: column;
          align-items: flex-start;
          gap: 10px;
        }

        .story-stats {
          width: 100%;
        }

        .inventory-modal .modal-body {
          grid-template-columns: repeat(2, 1fr);
        }
      }
    </style>
  </head>
  <body>
    <header class="site-header">
      <div class="container">
        <a href="index.html" class="site-title">ç¶²é å°éŠæˆ²</a>
        <nav class="site-nav">
          <ul>
            <li><a href="index.html#games">éŠæˆ²åˆ—è¡¨</a></li>
            <li><a href="index.html#about">é—œæ–¼</a></li>
          </ul>
        </nav>
      </div>
    </header>

    <main class="container">
      <div class="game-header">
        <h1>æ–‡å­—å†’éšª</h1>
        <div class="game-toolbar">
          <button id="helpButton" class="tool-button">éŠæˆ²èªªæ˜</button>
          <button id="pauseButton" class="tool-button">æš«åœ</button>
          <button id="restartButton" class="tool-button">é‡æ–°é–‹å§‹</button>
          <button id="homeButton" class="tool-button">è¿”å›é¦–é </button>
        </div>
      </div>

      <div class="game-container">
        <div class="story-selection">
          <h3>é¸æ“‡å†’éšªæ•…äº‹</h3>
          <div class="story-buttons">
            <button class="story-select-btn active" data-story="forest">
              ç¥ç§˜æ£®æ—
            </button>
            <button class="story-select-btn" data-story="castle">
              å¤å ¡æ¢éšª
            </button>
            <button class="story-select-btn" data-story="space">
              æ˜Ÿéš›æ—…ç¨‹
            </button>
          </div>
        </div>

        <div class="text-adventure-container">
          <div class="story-header">
            <h2 class="story-title" id="storyTitle">ç¥ç§˜æ£®æ—</h2>
            <div class="story-stats">
              <div class="stat-item">
                <span class="stat-icon">â¤ï¸</span>
                <div class="status-bar health-bar">
                  <div
                    class="status-bar-fill"
                    id="healthBar"
                    style="width: 100%"
                  ></div>
                </div>
              </div>
              <div class="stat-item">
                <span class="stat-icon">âš¡</span>
                <div class="status-bar energy-bar">
                  <div
                    class="status-bar-fill"
                    id="energyBar"
                    style="width: 100%"
                  ></div>
                </div>
              </div>
              <button class="inventory-btn" id="inventoryBtn">
                <span class="stat-icon">ğŸ’</span>
                <span>ç‰©å“</span>
              </button>
            </div>
          </div>

          <div class="story-display" id="storyDisplay">
            <div class="story-paragraph">
              æ­¡è¿ä¾†åˆ°æ–‡å­—å†’éšªéŠæˆ²ï¼é¸æ“‡ä¸€å€‹æ•…äº‹é–‹å§‹ä½ çš„æ—…ç¨‹ã€‚
            </div>
          </div>

          <div class="choice-container">
            <div class="choice-title">é¸æ“‡ä½ çš„ä¸‹ä¸€æ­¥ï¼š</div>
            <div class="choice-list" id="choiceList">
              <!-- é¸é …æœƒåœ¨é€™è£¡å‹•æ…‹ç”Ÿæˆ -->
            </div>
          </div>
        </div>

        <div class="game-controls">
          <button id="resetBtn" class="control-btn">é‡ç½®æ•…äº‹</button>
        </div>
      </div>

      <div id="gamePaused" class="game-paused">æš«åœä¸­</div>
    </main>

    <script src="gameUtils.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // åˆå§‹åŒ–éŠæˆ²å·¥å…·
        const helpModal = new GameUtils.Modal(
          "helpModal",
          "éŠæˆ²èªªæ˜",
          `
          <h3>æ–‡å­—å†’éšªéŠæˆ²èªªæ˜</h3>
          <p>æ–‡å­—å†’éšªæ˜¯ä¸€ç¨®äº’å‹•æ€§æ•˜äº‹éŠæˆ²ï¼Œä½ å°‡é€éæ–‡å­—æè¿°å’Œé¸æ“‡é€²è¡Œå†’éšªã€‚</p>
          <h4>éŠæˆ²ç©æ³•ï¼š</h4>
          <ul>
            <li>é–±è®€æ•…äº‹æè¿°ï¼Œç†è§£ç•¶å‰æƒ…å¢ƒ</li>
            <li>åœ¨æä¾›çš„é¸é …ä¸­é¸æ“‡ä½ æƒ³æ¡å–çš„è¡Œå‹•</li>
            <li>æ¯å€‹é¸æ“‡éƒ½æœƒå½±éŸ¿æ•…äº‹çš„ç™¼å±•æ–¹å‘</li>
            <li>ç®¡ç†ä½ çš„å¥åº·å’Œé«”åŠ›ï¼Œç¢ºä¿ä¸æœƒåœ¨å†’éšªä¸­æ­»äº¡</li>
            <li>æ”¶é›†ä¸¦ä½¿ç”¨ç‰©å“ä¾†å¹«åŠ©ä½ å®Œæˆå†’éšª</li>
          </ul>
          <h4>æ•…äº‹é¸æ“‡ï¼š</h4>
          <ul>
            <li><strong>ç¥ç§˜æ£®æ—</strong>ï¼šæ¢ç´¢å……æ»¿é­”æ³•çš„æ£®æ—ï¼Œå°‹æ‰¾å¤±è½çš„å¯¶è—</li>
            <li><strong>å¤å ¡æ¢éšª</strong>ï¼šæ¢ç´¢ä¸€åº§å¤è€çš„åŸå ¡ï¼Œæ­é–‹å…¶ä¸­çš„ç§˜å¯†</li>
            <li><strong>æ˜Ÿéš›æ—…ç¨‹</strong>ï¼šåœ¨æµ©ç€šçš„å®‡å®™ä¸­é€²è¡Œå†’éšªï¼Œé¢å°æœªçŸ¥çš„å±éšª</li>
          </ul>
          <h4>ç‹€æ…‹æŒ‡æ¨™ï¼š</h4>
          <ul>
            <li>å¥åº·å€¼ï¼ˆâ¤ï¸ï¼‰ï¼šä»£è¡¨ä½ çš„ç”Ÿå‘½å€¼ï¼Œé™è‡³é›¶å‰‡éŠæˆ²çµæŸ</li>
            <li>é«”åŠ›å€¼ï¼ˆâš¡ï¼‰ï¼šé€²è¡ŒæŸäº›æ´»å‹•éœ€è¦æ¶ˆè€—é«”åŠ›ï¼Œéœ€è¦ä¼‘æ¯ä¾†æ¢å¾©</li>
            <li>ç‰©å“æ¬„ï¼ˆğŸ’ï¼‰ï¼šæ”¶é›†åˆ°çš„ç‰©å“ï¼Œå¯ä»¥åœ¨é©ç•¶çš„æ™‚å€™ä½¿ç”¨</li>
          </ul>
        `
        );

        // å‰µå»ºç‰©å“æ¬„æ¨¡æ…‹æ¡†
        const inventoryModal = new GameUtils.Modal(
          "inventoryModal",
          "ç‰©å“æ¬„",
          `<div class="inventory-items-container"></div>`
        );

        const gameController = new GameUtils.GameController();
        const scoreManager = new GameUtils.ScoreManager(
          "textAdventureScore",
          0
        );

        // DOM å…ƒç´ 
        const storyTitle = document.getElementById("storyTitle");
        const storyDisplay = document.getElementById("storyDisplay");
        const choiceList = document.getElementById("choiceList");
        const healthBar = document.getElementById("healthBar");
        const energyBar = document.getElementById("energyBar");
        const inventoryBtn = document.getElementById("inventoryBtn");
        const resetBtn = document.getElementById("resetBtn");
        const storyButtons = document.querySelectorAll(".story-select-btn");

        // éŠæˆ²è®Šæ•¸
        let currentStory = "forest";
        let currentNode = "start";
        let health = 100;
        let energy = 100;
        let inventory = [];
        let gameActive = false;

        // æ•…äº‹æ•¸æ“š
        const stories = {
          forest: {
            title: "ç¥ç§˜æ£®æ—",
            nodes: {
              start: {
                text: [
                  "ä½ ç«™åœ¨ä¸€ç‰‡ç¥ç§˜æ£®æ—çš„é‚Šç·£ï¼Œå‚³èªªä¸­é€™è£¡æœ‰ä¸€å€‹å¤±è½å·²ä¹…çš„å¯¶è—ã€‚æ£®æ—ä¸­çš„æ¨¹æœ¨é«˜å¤§ä¸”å¯†é›†ï¼Œé™½å…‰åªèƒ½é€éæ¨¹è‘‰é–“çš„ç¸«éš™ç‘è½ã€‚",
                  "ä½ èƒŒåŒ…è£¡è£è‘—å°‘é‡çš„é£Ÿç‰©ã€ä¸€æŠŠå°åˆ€å’Œä¸€å€‹æ°´å£ºã€‚å‰æ–¹æœ‰å¹¾æ¢å°å¾‘é€šå‘æ£®æ—æ·±è™•ã€‚",
                ],
                choices: [
                  {
                    text: "æ²¿è‘—æœ€å¯¬çš„å°å¾‘å‰é€²",
                    nextNode: "widePath",
                    effects: { energy: -5 },
                  },
                  {
                    text: "é¸æ“‡çœ‹èµ·ä¾†è¼ƒå°‘äººèµ°éçš„å°å¾‘",
                    nextNode: "narrowPath",
                    effects: { energy: -10 },
                  },
                  {
                    text: "å…ˆå››å‘¨æŸ¥çœ‹ä¸€ä¸‹ï¼Œå°‹æ‰¾å¯èƒ½çš„ç·šç´¢",
                    nextNode: "lookAround",
                    effects: { energy: -5 },
                  },
                ],
              },
              lookAround: {
                text: [
                  "ä½ æ±ºå®šå…ˆåœ¨æ£®æ—é‚Šç·£æ¢ç´¢ä¸€ç•ªã€‚åœ¨é™„è¿‘çš„ä¸€æ£µå¤§æ¨¹åº•ä¸‹ï¼Œä½ ç™¼ç¾äº†ä¸€å€‹æœ‰é»è¤ªè‰²çš„åœ°åœ–ï¼Œä¸Šé¢æ¨™è¨˜äº†ä¸€äº›åœ°é»ã€‚",
                  "æ­¤å¤–ï¼Œä½ é‚„æ³¨æ„åˆ°åœ°ä¸Šæœ‰ä¸€äº›å‹•ç‰©çš„è¶³è·¡ï¼Œä¼¼ä¹æ²¿è‘—æœ€çª„çš„å°å¾‘é€²å…¥äº†æ£®æ—ã€‚",
                ],
                choices: [
                  {
                    text: "æŸ¥çœ‹åœ°åœ–ï¼Œç„¶å¾Œæ²¿è‘—å¯¬çš„å°å¾‘å‰é€²",
                    nextNode: "widePath",
                    effects: { energy: -5, items: ["åœ°åœ–"] },
                  },
                  {
                    text: "æŸ¥çœ‹åœ°åœ–ï¼Œç„¶å¾Œæ²¿è‘—çª„çš„å°å¾‘å‰é€²",
                    nextNode: "narrowPath",
                    effects: { energy: -10, items: ["åœ°åœ–"] },
                  },
                  {
                    text: "è·Ÿéš¨å‹•ç‰©è¶³è·¡é€²å…¥æ£®æ—",
                    nextNode: "animalTrack",
                    effects: { energy: -15 },
                  },
                ],
              },
              widePath: {
                text: [
                  "ä½ é¸æ“‡äº†æœ€å¯¬çš„å°å¾‘ï¼Œé€™æ¢è·¯ä¼¼ä¹ç¶“å¸¸æœ‰äººèµ°éã€‚å‰é€²äº†ä¸€æ®µæ™‚é–“å¾Œï¼Œä½ ä¾†åˆ°ä¸€å€‹å°æºªæ—ã€‚",
                  "å°æºªæ¸…æ¾ˆè¦‹åº•ï¼Œæ°´æµç·©æ…¢ã€‚å°å²¸æœ‰ä¸€å€‹å°å±‹ï¼Œçœ‹èµ·ä¾†å·²ç¶“å»¢æ£„ä¸€æ®µæ™‚é–“äº†ã€‚",
                ],
                choices: [
                  {
                    text: "æ¸¡éå°æºªï¼ŒæŸ¥çœ‹å°å±‹",
                    nextNode: "cabin",
                    effects: { energy: -10, health: -5 },
                  },
                  {
                    text: "åœ¨å°æºªé‚Šä¼‘æ¯ä¸€ä¸‹",
                    nextNode: "streamRest",
                    effects: { energy: +20 },
                  },
                  {
                    text: "æ²¿è‘—å°æºªç¹¼çºŒå‰é€²",
                    nextNode: "streamPath",
                    effects: { energy: -10 },
                  },
                ],
              },
              narrowPath: {
                text: [
                  "ä½ é¸æ“‡äº†è¼ƒå°‘äººèµ°éçš„å°å¾‘ã€‚é€™æ¢è·¯å´å¶‡ä¸å¹³ï¼Œä½ å¿…é ˆå°å¿ƒç¿¼ç¿¼åœ°å‰é€²ã€‚",
                  "ç¶“éä¸€æ®µæ™‚é–“çš„è·‹æ¶‰ï¼Œä½ ç™¼ç¾è·¯é‚Šæœ‰ä¸€å€‹å¥‡æ€ªçš„çŸ³é ­ï¼Œä¸Šé¢åˆ»è‘—ä¸€äº›ä½ çœ‹ä¸æ‡‚çš„ç¬¦è™Ÿã€‚åŒæ™‚ï¼Œä½ æ³¨æ„åˆ°ä¸é è™•æœ‰ä¸€å€‹å±±æ´å…¥å£ã€‚",
                ],
                choices: [
                  {
                    text: "ä»”ç´°æŸ¥çœ‹çŸ³é ­ä¸Šçš„ç¬¦è™Ÿ",
                    nextNode: "strangeStone",
                    effects: { energy: -5 },
                  },
                  {
                    text: "æ¢ç´¢å±±æ´",
                    nextNode: "cave",
                    effects: { energy: -15, health: -10 },
                  },
                  {
                    text: "ç¹¼çºŒæ²¿è‘—å°å¾‘å‰é€²",
                    nextNode: "deepForest",
                    effects: { energy: -10 },
                  },
                ],
              },
              animalTrack: {
                text: [
                  "ä½ è¿½éš¨è‘—å‹•ç‰©çš„è¶³è·¡é€²å…¥æ£®æ—ã€‚é€™æ¢è·¯æ²’æœ‰æ˜é¡¯çš„å°å¾‘ï¼Œä½ å¿…é ˆç©¿éèŒ‚å¯†çš„çŒæœ¨å¢ã€‚",
                  "ç¶“éä¸€æ®µè‰±é›£çš„è·‹æ¶‰å¾Œï¼Œä½ ä¾†åˆ°ä¸€å€‹å°å‹çš„æ—é–“ç©ºåœ°ã€‚åœ¨ç©ºåœ°ä¸­å¤®ï¼Œæœ‰ä¸€éš»å—å‚·çš„é¹¿ã€‚å®ƒè­¦æƒ•åœ°çœ‹è‘—ä½ ï¼Œä½†ä¼¼ä¹å› ç‚ºå—å‚·è€Œç„¡æ³•é€ƒè·‘ã€‚",
                ],
                choices: [
                  {
                    text: "å˜—è©¦é è¿‘ä¸¦å¹«åŠ©é¹¿",
                    nextNode: "helpDeer",
                    effects: { energy: -10 },
                  },
                  {
                    text: "é›¢é–‹ç©ºåœ°ï¼Œç¹¼çºŒæ¢ç´¢æ£®æ—",
                    nextNode: "deepForest",
                    effects: { energy: -15 },
                  },
                  {
                    text: "åœ¨ç©ºåœ°ä¼‘æ¯ä¸€æœƒ",
                    nextNode: "clearingRest",
                    effects: { energy: +25 },
                  },
                ],
              },
              helpDeer: {
                text: [
                  "ä½ å°å¿ƒç¿¼ç¿¼åœ°é è¿‘å—å‚·çš„é¹¿ã€‚èµ·åˆï¼Œå®ƒè©¦åœ–ç«™èµ·ä¾†é€ƒè·‘ï¼Œä½†å¾ˆå¿«å°±æ”¾æ£„äº†ã€‚",
                  "ä½ ç™¼ç¾å®ƒçš„è…¿è¢«ä¸€å€‹æ•ç¸å¤¾å¤¾ä½äº†ã€‚ä½ æˆåŠŸåœ°è§£é–‹äº†æ•ç¸å¤¾ï¼Œä¸¦ç”¨èƒŒåŒ…è£¡çš„æ°´æ¸…æ´—äº†å®ƒçš„å‚·å£ã€‚",
                  "é¹¿çœ‹èµ·ä¾†æ„Ÿæ¿€åœ°çœ‹äº†ä½ ä¸€çœ¼ï¼Œç„¶å¾Œç«™èµ·ä¾†ï¼Œç·©ç·©åœ°èµ°å‘æ£®æ—çš„ä¸€å€‹æ–¹å‘ï¼Œä¸æ™‚å›é ­çœ‹ä½ ï¼Œä¼¼ä¹å¸Œæœ›ä½ è·Ÿéš¨å®ƒã€‚",
                ],
                choices: [
                  {
                    text: "è·Ÿéš¨é¹¿",
                    nextNode: "followDeer",
                    effects: { energy: -15, score: +20 },
                  },
                  {
                    text: "å‘é¹¿å‘Šåˆ¥ï¼Œç¹¼çºŒè‡ªå·±çš„æ¢ç´¢",
                    nextNode: "deepForest",
                    effects: { energy: -10 },
                  },
                ],
              },
              followDeer: {
                text: [
                  "ä½ æ±ºå®šè·Ÿéš¨é€™éš»é¹¿ã€‚å®ƒå¸¶é ˜ä½ ç©¿éæ£®æ—ä¸­ä¸€æ¢ä½ æ²’æœ‰æ³¨æ„åˆ°çš„å°å¾‘ã€‚",
                  "ç¶“éä¸€æ®µæ™‚é–“çš„è·‹æ¶‰ï¼Œä½ å€‘ä¾†åˆ°ä¸€å€‹ç¾éº—çš„ç€‘å¸ƒå‰ã€‚ç€‘å¸ƒæ—æœ‰ä¸€å€‹éš±è”½çš„æ´ç©´ï¼Œå…¥å£å¹¾ä¹è¢«è—¤è”“å’ŒçŒæœ¨å®Œå…¨è¦†è“‹ã€‚",
                  "é¹¿æŒ‡å¼•ä½ é€²å…¥æ´ç©´ï¼Œç„¶å¾Œæ¶ˆå¤±åœ¨æ£®æ—ä¸­ã€‚",
                ],
                choices: [
                  {
                    text: "é€²å…¥æ´ç©´",
                    nextNode: "secretCave",
                    effects: { energy: -10 },
                  },
                  {
                    text: "åœ¨ç€‘å¸ƒæ—ä¼‘æ¯",
                    nextNode: "waterfallRest",
                    effects: { energy: +30, health: +10 },
                  },
                ],
              },
              secretCave: {
                text: [
                  "ä½ é€²å…¥äº†æ´ç©´ï¼Œè£¡é¢å‡ºä¹æ„æ–™åœ°å¯¬æ•ã€‚é™½å…‰é€éé ‚éƒ¨çš„ä¸€å€‹å°é–‹å£ç…§å°„é€²ä¾†ï¼Œç…§äº®äº†æ•´å€‹ç©ºé–“ã€‚",
                  "åœ¨æ´ç©´çš„ä¸­å¤®ï¼Œæ”¾ç½®è‘—ä¸€å€‹å¤è€çš„çŸ³ç®±ã€‚ç®±å­ä¸Šé›•åˆ»è‘—èˆ‡ä½ ä¹‹å‰åœ¨çŸ³é ­ä¸Šçœ‹åˆ°çš„ç›¸ä¼¼çš„ç¬¦è™Ÿã€‚",
                ],
                choices: [
                  {
                    text: "å˜—è©¦æ‰“é–‹çŸ³ç®±",
                    nextNode: "openChest",
                    effects: { energy: -5 },
                  },
                  {
                    text: "ä»”ç´°ç ”ç©¶æ´ç©´ç‰†å£ä¸Šçš„ç¬¦è™Ÿ",
                    nextNode: "studySymbols",
                    effects: { energy: -10 },
                  },
                ],
              },
              openChest: {
                text: [
                  "ä½ å°å¿ƒç¿¼ç¿¼åœ°æ‰“é–‹çŸ³ç®±ã€‚è£¡é¢æ”¾è‘—ä¸€å€‹é–ƒé–ƒç™¼å…‰çš„é‡‘è‰²å¯¶çŸ³ï¼Œå®ƒä¼¼ä¹å…·æœ‰æŸç¨®ç¥ç§˜çš„åŠ›é‡ã€‚",
                  "ç•¶ä½ æ‹¿èµ·å¯¶çŸ³æ™‚ï¼Œå®ƒé–‹å§‹ç™¼å‡ºæº«æš–çš„å…‰èŠ’ï¼Œä½ æ„Ÿåˆ°ä¸€è‚¡èƒ½é‡æµå…¥ä½ çš„èº«é«”ã€‚",
                  "æ­å–œï¼ä½ æ‰¾åˆ°äº†å‚³èªªä¸­çš„æ£®æ—å¯¶è—ï¼é€™å€‹å¯¶çŸ³æ“šèªªå¯ä»¥å¯¦ç¾æŒæœ‰è€…çš„ä¸€å€‹å¿ƒé¡˜ã€‚",
                ],
                choices: [
                  {
                    text: "å¸¶è‘—å¯¶çŸ³é›¢é–‹æ£®æ—",
                    nextNode: "forestEnd",
                    effects: { energy: +100, health: +100, score: +500 },
                  },
                ],
              },
              forestEnd: {
                text: [
                  "å¸¶è‘—ç¥å¥‡çš„å¯¶çŸ³ï¼Œä½ æˆåŠŸåœ°èµ°å‡ºäº†ç¥ç§˜æ£®æ—ã€‚",
                  "åœ¨å›å®¶çš„è·¯ä¸Šï¼Œä½ æ€è€ƒè‘—å¦‚ä½•ä½¿ç”¨é€™å€‹èƒ½å¯¦ç¾é¡˜æœ›çš„å¯¶çŸ³ã€‚ä¸ç®¡ä½ åšå‡ºä»€éº¼æ±ºå®šï¼Œä½ çŸ¥é“ä½ çš„ç”Ÿæ´»å°‡ä¸å†ç›¸åŒã€‚",
                  "æ­å–œä½ å®Œæˆäº†ç¥ç§˜æ£®æ—çš„å†’éšªï¼",
                ],
                choices: [
                  {
                    text: "çµæŸå†’éšª",
                    nextNode: "end",
                    effects: { score: +500 },
                  },
                ],
                isEnd: true,
              },
              // å…¶ä»–ç¯€é» ...
              cabin: {
                text: [
                  "ä½ æ¶‰æ°´æ¸¡éå°æºªï¼Œä¾†åˆ°å°å²¸çš„å°å±‹å‰ã€‚å°å±‹çœ‹èµ·ä¾†å·²ç¶“å»¢æ£„å¤šå¹´ï¼Œæœ¨æè…çˆ›ï¼Œçª—æˆ¶ç ´æã€‚",
                  "ä½ æ¨é–‹å±å‘€ä½œéŸ¿çš„é–€ï¼Œèµ°é€²å±‹å…§ã€‚è£¡é¢ç©æ»¿äº†ç°å¡µï¼Œä½†ä½ é‚„æ˜¯èƒ½çœ‹åˆ°ä¸€äº›åŸºæœ¬çš„å®¶å…·ï¼šä¸€å¼µæ¡Œå­ã€ä¸€æŠŠæ¤…å­å’Œä¸€å€‹è€èˆŠçš„æ«¥æ«ƒã€‚",
                ],
                choices: [
                  {
                    text: "æœæŸ¥æ«¥æ«ƒ",
                    nextNode: "searchCabinet",
                    effects: { energy: -5 },
                  },
                  {
                    text: "æª¢æŸ¥æ¡Œå­",
                    nextNode: "examineTable",
                    effects: { energy: -5 },
                  },
                  {
                    text: "é›¢é–‹å°å±‹ï¼Œç¹¼çºŒæ¢ç´¢",
                    nextNode: "leaveCabin",
                    effects: { energy: -10 },
                  },
                ],
              },
              // æ·»åŠ æ›´å¤šç¯€é»...
            },
          },
          castle: {
            title: "å¤å ¡æ¢éšª",
            nodes: {
              start: {
                text: [
                  "ä½ ç«™åœ¨ä¸€åº§å·å³¨å¤è€çš„åŸå ¡å‰ã€‚åŸå ¡çš„çŸ³ç‰†ä¸Šçˆ¬æ»¿äº†å¸¸æ˜¥è—¤ï¼Œä¸»é–€ä¸Šæ–¹çš„çŸ³é›•å·²ç¶“è¢«æ™‚é–“é¢¨åŒ–å¾—é›£ä»¥è¾¨èªã€‚",
                  "å‚³èªªé€™åº§åŸå ¡æ›¾ç¶“å±¬æ–¼ä¸€ä½ç¥ç§˜çš„ä¼¯çˆµï¼Œä»–åœ¨åŸå ¡çš„æŸè™•è—äº†ç„¡åƒ¹çš„å¯¶è—ï¼Œä½†å¾ä¾†æ²’æœ‰äººèƒ½æ‰¾åˆ°å®ƒã€‚",
                ],
                choices: [
                  {
                    text: "å¾æ­£é–€é€²å…¥åŸå ¡",
                    nextNode: "frontDoor",
                    effects: { energy: -5 },
                  },
                  {
                    text: "å°‹æ‰¾å…¶ä»–å¯èƒ½çš„å…¥å£",
                    nextNode: "searchAlternative",
                    effects: { energy: -10 },
                  },
                  {
                    text: "å…ˆç¹åŸå ¡ä¸€å‘¨ï¼Œè§€å¯Ÿç’°å¢ƒ",
                    nextNode: "circleAround",
                    effects: { energy: -15 },
                  },
                ],
              },
              frontDoor: {
                text: [
                  "ä½ æ¨é–‹æ²‰é‡çš„åŸå ¡å¤§é–€ï¼Œç™¼å‡ºåˆºè€³çš„å±å˜è²ã€‚åŸå ¡å…§éƒ¨æ˜æš—ï¼Œåªæœ‰é€éé«˜è™•çª—æˆ¶çš„å¾®å…‰ç…§äº®é€™å€‹å·¨å¤§çš„å…¥å£å¤§å»³ã€‚",
                  "å¤§å»³ä¸­å¤®æœ‰ä¸€å€‹å®å‰çš„æ¨“æ¢¯ï¼Œé€šå‘ä¸Šå±¤ã€‚ä½ é‚„æ³¨æ„åˆ°å·¦å³å…©å´åˆ†åˆ¥æœ‰é€šå‘åŸå ¡å…¶ä»–å€åŸŸçš„èµ°å»Šã€‚",
                ],
                choices: [
                  {
                    text: "ä¸Šæ¨“æ¢¯",
                    nextNode: "upstairs",
                    effects: { energy: -10 },
                  },
                  {
                    text: "èµ°å·¦é‚Šçš„èµ°å»Š",
                    nextNode: "leftCorridor",
                    effects: { energy: -5 },
                  },
                  {
                    text: "èµ°å³é‚Šçš„èµ°å»Š",
                    nextNode: "rightCorridor",
                    effects: { energy: -5 },
                  },
                ],
              },
              // æ›´å¤šåŸå ¡æ¢éšªçš„ç¯€é»...
            },
          },
          space: {
            title: "æ˜Ÿéš›æ—…ç¨‹",
            nodes: {
              start: {
                text: [
                  "ä½ æ˜¯æ˜Ÿéš›æ¢ç´¢èˆ¹ã€Œæ›™å…‰è™Ÿã€çš„æŒ‡æ®å®˜ã€‚åœ¨ä¸€æ¬¡ä¾‹è¡Œä»»å‹™ä¸­ï¼Œä½ çš„é£›èˆ¹é‡åˆ°äº†ä¸€å€‹ç•°å¸¸çš„ç©ºé–“æ³¢å‹•ï¼Œè¢«å‚³é€åˆ°äº†æœªçŸ¥çš„æ˜Ÿç³»ã€‚",
                  "ä½ çš„é£›èˆ¹å—æï¼Œèƒ½æºä¾›æ‡‰æœ‰é™ã€‚èˆ¹ä¸Šçš„é›»è…¦é¡¯ç¤ºé™„è¿‘æœ‰ä¸‰å€‹å¯èƒ½æä¾›å¹«åŠ©çš„æ˜Ÿçƒã€‚",
                ],
                choices: [
                  {
                    text: "å‰å¾€è—è‰²æ˜Ÿçƒï¼Œå®ƒçœ‹èµ·ä¾†æœ‰é¡åœ°ç’°å¢ƒ",
                    nextNode: "bluePlanet",
                    effects: { energy: -15 },
                  },
                  {
                    text: "å‰å¾€ç´…è‰²æ˜Ÿçƒï¼Œæƒæé¡¯ç¤ºå®ƒå¯èƒ½æœ‰è±å¯Œçš„ç¤¦ç”¢è³‡æº",
                    nextNode: "redPlanet",
                    effects: { energy: -20 },
                  },
                  {
                    text: "å‰å¾€é»ƒè‰²æ˜Ÿçƒï¼Œå®ƒç™¼å‡ºå¥‡æ€ªçš„ä¿¡è™Ÿï¼Œå¯èƒ½æ˜¯æ™ºèƒ½ç”Ÿå‘½",
                    nextNode: "yellowPlanet",
                    effects: { energy: -25 },
                  },
                ],
              },
              // æ›´å¤šæ˜Ÿéš›æ—…ç¨‹çš„ç¯€é»...
            },
          },
        };

        // è™•ç†é¸æ“‡
        function handleChoice(choice) {
          if (!gameActive || gameController.paused) return;

          // æ‡‰ç”¨é¸æ“‡çš„æ•ˆæœ
          if (choice.effects) {
            if (choice.effects.health) {
              health = Math.max(
                0,
                Math.min(100, health + choice.effects.health)
              );
              updateHealthBar();
            }

            if (choice.effects.energy) {
              energy = Math.max(
                0,
                Math.min(100, energy + choice.effects.energy)
              );
              updateEnergyBar();
            }

            if (choice.effects.items) {
              choice.effects.items.forEach((item) => {
                if (!inventory.includes(item)) {
                  inventory.push(item);
                }
              });
            }

            if (choice.effects.score) {
              scoreManager.add(choice.effects.score);
            }
          }

          // åˆ‡æ›åˆ°ä¸‹ä¸€å€‹ç¯€é»
          currentNode = choice.nextNode;

          // æª¢æŸ¥éŠæˆ²æ˜¯å¦çµæŸ
          if (health <= 0) {
            gameOver("ä½ çš„å¥åº·å€¼é™è‡³é›¶ï¼éŠæˆ²çµæŸã€‚");
            return;
          }

          // æ›´æ–°æ•…äº‹é¡¯ç¤º
          updateStoryDisplay();
        }

        // æ›´æ–°å¥åº·æ¢
        function updateHealthBar() {
          healthBar.style.width = `${health}%`;
        }

        // æ›´æ–°é«”åŠ›æ¢
        function updateEnergyBar() {
          energyBar.style.width = `${energy}%`;
        }

        // æ›´æ–°æ•…äº‹é¡¯ç¤º
        function updateStoryDisplay() {
          const story = stories[currentStory];
          const node = story.nodes[currentNode];

          // æ¸…ç©ºæ•…äº‹é¡¯ç¤ºå€åŸŸ
          storyDisplay.innerHTML = "";

          // æ·»åŠ æ®µè½
          node.text.forEach((paragraph, index) => {
            const p = document.createElement("div");
            p.className = "story-paragraph";
            p.style.animationDelay = `${index * 0.3}s`;
            p.textContent = paragraph;
            storyDisplay.appendChild(p);
          });

          // æ›´æ–°é¸é …
          updateChoices(node.choices);

          // å¦‚æœæ˜¯çµæŸç¯€é»
          if (node.isEnd) {
            completeStory();
          }
        }

        // æ›´æ–°é¸é …
        function updateChoices(choices) {
          choiceList.innerHTML = "";

          choices.forEach((choice, index) => {
            const btn = document.createElement("button");
            btn.className = "choice-btn";
            btn.textContent = choice.text;
            btn.addEventListener("click", () => handleChoice(choice));

            // å¦‚æœèƒ½é‡ä¸è¶³ï¼Œç¦ç”¨é¸é …
            if (
              choice.effects &&
              choice.effects.energy &&
              Math.abs(choice.effects.energy) > energy
            ) {
              btn.disabled = true;
              btn.textContent += " (éœ€è¦æ›´å¤šé«”åŠ›)";
            }

            choiceList.appendChild(btn);
          });
        }

        // æ›´æ–°ç‰©å“æ¬„
        function updateInventory() {
          const inventoryContainer = document.querySelector(
            ".inventory-items-container"
          );
          inventoryContainer.innerHTML = "";

          if (inventory.length === 0) {
            inventoryContainer.textContent = "ç‰©å“æ¬„ç‚ºç©º";
            return;
          }

          inventory.forEach((item) => {
            const itemEl = document.createElement("div");
            itemEl.className = "inventory-item";

            const icon = document.createElement("div");
            icon.className = "item-icon";

            // æ ¹æ“šç‰©å“é¡å‹è¨­ç½®ä¸åŒçš„åœ–æ¨™
            switch (item) {
              case "åœ°åœ–":
                icon.textContent = "ğŸ—ºï¸";
                break;
              case "é‘°åŒ™":
                icon.textContent = "ğŸ”‘";
                break;
              case "é£Ÿç‰©":
                icon.textContent = "ğŸ";
                break;
              case "æ°´":
                icon.textContent = "ğŸ’§";
                break;
              case "è—¥æ°´":
                icon.textContent = "ğŸ§ª";
                break;
              default:
                icon.textContent = "ğŸ“¦";
            }

            const name = document.createElement("div");
            name.textContent = item;

            itemEl.appendChild(icon);
            itemEl.appendChild(name);
            inventoryContainer.appendChild(itemEl);
          });
        }

        // åˆ‡æ›æ•…äº‹
        function switchStory(storyId) {
          currentStory = storyId;
          currentNode = "start";
          health = 100;
          energy = 100;
          inventory = [];

          // æ›´æ–°UI
          storyTitle.textContent = stories[currentStory].title;
          updateHealthBar();
          updateEnergyBar();
          updateStoryDisplay();

          // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
          storyButtons.forEach((btn) => {
            btn.classList.toggle("active", btn.dataset.story === currentStory);
          });
        }

        // é‡ç½®ç•¶å‰æ•…äº‹
        function resetStory() {
          if (confirm("ç¢ºå®šè¦é‡ç½®ç•¶å‰æ•…äº‹å—ï¼Ÿæ‰€æœ‰é€²åº¦éƒ½å°‡ä¸Ÿå¤±ã€‚")) {
            switchStory(currentStory);
          }
        }

        // å®Œæˆæ•…äº‹
        function completeStory() {
          gameActive = false;

          // æ ¹æ“šå¥åº·å’Œé«”åŠ›è¨ˆç®—é¡å¤–çå‹µ
          const healthBonus = health * 2;
          const energyBonus = energy;
          const totalBonus = healthBonus + energyBonus;

          // æ·»åŠ åˆ†æ•¸
          scoreManager.add(totalBonus);

          // ä¿å­˜æœ€ä½³åˆ†æ•¸
          const bestScoreKey = `textAdventure_best_score_${currentStory}`;
          const currentBestScore = localStorage.getItem(bestScoreKey) || 0;

          if (scoreManager.getCurrentScore() > currentBestScore) {
            localStorage.setItem(bestScoreKey, scoreManager.getCurrentScore());
          }

          // é¡¯ç¤ºå®Œæˆè¨Šæ¯
          gameController.endGame(
            scoreManager.getCurrentScore(),
            `æ­å–œï¼ä½ å®Œæˆäº†ã€${stories[currentStory].title}ã€‘çš„å†’éšªï¼\n` +
              `å¥åº·çå‹µ: +${healthBonus}\n` +
              `é«”åŠ›çå‹µ: +${energyBonus}\n` +
              `ç¸½åˆ†: ${scoreManager.getCurrentScore()}`
          );
        }

        // éŠæˆ²çµæŸ
        function gameOver(message) {
          gameActive = false;

          // é¡¯ç¤ºéŠæˆ²çµæŸè¨Šæ¯
          gameController.endGame(scoreManager.getCurrentScore(), message);
        }

        // åˆå§‹åŒ–éŠæˆ²
        function initGame() {
          // é‡ç½®éŠæˆ²è®Šæ•¸
          health = 100;
          energy = 100;
          inventory = [];
          gameActive = true;

          // é‡ç½®åˆ†æ•¸
          scoreManager.reset();

          // æ›´æ–°UI
          updateHealthBar();
          updateEnergyBar();
          updateStoryDisplay();
        }

        // è¨­ç½®äº‹ä»¶ç›£è½å™¨
        inventoryBtn.addEventListener("click", () => {
          updateInventory();
          inventoryModal.show();
        });

        resetBtn.addEventListener("click", resetStory);

        storyButtons.forEach((btn) => {
          btn.addEventListener("click", () => {
            if (
              gameActive &&
              !confirm("åˆ‡æ›æ•…äº‹å°‡é‡æ–°é–‹å§‹éŠæˆ²ï¼Œç¢ºå®šè¦ç¹¼çºŒå—ï¼Ÿ")
            ) {
              return;
            }

            switchStory(btn.dataset.story);
          });
        });

        // è¨­ç½®éŠæˆ²æ§åˆ¶å™¨
        gameController.setRestartHandler(() => {
          switchStory(currentStory);
          gameActive = true;
        });

        // é–‹å§‹éŠæˆ²å‹•ç•«
        gameController.showStartAnimation(() => {
          switchStory("forest");
          gameActive = true;
        });
      });
    </script>
  </body>
</html>
