<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>è¨˜æ†¶åæ‡‰ - ç¶²é å°éŠæˆ²</title>
    <link rel="stylesheet" href="game-styles.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
    />
    <style>
      .game-board {
        display: grid;
        grid-template-columns: repeat(2, 200px);
        grid-template-rows: repeat(2, 200px);
        gap: 20px;
        margin: 30px auto;
        justify-content: center;
      }

      .simon-button {
        border: 8px solid #2c3e50;
        border-radius: 20px;
        cursor: pointer;
        transition: all 0.2s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 60px;
        color: rgba(255, 255, 255, 0.3);
        user-select: none;
        position: relative;
        overflow: hidden;
      }

      .simon-button:hover {
        transform: scale(1.05);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
      }

      .simon-button.active {
        transform: scale(0.95);
        filter: brightness(1.8);
        box-shadow: inset 0 0 50px rgba(255, 255, 255, 0.5);
      }

      .simon-button.red {
        background: linear-gradient(45deg, #e74c3c, #c0392b);
      }

      .simon-button.blue {
        background: linear-gradient(45deg, #3498db, #2980b9);
      }

      .simon-button.green {
        background: linear-gradient(45deg, #2ecc71, #27ae60);
      }

      .simon-button.yellow {
        background: linear-gradient(45deg, #f1c40f, #e67e22);
      }

      .simon-button.disabled {
        pointer-events: none;
        opacity: 0.6;
      }

      .game-info {
        display: flex;
        justify-content: space-around;
        align-items: center;
        margin: 20px 0;
        background: linear-gradient(45deg, #34495e, #2c3e50);
        padding: 20px;
        border-radius: 15px;
        color: white;
      }

      .info-item {
        text-align: center;
      }

      .info-value {
        font-size: 28px;
        font-weight: bold;
        display: block;
        margin-top: 8px;
        color: #ecf0f1;
      }

      .sequence-display {
        text-align: center;
        margin: 20px 0;
        padding: 15px;
        background: rgba(52, 73, 94, 0.1);
        border-radius: 10px;
        min-height: 60px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .sequence-item {
        display: inline-block;
        width: 20px;
        height: 20px;
        margin: 0 5px;
        border-radius: 50%;
        border: 2px solid #34495e;
        animation: sequenceAppear 0.3s ease-out;
      }

      @keyframes sequenceAppear {
        0% {
          transform: scale(0);
          opacity: 0;
        }
        100% {
          transform: scale(1);
          opacity: 1;
        }
      }

      .game-controls {
        display: flex;
        justify-content: center;
        gap: 15px;
        margin: 30px 0;
      }

      .control-button {
        background: linear-gradient(45deg, #e74c3c, #c0392b);
        color: white;
        border: none;
        padding: 12px 25px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 16px;
        font-weight: bold;
        transition: all 0.3s ease;
      }

      .control-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
      }

      .control-button:active {
        transform: translateY(0);
      }

      .control-button:disabled {
        background: #7f8c8d;
        cursor: not-allowed;
        transform: none;
      }

      .difficulty-selector {
        display: flex;
        justify-content: center;
        gap: 10px;
        margin: 20px 0;
      }

      .difficulty-button {
        background: #34495e;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .difficulty-button.active {
        background: #2ecc71;
      }

      .status-message {
        text-align: center;
        font-size: 18px;
        font-weight: bold;
        margin: 20px 0;
        min-height: 25px;
        color: #2c3e50;
      }

      .status-message.waiting {
        color: #f39c12;
      }

      .status-message.playing {
        color: #3498db;
      }

      .status-message.correct {
        color: #27ae60;
      }

      .status-message.wrong {
        color: #e74c3c;
      }

      .progress-bar {
        width: 100%;
        height: 10px;
        background: #ecf0f1;
        border-radius: 5px;
        margin: 20px 0;
        overflow: hidden;
      }

      .progress-fill {
        height: 100%;
        background: linear-gradient(45deg, #3498db, #2ecc71);
        width: 0%;
        transition: width 0.3s ease;
        border-radius: 5px;
      }

      .sound-toggle {
        position: absolute;
        top: 20px;
        right: 20px;
        background: #34495e;
        color: white;
        border: none;
        padding: 10px;
        border-radius: 50%;
        cursor: pointer;
        font-size: 18px;
        width: 50px;
        height: 50px;
      }

      .sound-toggle:hover {
        background: #2c3e50;
      }

      .pulse-animation {
        animation: pulse 0.6s ease-in-out infinite alternate;
      }

      @keyframes pulse {
        0% {
          transform: scale(1);
        }
        100% {
          transform: scale(1.1);
        }
      }
    </style>
  </head>
  <body>
    <div class="game-container">
      <header class="game-header">
        <h1 class="game-title">
          <i class="fas fa-brain"></i>
          è¨˜æ†¶åæ‡‰
        </h1>
        <button class="back-button" onclick="window.location.href='index.html'">
          <i class="fas fa-arrow-left"></i>
          è¿”å›é¸å–®
        </button>
      </header>

      <button class="sound-toggle" id="soundToggle" title="åˆ‡æ›éŸ³æ•ˆ">
        <i class="fas fa-volume-up"></i>
      </button>

      <div class="game-info">
        <div class="info-item">
          <span>ç­‰ç´š</span>
          <span class="info-value" id="level">1</span>
        </div>
        <div class="info-item">
          <span>åˆ†æ•¸</span>
          <span class="info-value" id="score">0</span>
        </div>
        <div class="info-item">
          <span>æœ€ä½³</span>
          <span class="info-value" id="bestScore">0</span>
        </div>
        <div class="info-item">
          <span>é€£å‹</span>
          <span class="info-value" id="streak">0</span>
        </div>
      </div>

      <div class="difficulty-selector">
        <button class="difficulty-button active" data-difficulty="easy">
          ç°¡å–®
        </button>
        <button class="difficulty-button" data-difficulty="medium">ä¸­ç­‰</button>
        <button class="difficulty-button" data-difficulty="hard">å›°é›£</button>
        <button class="difficulty-button" data-difficulty="extreme">
          æ¥µé™
        </button>
      </div>

      <div class="status-message" id="statusMessage">æŒ‰é–‹å§‹éŠæˆ²é–‹å§‹æŒ‘æˆ°ï¼</div>

      <div class="progress-bar">
        <div class="progress-fill" id="progressFill"></div>
      </div>

      <div class="sequence-display" id="sequenceDisplay">
        <span style="color: #7f8c8d">åºåˆ—å°‡åœ¨é€™è£¡é¡¯ç¤º</span>
      </div>

      <div class="game-board">
        <div
          class="simon-button red disabled"
          data-color="red"
          data-sound="261.63"
        >
          <i class="fas fa-heart"></i>
        </div>
        <div
          class="simon-button blue disabled"
          data-color="blue"
          data-sound="293.66"
        >
          <i class="fas fa-star"></i>
        </div>
        <div
          class="simon-button green disabled"
          data-color="green"
          data-sound="329.63"
        >
          <i class="fas fa-leaf"></i>
        </div>
        <div
          class="simon-button yellow disabled"
          data-color="yellow"
          data-sound="349.23"
        >
          <i class="fas fa-sun"></i>
        </div>
      </div>

      <div class="game-controls">
        <button class="control-button" id="startButton">é–‹å§‹éŠæˆ²</button>
        <button class="control-button" id="resetButton">é‡æ–°é–‹å§‹</button>
        <button class="control-button" id="helpButton">éŠæˆ²èªªæ˜</button>
      </div>

      <div class="game-stats">
        <div class="stat-item">
          <span class="stat-label">ç¸½éŠæˆ²æ¬¡æ•¸ï¼š</span>
          <span class="stat-value" id="totalGames">0</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">å¹³å‡ç­‰ç´šï¼š</span>
          <span class="stat-value" id="averageLevel">0</span>
        </div>
      </div>
    </div>

    <!-- éŠæˆ²èªªæ˜æ¨¡æ…‹æ¡† -->
    <div id="helpModal" class="modal">
      <div class="modal-content">
        <span class="close">&times;</span>
        <h2>ğŸ§  è¨˜æ†¶åæ‡‰ - éŠæˆ²èªªæ˜</h2>
        <div class="help-content">
          <h3>ğŸ¯ éŠæˆ²ç›®æ¨™</h3>
          <p>è¨˜ä½é›»è…¦é¡¯ç¤ºçš„åºåˆ—ï¼Œç„¶å¾ŒæŒ‰ç…§ç›¸åŒé †åºé»æ“ŠæŒ‰éˆ•ï¼</p>

          <h3>ğŸ® éŠæˆ²è¦å‰‡</h3>
          <ul>
            <li>éŠæˆ²é–‹å§‹æ™‚æœƒé¡¯ç¤ºä¸€å€‹æŒ‰éˆ•åºåˆ—</li>
            <li>è¨˜ä½åºåˆ—å¾Œï¼ŒæŒ‰ç…§ç›¸åŒé †åºé»æ“ŠæŒ‰éˆ•</li>
            <li>æ¯æ¬¡æ­£ç¢ºå¾Œï¼Œåºåˆ—æœƒå¢åŠ ä¸€å€‹æ–°çš„æŒ‰éˆ•</li>
            <li>éŒ¯èª¤é»æ“ŠæœƒçµæŸéŠæˆ²</li>
            <li>æ¯å€‹ç­‰ç´šéƒ½æœ‰æ™‚é–“é™åˆ¶</li>
          </ul>

          <h3>ğŸ¨ æŒ‰éˆ•é¡è‰²</h3>
          <ul>
            <li>ğŸ”´ ç´…è‰² - æ„›å¿ƒåœ–æ¡ˆ</li>
            <li>ğŸ”µ è—è‰² - æ˜Ÿæ˜Ÿåœ–æ¡ˆ</li>
            <li>ğŸŸ¢ ç¶ è‰² - è‘‰å­åœ–æ¡ˆ</li>
            <li>ğŸŸ¡ é»ƒè‰² - å¤ªé™½åœ–æ¡ˆ</li>
          </ul>

          <h3>âš¡ é›£åº¦ç­‰ç´š</h3>
          <ul>
            <li><strong>ç°¡å–®ï¼š</strong>è¼ƒæ…¢çš„åºåˆ—æ’­æ”¾é€Ÿåº¦</li>
            <li><strong>ä¸­ç­‰ï¼š</strong>æ¨™æº–é€Ÿåº¦</li>
            <li><strong>å›°é›£ï¼š</strong>è¼ƒå¿«é€Ÿåº¦ï¼Œæ›´çŸ­æ€è€ƒæ™‚é–“</li>
            <li><strong>æ¥µé™ï¼š</strong>æœ€å¿«é€Ÿåº¦ï¼Œæ¥µçŸ­æ€è€ƒæ™‚é–“</li>
          </ul>

          <h3>ğŸ† å¾—åˆ†æ–¹å¼</h3>
          <ul>
            <li>æ¯å®Œæˆä¸€å€‹åºåˆ—ç²å¾— 10 Ã— ç­‰ç´š åˆ†æ•¸</li>
            <li>é€£çºŒæ­£ç¢ºå¯ç²å¾—é¡å¤–åŠ æˆ</li>
            <li>æ›´é«˜é›£åº¦æœ‰æ›´é«˜åˆ†æ•¸å€æ•¸</li>
          </ul>
        </div>
      </div>
    </div>

    <!-- éŠæˆ²çµæŸæ¨¡æ…‹æ¡† -->
    <div id="gameOverModal" class="modal">
      <div class="modal-content">
        <h2>ğŸ® éŠæˆ²çµæŸï¼</h2>
        <div id="gameOverContent">
          <p>é”åˆ°ç­‰ç´šï¼š<span id="finalLevel">0</span></p>
          <p>æœ€çµ‚åˆ†æ•¸ï¼š<span id="finalScore">0</span></p>
          <p>é€£å‹ç´€éŒ„ï¼š<span id="finalStreak">0</span></p>
          <p
            id="newRecord"
            style="display: none; color: #e74c3c; font-weight: bold"
          >
            ğŸ‰ æ–°ç´€éŒ„ï¼
          </p>
        </div>
        <div class="modal-buttons">
          <button class="modal-button" onclick="restartGame()">å†ç©ä¸€æ¬¡</button>
          <button
            class="modal-button"
            onclick="window.location.href='index.html'"
          >
            è¿”å›é¸å–®
          </button>
        </div>
      </div>
    </div>

    <script src="gameUtils.js"></script>
    <script>
      class SimonGame {
        constructor() {
          this.sequence = [];
          this.playerSequence = [];
          this.level = 1;
          this.score = 0;
          this.streak = 0;
          this.maxStreak = 0;
          this.isPlaying = false;
          this.showingSequence = false;
          this.difficulty = "easy";
          this.soundEnabled = true;

          this.buttons = document.querySelectorAll(".simon-button");
          this.audioContext = null;

          this.difficultySettings = {
            easy: { speed: 800, thinkTime: 5000, scoreMultiplier: 1 },
            medium: { speed: 600, thinkTime: 4000, scoreMultiplier: 1.5 },
            hard: { speed: 400, thinkTime: 3000, scoreMultiplier: 2 },
            extreme: { speed: 250, thinkTime: 2000, scoreMultiplier: 3 },
          };

          this.colors = ["red", "blue", "green", "yellow"];
          this.thinkTimer = null;

          this.setupEventListeners();
          this.loadStats();
          this.setupAudio();
        }

        setupEventListeners() {
          document
            .getElementById("startButton")
            .addEventListener("click", () => this.startGame());
          document
            .getElementById("resetButton")
            .addEventListener("click", () => this.resetGame());
          document
            .getElementById("helpButton")
            .addEventListener("click", () => this.showHelp());
          document
            .getElementById("soundToggle")
            .addEventListener("click", () => this.toggleSound());

          // é›£åº¦é¸æ“‡
          document.querySelectorAll(".difficulty-button").forEach((button) => {
            button.addEventListener("click", (e) =>
              this.setDifficulty(e.target.dataset.difficulty)
            );
          });

          // æŒ‰éˆ•é»æ“Š
          this.buttons.forEach((button) => {
            button.addEventListener("click", () => {
              if (
                !this.showingSequence &&
                this.isPlaying &&
                !button.classList.contains("disabled")
              ) {
                this.handleButtonClick(button.dataset.color);
              }
            });
          });

          // æ¨¡æ…‹æ¡†è¨­å®š
          this.setupModals();
        }

        setupAudio() {
          try {
            this.audioContext = new (window.AudioContext ||
              window.webkitAudioContext)();
          } catch (e) {
            console.log("éŸ³æ•ˆä¸æ”¯æ´");
            this.soundEnabled = false;
          }
        }

        playSound(frequency) {
          if (!this.soundEnabled || !this.audioContext) return;

          try {
            const oscillator = this.audioContext.createOscillator();
            const gainNode = this.audioContext.createGain();

            oscillator.connect(gainNode);
            gainNode.connect(this.audioContext.destination);

            oscillator.frequency.setValueAtTime(
              frequency,
              this.audioContext.currentTime
            );
            oscillator.type = "sine";

            gainNode.gain.setValueAtTime(0.3, this.audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(
              0.01,
              this.audioContext.currentTime + 0.3
            );

            oscillator.start(this.audioContext.currentTime);
            oscillator.stop(this.audioContext.currentTime + 0.3);
          } catch (e) {
            console.log("éŸ³æ•ˆæ’­æ”¾éŒ¯èª¤");
          }
        }

        toggleSound() {
          this.soundEnabled = !this.soundEnabled;
          const icon = document.querySelector("#soundToggle i");
          icon.className = this.soundEnabled
            ? "fas fa-volume-up"
            : "fas fa-volume-mute";
        }

        setDifficulty(difficulty) {
          this.difficulty = difficulty;

          // æ›´æ–°UI
          document
            .querySelectorAll(".difficulty-button")
            .forEach((btn) => btn.classList.remove("active"));
          document
            .querySelector(`[data-difficulty="${difficulty}"]`)
            .classList.add("active");
        }

        startGame() {
          this.isPlaying = true;
          this.sequence = [];
          this.playerSequence = [];
          this.level = 1;
          this.score = 0;
          this.streak = 0;

          this.updateUI();
          this.enableButtons();
          this.nextLevel();

          document.getElementById("startButton").disabled = true;
          this.updateStatus("éŠæˆ²é–‹å§‹ï¼æº–å‚™è¨˜ä½åºåˆ—...", "playing");
        }

        resetGame() {
          this.isPlaying = false;
          this.showingSequence = false;
          this.sequence = [];
          this.playerSequence = [];
          this.level = 1;
          this.score = 0;
          this.streak = 0;

          if (this.thinkTimer) {
            clearTimeout(this.thinkTimer);
          }

          this.updateUI();
          this.disableButtons();
          this.updateStatus("æŒ‰é–‹å§‹éŠæˆ²é–‹å§‹æŒ‘æˆ°ï¼", "");
          this.updateProgress(0);
          this.clearSequenceDisplay();

          document.getElementById("startButton").disabled = false;
        }

        nextLevel() {
          this.playerSequence = [];
          this.addToSequence();
          this.showSequence();
        }

        addToSequence() {
          const randomColor =
            this.colors[Math.floor(Math.random() * this.colors.length)];
          this.sequence.push(randomColor);
        }

        async showSequence() {
          this.showingSequence = true;
          this.disableButtons();
          this.updateStatus(`ç­‰ç´š ${this.level} - è¨˜ä½é€™å€‹åºåˆ—`, "waiting");
          this.updateSequenceDisplay();

          const settings = this.difficultySettings[this.difficulty];

          // é¡¯ç¤ºåºåˆ—å‰çš„æº–å‚™æ™‚é–“
          await this.delay(500);

          for (let i = 0; i < this.sequence.length; i++) {
            const color = this.sequence[i];
            const button = document.querySelector(`[data-color="${color}"]`);

            this.highlightButton(button);
            this.playSound(parseFloat(button.dataset.sound));

            await this.delay(settings.speed);
          }

          // åºåˆ—çµæŸå¾Œçš„ç­‰å¾…æ™‚é–“
          await this.delay(300);

          this.showingSequence = false;
          this.enableButtons();
          this.updateStatus("ç¾åœ¨è¼ªåˆ°ä½ äº†ï¼é»æ“ŠæŒ‰éˆ•é‡è¤‡åºåˆ—", "playing");

          // é–‹å§‹æ€è€ƒæ™‚é–“å€’æ•¸
          this.startThinkTimer(settings.thinkTime);
        }

        startThinkTimer(duration) {
          let timeLeft = duration;
          const updateInterval = 50;

          const updateProgress = () => {
            const progress = ((duration - timeLeft) / duration) * 100;
            this.updateProgress(progress);
            timeLeft -= updateInterval;

            if (timeLeft <= 0) {
              this.gameOver("æ™‚é–“åˆ°äº†ï¼");
            } else if (this.isPlaying && !this.showingSequence) {
              this.thinkTimer = setTimeout(updateProgress, updateInterval);
            }
          };

          updateProgress();
        }

        highlightButton(button) {
          button.classList.add("active");
          setTimeout(() => {
            button.classList.remove("active");
          }, 300);
        }

        handleButtonClick(color) {
          const button = document.querySelector(`[data-color="${color}"]`);
          this.highlightButton(button);
          this.playSound(parseFloat(button.dataset.sound));

          this.playerSequence.push(color);

          // æª¢æŸ¥ç•¶å‰é»æ“Šæ˜¯å¦æ­£ç¢º
          const currentIndex = this.playerSequence.length - 1;
          if (
            this.playerSequence[currentIndex] !== this.sequence[currentIndex]
          ) {
            this.gameOver("éŒ¯èª¤ï¼åºåˆ—ä¸åŒ¹é…");
            return;
          }

          // æª¢æŸ¥æ˜¯å¦å®Œæˆæ•´å€‹åºåˆ—
          if (this.playerSequence.length === this.sequence.length) {
            this.levelComplete();
          }
        }

        levelComplete() {
          if (this.thinkTimer) {
            clearTimeout(this.thinkTimer);
          }

          this.streak++;
          this.maxStreak = Math.max(this.maxStreak, this.streak);

          const settings = this.difficultySettings[this.difficulty];
          const baseScore = 10 * this.level;
          const streakBonus = Math.floor(this.streak / 3) * 5;
          const points = Math.floor(
            (baseScore + streakBonus) * settings.scoreMultiplier
          );

          this.score += points;
          this.level++;

          this.updateUI();
          this.updateStatus(`æ­£ç¢ºï¼ç²å¾— ${points} åˆ†`, "correct");
          this.updateProgress(100);

          // çŸ­æš«å»¶é²å¾Œé€²å…¥ä¸‹ä¸€ç´š
          setTimeout(() => {
            this.nextLevel();
          }, 1500);
        }

        gameOver(message) {
          this.isPlaying = false;
          this.showingSequence = false;

          if (this.thinkTimer) {
            clearTimeout(this.thinkTimer);
          }

          this.disableButtons();
          this.updateStatus(message, "wrong");
          this.updateStats();

          setTimeout(() => {
            this.showGameOver();
          }, 1500);
        }

        delay(ms) {
          return new Promise((resolve) => setTimeout(resolve, ms));
        }

        enableButtons() {
          this.buttons.forEach((button) => {
            button.classList.remove("disabled");
          });
        }

        disableButtons() {
          this.buttons.forEach((button) => {
            button.classList.add("disabled");
          });
        }

        updateUI() {
          document.getElementById("level").textContent = this.level;
          document.getElementById("score").textContent =
            this.score.toLocaleString();
          document.getElementById("streak").textContent = this.streak;
        }

        updateStatus(message, className) {
          const statusElement = document.getElementById("statusMessage");
          statusElement.textContent = message;
          statusElement.className = `status-message ${className}`;
        }

        updateProgress(percentage) {
          document.getElementById("progressFill").style.width =
            percentage + "%";
        }

        updateSequenceDisplay() {
          const display = document.getElementById("sequenceDisplay");
          display.innerHTML = "";

          this.sequence.forEach((color) => {
            const item = document.createElement("div");
            item.className = `sequence-item ${color}`;
            display.appendChild(item);
          });
        }

        clearSequenceDisplay() {
          const display = document.getElementById("sequenceDisplay");
          display.innerHTML =
            '<span style="color: #7f8c8d;">åºåˆ—å°‡åœ¨é€™è£¡é¡¯ç¤º</span>';
        }

        showHelp() {
          document.getElementById("helpModal").style.display = "block";
        }

        showGameOver() {
          const isNewRecord =
            this.score >
            parseInt(
              document.getElementById("bestScore").textContent.replace(/,/g, "")
            );

          document.getElementById("finalLevel").textContent = this.level - 1;
          document.getElementById("finalScore").textContent =
            this.score.toLocaleString();
          document.getElementById("finalStreak").textContent = this.maxStreak;

          if (isNewRecord) {
            document.getElementById("newRecord").style.display = "block";
          }

          document.getElementById("gameOverModal").style.display = "block";
        }

        loadStats() {
          const stats = JSON.parse(
            localStorage.getItem("simonGameStats") || "{}"
          );
          document.getElementById("bestScore").textContent = (
            stats.bestScore || 0
          ).toLocaleString();
          document.getElementById("totalGames").textContent =
            stats.totalGames || 0;

          const avgLevel =
            stats.totalGames > 0
              ? Math.round((stats.totalLevels || 0) / stats.totalGames)
              : 0;
          document.getElementById("averageLevel").textContent = avgLevel;
        }

        updateStats() {
          const stats = JSON.parse(
            localStorage.getItem("simonGameStats") || "{}"
          );

          stats.bestScore = Math.max(stats.bestScore || 0, this.score);
          stats.totalGames = (stats.totalGames || 0) + 1;
          stats.totalLevels = (stats.totalLevels || 0) + (this.level - 1);
          stats.totalScore = (stats.totalScore || 0) + this.score;
          stats.maxStreak = Math.max(stats.maxStreak || 0, this.maxStreak);

          localStorage.setItem("simonGameStats", JSON.stringify(stats));
          this.loadStats();
        }
        setupModals() {
          const modals = document.querySelectorAll(".modal");
          const closeButtons = document.querySelectorAll(".close");

          closeButtons.forEach((button) => {
            button.addEventListener("click", (e) => {
              e.target.closest(".modal").style.display = "none";
            });
          });

          window.addEventListener("click", (e) => {
            modals.forEach((modal) => {
              if (e.target === modal) {
                modal.style.display = "none";
              }
            });
          });

          // Setup help button
          document
            .getElementById("helpButton")
            .addEventListener("click", () => {
              this.showHelp();
            });
        }

        showHelp() {
          document.getElementById("helpModal").style.display = "block";
        }

        closeHelp() {
          document.getElementById("helpModal").style.display = "none";
        }
      }

      function restartGame() {
        document.getElementById("gameOverModal").style.display = "none";
        game.resetGame();
        game.startGame();
      }

      // åˆå§‹åŒ–éŠæˆ²
      const game = new SimonGame();

      // è¨»å†ŠéŠæˆ²çµ±è¨ˆ
      if (typeof gameStats !== "undefined") {
        gameStats.registerGame("simon", "è¨˜æ†¶åæ‡‰");
      }
    </script>
  </body>
</html>
