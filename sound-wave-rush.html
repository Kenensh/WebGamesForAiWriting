<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>éŸ³æ³¢è¡åˆº - Sound Wave Rush</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        min-height: 100vh;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        font-family: "Arial", sans-serif;
        overflow: hidden;
      }

      .game-container {
        width: 90vw;
        height: 90vh;
        max-width: 900px;
        max-height: 700px;
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        border: 1px solid rgba(255, 255, 255, 0.2);
        padding: 30px;
        text-align: center;
        position: relative;
      }

      h1 {
        color: white;
        font-size: 2.5em;
        margin-bottom: 20px;
        text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
      }

      .game-stats {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 15px;
        margin-bottom: 20px;
        color: white;
        font-size: 1.1em;
      }

      .stat-box {
        background: rgba(255, 255, 255, 0.1);
        padding: 10px;
        border-radius: 10px;
        border: 1px solid rgba(255, 255, 255, 0.2);
      }

      .wave-visualizer {
        width: 100%;
        height: 80px;
        background: rgba(0, 0, 0, 0.3);
        border-radius: 10px;
        margin: 20px 0;
        position: relative;
        overflow: hidden;
      }

      .wave-bar {
        position: absolute;
        bottom: 0;
        width: 4px;
        background: linear-gradient(0deg, #3498db, #2ecc71);
        transition: height 0.1s ease;
        border-radius: 2px 2px 0 0;
      }

      .game-area {
        width: 100%;
        height: 350px;
        background: rgba(0, 0, 0, 0.2);
        border-radius: 15px;
        position: relative;
        margin: 20px 0;
        overflow: hidden;
      }

      .rhythm-lane {
        position: absolute;
        width: 60px;
        height: 100%;
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-radius: 10px;
        background: rgba(255, 255, 255, 0.05);
      }

      .lane1 {
        left: 10%;
        background: rgba(231, 76, 60, 0.1);
      }
      .lane2 {
        left: 30%;
        background: rgba(52, 152, 219, 0.1);
      }
      .lane3 {
        left: 50%;
        background: rgba(46, 204, 113, 0.1);
      }
      .lane4 {
        left: 70%;
        background: rgba(241, 196, 15, 0.1);
      }

      .hit-zone {
        position: absolute;
        bottom: 20px;
        width: 60px;
        height: 60px;
        border: 3px solid #fff;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.2);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5em;
        font-weight: bold;
        color: white;
      }

      .hit-zone.lane1 {
        left: 10%;
        border-color: #e74c3c;
      }
      .hit-zone.lane2 {
        left: 30%;
        border-color: #3498db;
      }
      .hit-zone.lane3 {
        left: 50%;
        border-color: #2ecc71;
      }
      .hit-zone.lane4 {
        left: 70%;
        border-color: #f1c40f;
      }

      .note {
        position: absolute;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        border: 3px solid #fff;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        color: white;
        text-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
        animation: notefall linear forwards;
        cursor: pointer;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      }

      .note.lane1 {
        background: linear-gradient(45deg, #e74c3c, #c0392b);
        left: calc(10% + 5px);
      }

      .note.lane2 {
        background: linear-gradient(45deg, #3498db, #2980b9);
        left: calc(30% + 5px);
      }

      .note.lane3 {
        background: linear-gradient(45deg, #2ecc71, #27ae60);
        left: calc(50% + 5px);
      }

      .note.lane4 {
        background: linear-gradient(45deg, #f1c40f, #f39c12);
        left: calc(70% + 5px);
      }

      .note.perfect {
        animation: perfectHit 0.5s ease;
      }

      .note.good {
        animation: goodHit 0.5s ease;
      }

      .note.miss {
        animation: missHit 0.5s ease;
      }

      @keyframes notefall {
        from {
          top: -60px;
        }
        to {
          top: 100%;
        }
      }

      @keyframes perfectHit {
        0% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.5);
          background: radial-gradient(circle, #f39c12, #e67e22);
        }
        100% {
          transform: scale(0);
          opacity: 0;
        }
      }

      @keyframes goodHit {
        0% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.2);
          background: radial-gradient(circle, #2ecc71, #27ae60);
        }
        100% {
          transform: scale(0);
          opacity: 0;
        }
      }

      @keyframes missHit {
        0% {
          transform: scale(1);
        }
        100% {
          transform: scale(0.5);
          opacity: 0;
          background: #e74c3c;
        }
      }

      .controls {
        display: flex;
        gap: 15px;
        justify-content: center;
        flex-wrap: wrap;
      }

      /* å¹«åŠ©æ¨¡æ…‹æ¡†æ¨£å¼ */
      .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        backdrop-filter: blur(10px);
        align-items: center;
        justify-content: center;
      }

      .modal-content {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        padding: 30px;
        border-radius: 20px;
        max-width: 600px;
        max-height: 80vh;
        overflow-y: auto;
        color: white;
        position: relative;
        border: 2px solid rgba(255, 255, 255, 0.3);
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
      }

      .modal h2 {
        margin-bottom: 20px;
        text-align: center;
        font-size: 2em;
        text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
      }

      .modal h3 {
        margin: 20px 0 10px 0;
        color: #fff;
        font-size: 1.3em;
      }

      .modal p,
      .modal li {
        margin: 10px 0;
        line-height: 1.6;
        font-size: 1.1em;
      }

      .modal ul {
        margin-left: 20px;
      }

      .close-help {
        position: absolute;
        top: 15px;
        right: 20px;
        color: white;
        font-size: 28px;
        font-weight: bold;
        cursor: pointer;
        background: none;
        border: none;
        padding: 0;
        line-height: 1;
      }

      .close-help:hover {
        color: #ff6b6b;
        transform: scale(1.1);
      }

      @media (max-width: 768px) {
        .game-container {
          width: 95vw;
          height: 95vh;
          padding: 20px;
        }

        h1 {
          font-size: 2em;
        }

        .game-stats {
          grid-template-columns: repeat(2, 1fr);
          font-size: 1em;
        }

        .game-area {
          height: 300px;
        }

        .note,
        .hit-zone {
          width: 45px;
          height: 45px;
        }
      }
    </style>
  </head>
  <body>
    <div class="game-container">
      <h1>ğŸµ éŸ³æ³¢è¡åˆº</h1>

      <div class="game-stats">
        <div class="stat-box">åˆ†æ•¸: <span id="score">0</span></div>
        <div class="stat-box">é€£æ“Š: <span id="combo">0</span></div>
        <div class="stat-box">æº–ç¢ºç‡: <span id="accuracy">100%</span></div>
        <div class="stat-box">ç­‰ç´š: <span id="level">1</span></div>
      </div>

      <div class="wave-visualizer" id="waveVisualizer">
        <!-- éŸ³æ³¢å¯è¦–åŒ–æ¢ -->
      </div>

      <div class="status" id="status">
        æº–å‚™éŸ³æ³¢ç¯€å¥æŒ‘æˆ°ï¼ä½¿ç”¨éµç›¤ Aã€Sã€Dã€F æˆ–é»æ“ŠæŒ‰éˆ•ï¼
      </div>

      <div class="game-area" id="gameArea">
        <div class="rhythm-lane lane1"></div>
        <div class="rhythm-lane lane2"></div>
        <div class="rhythm-lane lane3"></div>
        <div class="rhythm-lane lane4"></div>

        <div class="hit-zone lane1" data-lane="1">A</div>
        <div class="hit-zone lane2" data-lane="2">S</div>
        <div class="hit-zone lane3" data-lane="3">D</div>
        <div class="hit-zone lane4" data-lane="4">F</div>
      </div>

      <div class="key-controls">
        <button class="btn key-btn lane1" data-lane="1">A</button>
        <button class="btn key-btn lane2" data-lane="2">S</button>
        <button class="btn key-btn lane3" data-lane="3">D</button>
        <button class="btn key-btn lane4" data-lane="4">F</button>
      </div>
      <div class="controls">
        <button class="btn" id="startBtn">é–‹å§‹éŠæˆ²</button>
        <button class="btn" id="pauseBtn" style="display: none">æš«åœ</button>
        <button class="btn" id="resetBtn">é‡æ–°é–‹å§‹</button>
        <button class="btn" id="helpBtn">éŠæˆ²èªªæ˜</button>
      </div>
    </div>

    <!-- å¹«åŠ©æ¨¡æ…‹æ¡† -->
    <div id="helpModal" class="modal">
      <div class="modal-content">
        <button class="close-help">&times;</button>
        <h2>ğŸµ éŸ³æ³¢è¡åˆº - éŠæˆ²èªªæ˜</h2>

        <h3>ğŸ¯ éŠæˆ²ç›®æ¨™</h3>
        <p>è·Ÿéš¨éŸ³æ¨‚ç¯€æ‹ï¼Œåœ¨æ­£ç¢ºçš„æ™‚æ©ŸæŒ‰ä¸‹å°æ‡‰çš„æŒ‰éµï¼Œæ“Šä¸­ä¸‹é™çš„éŸ³ç¬¦ï¼</p>

        <h3>ğŸ® æ“ä½œæ–¹å¼</h3>
        <ul>
          <li><strong>A éµ</strong>ï¼šæ§åˆ¶ç¬¬1è»Œé“ï¼ˆç´…è‰²ï¼‰</li>
          <li><strong>S éµ</strong>ï¼šæ§åˆ¶ç¬¬2è»Œé“ï¼ˆç¶ è‰²ï¼‰</li>
          <li><strong>D éµ</strong>ï¼šæ§åˆ¶ç¬¬3è»Œé“ï¼ˆè—è‰²ï¼‰</li>
          <li><strong>F éµ</strong>ï¼šæ§åˆ¶ç¬¬4è»Œé“ï¼ˆé»ƒè‰²ï¼‰</li>
          <li>ä¹Ÿå¯ä»¥é»æ“Šè¢å¹•ä¸‹æ–¹çš„æŒ‰éˆ•ä¾†æ“ä½œ</li>
        </ul>

        <h3>ğŸ“Š è¨ˆåˆ†ç³»çµ±</h3>
        <ul>
          <li>
            <strong>å®Œç¾æ“Šä¸­</strong>ï¼šéŸ³ç¬¦æ­£å¥½åˆ°é”åº•éƒ¨æ™‚æŒ‰éµï¼Œç²å¾—æœ€é«˜åˆ†æ•¸
          </li>
          <li><strong>è‰¯å¥½æ“Šä¸­</strong>ï¼šç¨æ—©æˆ–ç¨æ™šæŒ‰éµï¼Œç²å¾—ä¸­ç­‰åˆ†æ•¸</li>
          <li><strong>é€£æ“Šçå‹µ</strong>ï¼šé€£çºŒæ“Šä¸­å¯ç²å¾—é€£æ“ŠåŠ åˆ†</li>
          <li><strong>æº–ç¢ºåº¦</strong>ï¼šå½±éŸ¿ç­‰ç´šæå‡å’Œé¡å¤–çå‹µ</li>
        </ul>

        <h3>ğŸµ éŸ³æ¨‚ç¯€æ‹</h3>
        <ul>
          <li>è§€å¯ŸéŸ³æ³¢è¦–è¦ºåŒ–æ•ˆæœï¼Œæ„Ÿå—éŸ³æ¨‚ç¯€æ‹</li>
          <li>éŸ³ç¬¦æœƒæŒ‰ç…§éŸ³æ¨‚ç¯€æ‹å¾ä¸Šæ–¹é™ä¸‹</li>
          <li>è·Ÿéš¨ç¯€å¥ï¼Œåœ¨éŸ³ç¬¦åˆ°é”åˆ¤å®šç·šæ™‚æŒ‰éµ</li>
          <li>ä¸åŒé›£åº¦çš„éŸ³ç¬¦é€Ÿåº¦å’Œå¯†åº¦æœƒå¢åŠ </li>
        </ul>

        <h3>ğŸ’¡ éŠæˆ²æŠ€å·§</h3>
        <ul>
          <li>å°ˆæ³¨æ–¼éŸ³æ¨‚ç¯€æ‹ï¼Œè€Œä¸åªæ˜¯è¦–è¦º</li>
          <li>ç·´ç¿’æ‰‹æŒ‡çš„ç¨ç«‹æ€§å’Œå”èª¿æ€§</li>
          <li>ä¿æŒç¯€å¥æ„Ÿï¼Œé¿å…æ€¥èº</li>
          <li>è§€å¯ŸéŸ³ç¬¦çš„ä¸‹é™æ¨¡å¼</li>
          <li>åˆ©ç”¨éŸ³æ³¢è¦–è¦ºåŒ–å¹«åŠ©åˆ¤æ–·ç¯€æ‹</li>
        </ul>
      </div>
    </div>

    <script>
      class SoundWaveRush {
        constructor() {
          this.gameArea = document.getElementById("gameArea");
          this.startBtn = document.getElementById("startBtn");
          this.pauseBtn = document.getElementById("pauseBtn");
          this.resetBtn = document.getElementById("resetBtn");
          this.status = document.getElementById("status");
          this.scoreEl = document.getElementById("score");
          this.comboEl = document.getElementById("combo");
          this.accuracyEl = document.getElementById("accuracy");
          this.levelEl = document.getElementById("level");
          this.waveVisualizer = document.getElementById("waveVisualizer");

          this.score = 0;
          this.combo = 0;
          this.level = 1;
          this.totalNotes = 0;
          this.hitNotes = 0;
          this.gameActive = false;
          this.isPaused = false;

          this.notes = [];
          this.noteSpeed = 2000; // éŸ³ç¬¦ä¸‹é™æ™‚é–“(ms)
          this.spawnRate = 800; // éŸ³ç¬¦ç”Ÿæˆé–“éš”(ms)
          this.gameTime = 0;

          this.keyMapping = {
            KeyA: 1,
            KeyS: 2,
            KeyD: 3,
            KeyF: 4,
          };

          this.patterns = [
            [1, 2, 3, 4],
            [1, 3, 2, 4],
            [4, 3, 2, 1],
            [1, 1, 2, 3],
            [2, 4, 1, 3],
            [1, 2, 1, 3, 4],
            [3, 1, 4, 2, 3],
          ];

          this.currentPattern = 0;
          this.patternStep = 0;

          this.spawnInterval = null;
          this.gameInterval = null;

          this.initializeGame();
          this.createWaveVisualizer();
        }
        initializeGame() {
          this.startBtn.addEventListener("click", () => this.startGame());
          this.pauseBtn.addEventListener("click", () => this.pauseGame());
          this.resetBtn.addEventListener("click", () => this.resetGame());

          // å¹«åŠ©ç³»çµ±
          const helpBtn = document.getElementById("helpBtn");
          if (helpBtn) {
            helpBtn.addEventListener("click", () => this.showHelp());
          }

          // éµç›¤äº‹ä»¶
          document.addEventListener("keydown", (e) => this.handleKeyPress(e));
          document.addEventListener("keyup", (e) => this.handleKeyRelease(e));

          // æŒ‰éˆ•é»æ“Šäº‹ä»¶
          document.querySelectorAll(".key-btn").forEach((btn) => {
            btn.addEventListener("mousedown", (e) =>
              this.handleButtonPress(e.target.dataset.lane)
            );
            btn.addEventListener("mouseup", (e) =>
              this.handleButtonRelease(e.target.dataset.lane)
            );
            btn.addEventListener("mouseleave", (e) =>
              this.handleButtonRelease(e.target.dataset.lane)
            );
          });

          this.updateDisplay();
        }

        createWaveVisualizer() {
          for (let i = 0; i < 50; i++) {
            const bar = document.createElement("div");
            bar.className = "wave-bar";
            bar.style.left = i * 4 + "px";
            this.waveVisualizer.appendChild(bar);
          }
        }

        updateWaveVisualizer() {
          const bars = this.waveVisualizer.querySelectorAll(".wave-bar");
          bars.forEach((bar, index) => {
            const height = Math.random() * 60 + 10;
            bar.style.height = height + "px";

            // æ ¹æ“šéŠæˆ²ç‹€æ…‹èª¿æ•´é¡è‰²
            if (this.combo > 10) {
              bar.style.background = "linear-gradient(0deg, #e74c3c, #f39c12)";
            } else if (this.combo > 5) {
              bar.style.background = "linear-gradient(0deg, #f39c12, #2ecc71)";
            } else {
              bar.style.background = "linear-gradient(0deg, #3498db, #2ecc71)";
            }
          });
        }

        startGame() {
          this.gameActive = true;
          this.isPaused = false;
          this.score = 0;
          this.combo = 0;
          this.level = 1;
          this.totalNotes = 0;
          this.hitNotes = 0;
          this.gameTime = 0;
          this.currentPattern = 0;
          this.patternStep = 0;

          this.clearNotes();
          this.updateDisplay();
          this.startSpawning();
          this.startGameTimer();

          this.startBtn.style.display = "none";
          this.pauseBtn.style.display = "inline-block";
          this.status.textContent = "éŠæˆ²é–‹å§‹ï¼è·Ÿä¸Šç¯€æ‹ï¼";
        }

        startSpawning() {
          this.spawnInterval = setInterval(() => {
            if (!this.isPaused && this.gameActive) {
              this.spawnNote();
            }
          }, this.spawnRate);
        }

        startGameTimer() {
          this.gameInterval = setInterval(() => {
            if (!this.isPaused && this.gameActive) {
              this.gameTime++;
              this.updateWaveVisualizer();

              // æ¯30ç§’æå‡é›£åº¦
              if (this.gameTime % 30 === 0) {
                this.levelUp();
              }
            }
          }, 1000);
        }

        spawnNote() {
          const pattern = this.patterns[this.currentPattern];
          const lane = pattern[this.patternStep];

          const note = {
            id: Date.now() + Math.random(),
            lane: lane,
            y: -60,
            hit: false,
            element: null,
          };

          this.createNoteElement(note);
          this.notes.push(note);
          this.totalNotes++;

          // æ›´æ–°æ¨¡å¼é€²åº¦
          this.patternStep = (this.patternStep + 1) % pattern.length;
          if (this.patternStep === 0) {
            this.currentPattern =
              (this.currentPattern + 1) % this.patterns.length;
          }
        }

        createNoteElement(note) {
          const element = document.createElement("div");
          element.className = `note lane${note.lane}`;
          element.dataset.id = note.id;
          element.dataset.lane = note.lane;
          element.textContent = ["", "A", "S", "D", "F"][note.lane];

          element.style.animationDuration = this.noteSpeed + "ms";
          note.element = element;
          this.gameArea.appendChild(element);

          // è‡ªå‹•ç§»é™¤è¶…æ™‚éŸ³ç¬¦
          setTimeout(() => {
            if (!note.hit) {
              this.missNote(note);
            }
          }, this.noteSpeed);
        }

        handleKeyPress(e) {
          if (!this.gameActive || this.isPaused) return;

          const lane = this.keyMapping[e.code];
          if (lane) {
            this.activateKey(lane);
            this.hitLane(lane);
          }
        }

        handleKeyRelease(e) {
          const lane = this.keyMapping[e.code];
          if (lane) {
            this.deactivateKey(lane);
          }
        }

        handleButtonPress(lane) {
          if (!this.gameActive || this.isPaused) return;

          this.activateKey(parseInt(lane));
          this.hitLane(parseInt(lane));
        }

        handleButtonRelease(lane) {
          this.deactivateKey(parseInt(lane));
        }

        activateKey(lane) {
          const keyBtn = document.querySelector(
            `.key-btn[data-lane="${lane}"]`
          );
          const hitZone = document.querySelector(
            `.hit-zone[data-lane="${lane}"]`
          );

          if (keyBtn) keyBtn.classList.add("active");
          if (hitZone) hitZone.style.transform = "scale(1.1)";
        }

        deactivateKey(lane) {
          const keyBtn = document.querySelector(
            `.key-btn[data-lane="${lane}"]`
          );
          const hitZone = document.querySelector(
            `.hit-zone[data-lane="${lane}"]`
          );

          if (keyBtn) keyBtn.classList.remove("active");
          if (hitZone) hitZone.style.transform = "scale(1)";
        }

        hitLane(lane) {
          const hitZoneRect = document
            .querySelector(`.hit-zone.lane${lane}`)
            .getBoundingClientRect();
          const gameAreaRect = this.gameArea.getBoundingClientRect();

          let closestNote = null;
          let minDistance = Infinity;

          this.notes.forEach((note) => {
            if (note.lane === lane && !note.hit) {
              const noteRect = note.element.getBoundingClientRect();
              const distance = Math.abs(noteRect.bottom - hitZoneRect.top);

              if (distance < minDistance) {
                minDistance = distance;
                closestNote = note;
              }
            }
          });

          if (closestNote) {
            this.processHit(closestNote, minDistance);
          }
        }

        processHit(note, distance) {
          note.hit = true;
          let hitType = "miss";
          let points = 0;

          if (distance < 30) {
            hitType = "perfect";
            points = 100;
            this.combo++;
            this.hitNotes++;
          } else if (distance < 60) {
            hitType = "good";
            points = 50;
            this.combo++;
            this.hitNotes++;
          } else {
            hitType = "miss";
            this.combo = 0;
          }

          // é€£æ“ŠåŠ æˆ
          if (this.combo > 0) {
            points += Math.floor(this.combo / 5) * 10;
          }

          this.score += points;

          // è¦–è¦ºåé¥‹
          note.element.classList.add(hitType);
          this.showHitFeedback(hitType, points);

          setTimeout(() => this.removeNote(note), 500);
          this.updateDisplay();
        }

        missNote(note) {
          if (!note.hit) {
            this.combo = 0;
            this.showHitFeedback("miss", 0);
            this.removeNote(note);
            this.updateDisplay();
          }
        }

        showHitFeedback(hitType, points) {
          const feedback = document.createElement("div");
          feedback.className = "hit-feedback";

          switch (hitType) {
            case "perfect":
              feedback.textContent = "PERFECT!";
              feedback.style.color = "#f39c12";
              break;
            case "good":
              feedback.textContent = "GOOD!";
              feedback.style.color = "#2ecc71";
              break;
            case "miss":
              feedback.textContent = "MISS!";
              feedback.style.color = "#e74c3c";
              break;
          }

          if (points > 0) {
            feedback.textContent += ` +${points}`;
          }

          this.gameArea.appendChild(feedback);
          setTimeout(() => {
            if (feedback.parentNode) {
              feedback.parentNode.removeChild(feedback);
            }
          }, 500);
        }

        removeNote(note) {
          const index = this.notes.findIndex((n) => n.id === note.id);
          if (index !== -1) {
            if (note.element && note.element.parentNode) {
              note.element.parentNode.removeChild(note.element);
            }
            this.notes.splice(index, 1);
          }
        }

        clearNotes() {
          this.notes.forEach((note) => {
            if (note.element && note.element.parentNode) {
              note.element.parentNode.removeChild(note.element);
            }
          });
          this.notes = [];
        }

        levelUp() {
          this.level++;
          this.noteSpeed = Math.max(this.noteSpeed - 100, 1000);
          this.spawnRate = Math.max(this.spawnRate - 50, 400);

          clearInterval(this.spawnInterval);
          this.startSpawning();

          this.status.textContent = `ç­‰ç´šæå‡åˆ° ${this.level}ï¼é€Ÿåº¦å¢åŠ ï¼`;
          setTimeout(() => {
            this.status.textContent = "è·Ÿä¸Šç¯€æ‹ï¼";
          }, 2000);
        }

        updateDisplay() {
          this.scoreEl.textContent = this.score;
          this.comboEl.textContent = this.combo;
          this.levelEl.textContent = this.level;

          const accuracy =
            this.totalNotes > 0
              ? Math.round((this.hitNotes / this.totalNotes) * 100)
              : 100;
          this.accuracyEl.textContent = accuracy + "%";
        }

        pauseGame() {
          if (this.gameActive) {
            this.isPaused = !this.isPaused;
            this.pauseBtn.textContent = this.isPaused ? "ç¹¼çºŒ" : "æš«åœ";
            this.status.textContent = this.isPaused ? "éŠæˆ²å·²æš«åœ" : "éŠæˆ²ç¹¼çºŒ";
          }
        }

        resetGame() {
          this.gameActive = false;
          this.isPaused = false;
          clearInterval(this.spawnInterval);
          clearInterval(this.gameInterval);

          this.score = 0;
          this.combo = 0;
          this.level = 1;
          this.totalNotes = 0;
          this.hitNotes = 0;
          this.gameTime = 0;
          this.noteSpeed = 2000;
          this.spawnRate = 800;

          this.clearNotes();
          this.updateDisplay();
          this.status.textContent =
            "æº–å‚™éŸ³æ³¢ç¯€å¥æŒ‘æˆ°ï¼ä½¿ç”¨éµç›¤ Aã€Sã€Dã€F æˆ–é»æ“ŠæŒ‰éˆ•ï¼";
          this.startBtn.style.display = "inline-block";
          this.pauseBtn.style.display = "none";
        }

        showHelp() {
          const modal = document.getElementById("helpModal");
          if (modal) {
            modal.style.display = "flex";

            // æ·»åŠ é—œé–‰æŒ‰éˆ•äº‹ä»¶ç›£è½å™¨
            const closeBtn = modal.querySelector(".close-help");
            if (closeBtn) {
              closeBtn.onclick = () => this.closeHelp();
            }

            // é»æ“ŠèƒŒæ™¯é—œé–‰
            modal.onclick = (e) => {
              if (e.target === modal) {
                this.closeHelp();
              }
            };

            // ESCéµé—œé–‰
            document.addEventListener("keydown", (e) => {
              if (e.key === "Escape") {
                this.closeHelp();
              }
            });
          }
        }

        closeHelp() {
          const modal = document.getElementById("helpModal");
          if (modal) {
            modal.style.display = "none";
          }
        }
      }

      // åˆå§‹åŒ–éŠæˆ²
      window.addEventListener("load", () => {
        new SoundWaveRush();
      });
    </script>
  </body>
</html>
