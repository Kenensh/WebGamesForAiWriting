<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>é›™æ‰‹å”èª¿ - Dual Hand Sync</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        min-height: 100vh;
        background: linear-gradient(135deg, #ff7979 0%, #74b9ff 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        font-family: "Arial", sans-serif;
        overflow: hidden;
      }

      .game-container {
        width: 90vw;
        height: 90vh;
        max-width: 1000px;
        max-height: 700px;
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        border: 1px solid rgba(255, 255, 255, 0.2);
        padding: 30px;
        text-align: center;
        position: relative;
      }

      h1 {
        color: white;
        font-size: 2.5em;
        margin-bottom: 20px;
        text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
      }

      .game-stats {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 15px;
        margin-bottom: 20px;
        color: white;
        font-size: 1.1em;
      }

      .stat-box {
        background: rgba(255, 255, 255, 0.1);
        padding: 10px;
        border-radius: 10px;
        border: 1px solid rgba(255, 255, 255, 0.2);
      }

      .hands-area {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        height: 400px;
        margin: 20px 0;
      }

      .hand-side {
        background: rgba(0, 0, 0, 0.2);
        border-radius: 15px;
        position: relative;
        overflow: hidden;
        border: 3px solid rgba(255, 255, 255, 0.3);
      }

      .hand-side.left {
        background: linear-gradient(
          135deg,
          rgba(255, 121, 121, 0.3),
          rgba(255, 121, 121, 0.1)
        );
        border-color: #ff7979;
      }

      .hand-side.right {
        background: linear-gradient(
          135deg,
          rgba(116, 185, 255, 0.3),
          rgba(116, 185, 255, 0.1)
        );
        border-color: #74b9ff;
      }

      .hand-label {
        position: absolute;
        top: 10px;
        left: 50%;
        transform: translateX(-50%);
        color: white;
        font-size: 1.5em;
        font-weight: bold;
        text-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
        z-index: 10;
      }

      .target {
        position: absolute;
        width: 60px;
        height: 60px;
        border-radius: 50%;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        color: white;
        text-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
        transition: all 0.3s ease;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        animation: targetPulse 2s infinite;
      }

      .target.left {
        background: linear-gradient(45deg, #ff7979, #fd79a8);
        border: 3px solid #ff7979;
      }

      .target.right {
        background: linear-gradient(45deg, #74b9ff, #0984e3);
        border: 3px solid #74b9ff;
      }

      .target:hover {
        transform: scale(1.1);
      }

      .target.clicked {
        animation: targetExplode 0.5s ease;
      }

      .target.missed {
        animation: targetMiss 0.5s ease;
      }

      @keyframes targetPulse {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.05);
        }
      }

      @keyframes targetExplode {
        0% {
          transform: scale(1);
          opacity: 1;
        }
        50% {
          transform: scale(1.5);
          opacity: 0.7;
        }
        100% {
          transform: scale(2);
          opacity: 0;
        }
      }

      @keyframes targetMiss {
        0% {
          transform: scale(1);
          background: linear-gradient(45deg, #e74c3c, #c0392b);
        }
        100% {
          transform: scale(0.5);
          opacity: 0;
        }
      }

      .sync-meter {
        width: 100%;
        height: 20px;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 10px;
        margin: 20px 0;
        overflow: hidden;
        position: relative;
      }

      .sync-fill {
        height: 100%;
        background: linear-gradient(90deg, #e74c3c, #f39c12, #2ecc71);
        border-radius: 10px;
        transition: width 0.3s ease;
        width: 50%;
      }

      .sync-indicator {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: white;
        font-weight: bold;
        text-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
      }

      .controls {
        display: flex;
        gap: 15px;
        justify-content: center;
        flex-wrap: wrap;
      }

      /* å¹«åŠ©æ¨¡æ…‹æ¡†æ¨£å¼ */
      .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        backdrop-filter: blur(10px);
        align-items: center;
        justify-content: center;
      }

      .modal-content {
        background: linear-gradient(135deg, #ff7979 0%, #74b9ff 100%);
        padding: 30px;
        border-radius: 20px;
        max-width: 600px;
        max-height: 80vh;
        overflow-y: auto;
        color: white;
        position: relative;
        border: 2px solid rgba(255, 255, 255, 0.3);
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
      }

      .modal h2 {
        margin-bottom: 20px;
        text-align: center;
        font-size: 2em;
        text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
      }

      .modal h3 {
        margin: 20px 0 10px 0;
        color: #fff;
        font-size: 1.3em;
      }

      .modal p,
      .modal li {
        margin: 10px 0;
        line-height: 1.6;
        font-size: 1.1em;
      }

      .modal ul {
        margin-left: 20px;
      }

      .close-help {
        position: absolute;
        top: 15px;
        right: 20px;
        color: white;
        font-size: 28px;
        font-weight: bold;
        cursor: pointer;
        background: none;
        border: none;
        padding: 0;
        line-height: 1;
      }

      .close-help:hover {
        color: #ff6b6b;
        transform: scale(1.1);
      }

      @media (max-width: 768px) {
        .game-container {
          width: 95vw;
          height: 95vh;
          padding: 20px;
        }

        h1 {
          font-size: 2em;
        }

        .game-stats {
          grid-template-columns: repeat(2, 1fr);
          font-size: 1em;
        }

        .hands-area {
          height: 350px;
          gap: 10px;
        }

        .target {
          width: 50px;
          height: 50px;
        }
      }
    </style>
  </head>
  <body>
    <div class="game-container">
      <h1>ğŸ‘ é›™æ‰‹å”èª¿</h1>

      <div class="game-stats">
        <div class="stat-box">åˆ†æ•¸: <span id="score">0</span></div>
        <div class="stat-box">ç­‰ç´š: <span id="level">1</span></div>
        <div class="stat-box">åŒæ­¥åº¦: <span id="syncRate">50%</span></div>
        <div class="stat-box">æ™‚é–“: <span id="timer">60</span></div>
      </div>

      <div class="sync-meter">
        <div class="sync-fill" id="syncFill"></div>
        <div class="sync-indicator">åŒæ­¥åº¦</div>
      </div>

      <div class="difficulty-select">
        <button class="btn difficulty-btn active" data-difficulty="normal">
          æ™®é€š
        </button>
        <button class="btn difficulty-btn" data-difficulty="hard">å›°é›£</button>
        <button class="btn difficulty-btn" data-difficulty="extreme">
          æ¥µé™
        </button>
      </div>

      <div class="status" id="status">æº–å‚™é›™æ‰‹å”èª¿æŒ‘æˆ°ï¼åŒæ™‚æ“æ§å…©å´ç›®æ¨™ï¼</div>

      <div class="hands-area">
        <div class="hand-side left" id="leftSide">
          <div class="hand-label">å·¦æ‰‹ (A/S)</div>
          <div class="challenge-mode" id="leftChallenge"></div>
        </div>
        <div class="hand-side right" id="rightSide">
          <div class="hand-label">å³æ‰‹ (â†/â†’)</div>
          <div class="challenge-mode" id="rightChallenge"></div>
        </div>
      </div>

      <div class="key-hints">
        å·¦æ‰‹ä½¿ç”¨ A/S éµ | å³æ‰‹ä½¿ç”¨ â†/â†’ æ–¹å‘éµ | ä¹Ÿå¯é»æ“Šç›®æ¨™
      </div>
      <div class="controls">
        <button class="btn" id="startBtn">é–‹å§‹éŠæˆ²</button>
        <button class="btn" id="pauseBtn" style="display: none">æš«åœ</button>
        <button class="btn" id="resetBtn">é‡æ–°é–‹å§‹</button>
        <button class="btn" id="helpBtn">éŠæˆ²èªªæ˜</button>
      </div>
    </div>

    <!-- å¹«åŠ©æ¨¡æ…‹æ¡† -->
    <div id="helpModal" class="modal">
      <div class="modal-content">
        <button class="close-help">&times;</button>
        <h2>ğŸ‘ é›™æ‰‹å”èª¿ - éŠæˆ²èªªæ˜</h2>

        <h3>ğŸ¯ éŠæˆ²ç›®æ¨™</h3>
        <p>
          åŒæ™‚ä½¿ç”¨å·¦å³æ‰‹æ§åˆ¶å…©å´çš„ç›®æ¨™ï¼Œè¨“ç·´é›™æ‰‹å”èª¿èƒ½åŠ›ã€‚éœ€è¦åœ¨ç›®æ¨™æ¶ˆå¤±å‰æº–ç¢ºé»æ“Šæˆ–ä½¿ç”¨éµç›¤æ“ä½œã€‚
        </p>

        <h3>ğŸ® æ“ä½œæ–¹å¼</h3>
        <ul>
          <li>
            <strong>å·¦æ‰‹å€åŸŸ</strong>ï¼šä½¿ç”¨ A éµï¼ˆå‘ä¸Šï¼‰ã€S
            éµï¼ˆå‘ä¸‹ï¼‰æˆ–ç›´æ¥é»æ“Šç›®æ¨™
          </li>
          <li>
            <strong>å³æ‰‹å€åŸŸ</strong>ï¼šä½¿ç”¨ â† éµï¼ˆå‘å·¦ï¼‰ã€â†’
            éµï¼ˆå‘å³ï¼‰æˆ–ç›´æ¥é»æ“Šç›®æ¨™
          </li>
          <li><strong>åŒæ­¥æ“ä½œ</strong>ï¼šéœ€è¦åŒæ™‚æ§åˆ¶å…©å´ï¼Œæé«˜å”èª¿æ€§</li>
        </ul>

        <h3>ğŸ“Š è¨ˆåˆ†ç³»çµ±</h3>
        <ul>
          <li><strong>å‘½ä¸­ç›®æ¨™</strong>ï¼šæ ¹æ“šé›£åº¦å’Œæ™‚æ©Ÿç²å¾—åˆ†æ•¸</li>
          <li><strong>åŒæ­¥åº¦</strong>ï¼šå·¦å³æ‰‹æ“ä½œè¶ŠåŒæ­¥ï¼Œç²å¾—é¡å¤–åˆ†æ•¸</li>
          <li><strong>é€£æ“Šçå‹µ</strong>ï¼šé€£çºŒå‘½ä¸­å¯ç²å¾—é€£æ“ŠåŠ åˆ†</li>
          <li><strong>ç­‰ç´šæå‡</strong>ï¼šé”åˆ°ä¸€å®šåˆ†æ•¸è‡ªå‹•å‡ç´šï¼Œé›£åº¦å¢åŠ </li>
        </ul>

        <h3>ğŸ† æŒ‘æˆ°æ¨¡å¼</h3>
        <ul>
          <li><strong>æ™®é€šæ¨¡å¼</strong>ï¼šåŸºç¤é€Ÿåº¦å’Œç›®æ¨™æ•¸é‡</li>
          <li><strong>å›°é›£æ¨¡å¼</strong>ï¼šç›®æ¨™ç§»å‹•æ›´å¿«ï¼Œç”Ÿæˆæ›´é »ç¹</li>
          <li><strong>æ¥µé™æ¨¡å¼</strong>ï¼šæ¥µé«˜é›£åº¦ï¼Œè€ƒé©—æ¥µé™å”èª¿èƒ½åŠ›</li>
        </ul>

        <h3>ğŸ’¡ éŠæˆ²æŠ€å·§</h3>
        <ul>
          <li>ä¿æŒç¯€å¥æ„Ÿï¼Œä¸è¦æ€¥èº</li>
          <li>ç·´ç¿’å·¦å³æ‰‹ç¨ç«‹æ“ä½œ</li>
          <li>è§€å¯Ÿå…©å´ç›®æ¨™çš„ç§»å‹•æ¨¡å¼</li>
          <li>åˆ©ç”¨éµç›¤å’Œæ»‘é¼ çš„çµ„åˆæ“ä½œ</li>
          <li>æ³¨æ„åŒæ­¥åº¦æŒ‡æ¨™ï¼Œæé«˜å”èª¿æ€§</li>
        </ul>
      </div>
    </div>

    <script>
      class DualHandSync {
        constructor() {
          this.leftSide = document.getElementById("leftSide");
          this.rightSide = document.getElementById("rightSide");
          this.startBtn = document.getElementById("startBtn");
          this.pauseBtn = document.getElementById("pauseBtn");
          this.resetBtn = document.getElementById("resetBtn");
          this.status = document.getElementById("status");
          this.scoreEl = document.getElementById("score");
          this.levelEl = document.getElementById("level");
          this.syncRateEl = document.getElementById("syncRate");
          this.timerEl = document.getElementById("timer");
          this.syncFill = document.getElementById("syncFill");
          this.leftChallenge = document.getElementById("leftChallenge");
          this.rightChallenge = document.getElementById("rightChallenge");

          this.score = 0;
          this.level = 1;
          this.timeLeft = 60;
          this.gameActive = false;
          this.isPaused = false;
          this.difficulty = "normal";
          this.syncRate = 50;

          this.leftTargets = [];
          this.rightTargets = [];
          this.recentHits = { left: [], right: [] };
          this.challengeMode = { left: "normal", right: "normal" };

          this.keyStates = {
            KeyA: false,
            KeyS: false,
            ArrowLeft: false,
            ArrowRight: false,
          };

          this.difficulties = {
            normal: { spawnRate: 2000, targetLife: 4000, speed: 1 },
            hard: { spawnRate: 1500, targetLife: 3500, speed: 1.3 },
            extreme: { spawnRate: 1200, targetLife: 3000, speed: 1.6 },
          };

          this.spawnInterval = null;
          this.timerInterval = null;
          this.challengeInterval = null;

          this.initializeGame();
        }

        initializeGame() {
          this.startBtn.addEventListener("click", () => this.startGame());
          this.pauseBtn.addEventListener("click", () => this.pauseGame());
          this.resetBtn.addEventListener("click", () => this.resetGame());

          document.addEventListener("keydown", (e) => this.handleKeyDown(e));
          document.addEventListener("keyup", (e) => this.handleKeyUp(e));
          document.querySelectorAll(".difficulty-btn").forEach((btn) => {
            btn.addEventListener("click", (e) =>
              this.setDifficulty(e.target.dataset.difficulty)
            );
          });

          // å¹«åŠ©ç³»çµ±
          const helpBtn = document.getElementById("helpBtn");
          if (helpBtn) {
            helpBtn.addEventListener("click", () => this.showHelp());
          }

          this.updateDisplay();
        }

        setDifficulty(diff) {
          if (this.gameActive) return;

          this.difficulty = diff;
          document.querySelectorAll(".difficulty-btn").forEach((btn) => {
            btn.classList.remove("active");
          });
          document
            .querySelector(`[data-difficulty="${diff}"]`)
            .classList.add("active");
        }

        startGame() {
          this.gameActive = true;
          this.isPaused = false;
          this.score = 0;
          this.level = 1;
          this.timeLeft = 60;
          this.syncRate = 50;
          this.recentHits = { left: [], right: [] };

          this.clearTargets();
          this.updateDisplay();
          this.startSpawning();
          this.startTimer();
          this.startChallengeMode();

          this.startBtn.style.display = "none";
          this.pauseBtn.style.display = "inline-block";
          this.status.textContent = "éŠæˆ²é–‹å§‹ï¼å”èª¿é›™æ‰‹æ“ä½œï¼";
        }

        startSpawning() {
          const config = this.difficulties[this.difficulty];

          this.spawnInterval = setInterval(() => {
            if (!this.isPaused && this.gameActive) {
              // åŒæ™‚åœ¨å…©å´ç”Ÿæˆç›®æ¨™
              this.spawnTarget("left");
              this.spawnTarget("right");
            }
          }, config.spawnRate);
        }

        startTimer() {
          this.timerInterval = setInterval(() => {
            if (!this.isPaused && this.gameActive) {
              this.timeLeft--;
              this.updateDisplay();

              if (this.timeLeft <= 0) {
                this.endGame();
              }

              // æ¯15ç§’æå‡ç­‰ç´š
              if (this.timeLeft % 15 === 0 && this.timeLeft < 60) {
                this.levelUp();
              }
            }
          }, 1000);
        }

        startChallengeMode() {
          this.challengeInterval = setInterval(() => {
            if (!this.isPaused && this.gameActive) {
              // éš¨æ©Ÿè®Šæ›æŒ‘æˆ°æ¨¡å¼
              if (Math.random() < 0.3) {
                this.changeChallenge("left");
              }
              if (Math.random() < 0.3) {
                this.changeChallenge("right");
              }
            }
          }, 5000);
        }

        changeChallenge(side) {
          const challenges = ["normal", "rapid", "precision", "sequence"];
          const newChallenge =
            challenges[Math.floor(Math.random() * challenges.length)];
          this.challengeMode[side] = newChallenge;

          const challengeEl =
            side === "left" ? this.leftChallenge : this.rightChallenge;
          switch (newChallenge) {
            case "rapid":
              challengeEl.textContent = "âš¡ å¿«é€Ÿæ¨¡å¼";
              break;
            case "precision":
              challengeEl.textContent = "ğŸ¯ ç²¾æº–æ¨¡å¼";
              break;
            case "sequence":
              challengeEl.textContent = "ğŸ”¢ é †åºæ¨¡å¼";
              break;
            default:
              challengeEl.textContent = "";
          }

          setTimeout(() => {
            challengeEl.textContent = "";
            this.challengeMode[side] = "normal";
          }, 10000);
        }

        spawnTarget(side) {
          const container = side === "left" ? this.leftSide : this.rightSide;
          const targetArray =
            side === "left" ? this.leftTargets : this.rightTargets;
          const config = this.difficulties[this.difficulty];

          const target = {
            id: Date.now() + Math.random(),
            side: side,
            x: Math.random() * (container.offsetWidth - 80) + 40,
            y: Math.random() * (container.offsetHeight - 120) + 60,
            life: config.targetLife,
            challenge: this.challengeMode[side],
            value: this.getTargetValue(side),
            element: null,
          };

          this.createTargetElement(target);
          targetArray.push(target);

          // è¨­ç½®ç›®æ¨™ç”Ÿå‘½é€±æœŸ
          setTimeout(() => {
            this.removeTarget(target);
            this.updateSyncRate(-5); // æœªé»æ“Šé™ä½åŒæ­¥åº¦
          }, target.life);
        }

        getTargetValue(side) {
          const challenge = this.challengeMode[side];
          switch (challenge) {
            case "rapid":
              return Math.floor(Math.random() * 9) + 1;
            case "precision":
              return "â—";
            case "sequence":
              return String.fromCharCode(65 + Math.floor(Math.random() * 5)); // A-E
            default:
              return "â—";
          }
        }

        createTargetElement(target) {
          const element = document.createElement("div");
          element.className = `target ${target.side}`;
          element.style.left = target.x + "px";
          element.style.top = target.y + "px";
          element.dataset.id = target.id;
          element.textContent = target.value;

          // æ ¹æ“šæŒ‘æˆ°æ¨¡å¼èª¿æ•´å¤–è§€
          switch (target.challenge) {
            case "rapid":
              element.style.animation = "targetPulse 0.5s infinite";
              break;
            case "precision":
              element.style.border = "5px solid #f39c12";
              break;
            case "sequence":
              element.style.fontSize = "1.2em";
              break;
          }

          element.addEventListener("click", () => this.hitTarget(target));
          target.element = element;

          const container =
            target.side === "left" ? this.leftSide : this.rightSide;
          container.appendChild(element);
        }

        handleKeyDown(e) {
          if (!this.gameActive || this.isPaused) return;

          if (this.keyStates.hasOwnProperty(e.code)) {
            if (!this.keyStates[e.code]) {
              this.keyStates[e.code] = true;
              this.handleKeyPress(e.code);
            }
          }
        }

        handleKeyUp(e) {
          if (this.keyStates.hasOwnProperty(e.code)) {
            this.keyStates[e.code] = false;
          }
        }

        handleKeyPress(keyCode) {
          let side, targets;

          if (keyCode === "KeyA" || keyCode === "KeyS") {
            side = "left";
            targets = this.leftTargets;
          } else if (keyCode === "ArrowLeft" || keyCode === "ArrowRight") {
            side = "right";
            targets = this.rightTargets;
          } else {
            return;
          }

          // æ‰¾åˆ°æœ€è¿‘çš„ç›®æ¨™
          const target = this.findClosestTarget(targets);
          if (target) {
            this.hitTarget(target);
          }
        }

        findClosestTarget(targets) {
          if (targets.length === 0) return null;

          // è¿”å›æœ€æ–°ç”Ÿæˆçš„ç›®æ¨™ï¼ˆæœ€å®¹æ˜“é»æ“Šï¼‰
          return targets[targets.length - 1];
        }

        hitTarget(target) {
          const now = Date.now();
          const sideHits = this.recentHits[target.side];

          // è¨˜éŒ„é»æ“Šæ™‚é–“
          sideHits.push(now);
          if (sideHits.length > 5) {
            sideHits.shift();
          }

          // è¨ˆç®—åˆ†æ•¸
          let baseScore = 50;

          switch (target.challenge) {
            case "rapid":
              baseScore = 75;
              break;
            case "precision":
              baseScore = 100;
              break;
            case "sequence":
              baseScore = 80;
              break;
          }

          // ç­‰ç´šåŠ æˆ
          const levelBonus = this.level * 10;
          const totalScore = baseScore + levelBonus;

          this.score += totalScore;

          // æ›´æ–°åŒæ­¥åº¦
          this.updateSyncRate(10);

          // ç›®æ¨™é»æ“Šå‹•ç•«
          target.element.classList.add("clicked");
          setTimeout(() => this.removeTarget(target), 300);

          this.updateDisplay();
        }

        updateSyncRate(change) {
          // æª¢æŸ¥é›™æ‰‹é»æ“Šçš„æ™‚é–“å·®
          const leftHits = this.recentHits.left;
          const rightHits = this.recentHits.right;

          if (leftHits.length > 0 && rightHits.length > 0) {
            const lastLeftHit = leftHits[leftHits.length - 1];
            const lastRightHit = rightHits[rightHits.length - 1];
            const timeDiff = Math.abs(lastLeftHit - lastRightHit);

            // æ™‚é–“å·®è¶Šå°ï¼ŒåŒæ­¥åº¦åŠ æˆè¶Šé«˜
            if (timeDiff < 500) {
              change += 20; // é«˜åŒæ­¥åŠ æˆ
            } else if (timeDiff < 1000) {
              change += 10; // ä¸­åŒæ­¥åŠ æˆ
            }
          }

          this.syncRate = Math.max(0, Math.min(100, this.syncRate + change));

          // åŒæ­¥åº¦å½±éŸ¿åˆ†æ•¸åŠ æˆ
          if (this.syncRate > 80) {
            this.score += 25;
          }

          this.updateSyncMeter();
        }

        updateSyncMeter() {
          this.syncFill.style.width = this.syncRate + "%";

          // æ ¹æ“šåŒæ­¥åº¦æ”¹è®Šé¡è‰²
          if (this.syncRate > 70) {
            this.syncFill.style.background =
              "linear-gradient(90deg, #2ecc71, #27ae60)";
          } else if (this.syncRate > 40) {
            this.syncFill.style.background =
              "linear-gradient(90deg, #f39c12, #e67e22)";
          } else {
            this.syncFill.style.background =
              "linear-gradient(90deg, #e74c3c, #c0392b)";
          }
        }

        removeTarget(target) {
          const targetArray =
            target.side === "left" ? this.leftTargets : this.rightTargets;
          const index = targetArray.findIndex((t) => t.id === target.id);

          if (index !== -1) {
            if (target.element && target.element.parentNode) {
              target.element.parentNode.removeChild(target.element);
            }
            targetArray.splice(index, 1);
          }
        }

        clearTargets() {
          [...this.leftTargets, ...this.rightTargets].forEach((target) => {
            if (target.element && target.element.parentNode) {
              target.element.parentNode.removeChild(target.element);
            }
          });
          this.leftTargets = [];
          this.rightTargets = [];
        }

        levelUp() {
          this.level++;
          const config = this.difficulties[this.difficulty];

          // æå‡é›£åº¦
          clearInterval(this.spawnInterval);
          this.spawnInterval = setInterval(() => {
            if (!this.isPaused && this.gameActive) {
              this.spawnTarget("left");
              this.spawnTarget("right");
            }
          }, Math.max(config.spawnRate - this.level * 100, 800));

          this.status.textContent = `ç­‰ç´šæå‡åˆ° ${this.level}ï¼é€Ÿåº¦å¢åŠ ï¼`;
          setTimeout(() => {
            this.status.textContent = "å”èª¿é›™æ‰‹æ“ä½œï¼";
          }, 2000);
        }

        updateDisplay() {
          this.scoreEl.textContent = this.score;
          this.levelEl.textContent = this.level;
          this.syncRateEl.textContent = Math.round(this.syncRate) + "%";
          this.timerEl.textContent = this.timeLeft;
        }

        pauseGame() {
          if (this.gameActive) {
            this.isPaused = !this.isPaused;
            this.pauseBtn.textContent = this.isPaused ? "ç¹¼çºŒ" : "æš«åœ";
            this.status.textContent = this.isPaused ? "éŠæˆ²å·²æš«åœ" : "éŠæˆ²ç¹¼çºŒ";
          }
        }

        endGame() {
          this.gameActive = false;
          clearInterval(this.spawnInterval);
          clearInterval(this.timerInterval);
          clearInterval(this.challengeInterval);

          this.clearTargets();
          this.status.textContent = `ğŸ‰ éŠæˆ²çµæŸï¼æœ€çµ‚åˆ†æ•¸: ${
            this.score
          } | åŒæ­¥åº¦: ${Math.round(this.syncRate)}%`;
          this.startBtn.style.display = "inline-block";
          this.pauseBtn.style.display = "none";
        }

        resetGame() {
          this.gameActive = false;
          this.isPaused = false;
          clearInterval(this.spawnInterval);
          clearInterval(this.timerInterval);
          clearInterval(this.challengeInterval);

          this.score = 0;
          this.level = 1;
          this.timeLeft = 60;
          this.syncRate = 50;
          this.recentHits = { left: [], right: [] };

          this.clearTargets();
          this.updateDisplay();
          this.updateSyncMeter();

          this.leftChallenge.textContent = "";
          this.rightChallenge.textContent = "";

          this.status.textContent = "æº–å‚™é›™æ‰‹å”èª¿æŒ‘æˆ°ï¼åŒæ™‚æ“æ§å…©å´ç›®æ¨™ï¼";
          this.startBtn.style.display = "inline-block";
          this.pauseBtn.style.display = "none";
        }
        showHelp() {
          const modal = document.getElementById("helpModal");
          if (modal) {
            modal.style.display = "flex";

            // æ·»åŠ é—œé–‰æŒ‰éˆ•äº‹ä»¶ç›£è½å™¨
            const closeBtn = modal.querySelector(".close-help");
            if (closeBtn) {
              closeBtn.onclick = () => this.closeHelp();
            }

            // é»æ“ŠèƒŒæ™¯é—œé–‰
            modal.onclick = (e) => {
              if (e.target === modal) {
                this.closeHelp();
              }
            };

            // ESCéµé—œé–‰
            document.addEventListener("keydown", (e) => {
              if (e.key === "Escape") {
                this.closeHelp();
              }
            });
          }
        }

        closeHelp() {
          const modal = document.getElementById("helpModal");
          if (modal) {
            modal.style.display = "none";
          }
        }
      }

      // åˆå§‹åŒ–éŠæˆ²
      window.addEventListener("load", () => {
        new DualHandSync();
      });
    </script>
  </body>
</html>
