<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title data-translate="games.timeSpaceTracker">æ™‚ç©ºè¿½è¹¤è€… - Time Space Tracker</title>
    <link rel="stylesheet" href="game-styles.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
    />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        min-height: 100vh;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        font-family: "Arial", sans-serif;
        overflow: hidden;
      }

      /* æ§åˆ¶é ­éƒ¨æ¨£å¼ */
      .controls-header {
        position: fixed;
        top: 20px;
        right: 20px;
        display: flex;
        gap: 10px;
        z-index: 1000;
        align-items: center;
      }

      .controls-header .btn {
        padding: 8px 16px;
        font-size: 14px;
        min-width: auto;
      }

      .game-container {
        width: 90vw;
        height: 90vh;
        max-width: 900px;
        max-height: 700px;
        background: var(--game-primary);
        position: relative;
      }

      .game-container::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
      }

      h1 {
        color: white;
        font-size: 2.5em;
        margin-bottom: 20px;
        text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
      }

      /* æ”¹é€²çš„éŠæˆ²ä¿¡æ¯æ¨£å¼ */
      .game-info {
        display: flex;
        justify-content: center;
        gap: 2rem;
        margin-bottom: 2rem;
        position: relative;
        z-index: 1;
      }

      .info-item {
        background: rgba(255, 255, 255, 0.1);
        padding: 1rem 1.5rem;
        border-radius: 15px;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        text-align: center;
        min-width: 120px;
        transition: all 0.3s ease;
      }

      .info-item:hover {
        background: rgba(255, 255, 255, 0.2);
        transform: translateY(-5px) scale(1.05);
      }

      .info-label {
        font-size: 0.9rem;
        opacity: 0.8;
        margin-bottom: 0.5rem;
        color: white;
      }

      .info-value {
        font-size: 1.8rem;
        font-weight: 700;
        color: white;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
      }

      .game-area {
        width: 100%;
        height: 450px;
        background: rgba(0, 0, 0, 0.2);
        border-radius: 15px;
        position: relative;
        margin: 20px 0;
        perspective: 1000px;
        overflow: hidden;
      }

      .dimension-layer {
        position: absolute;
        width: 100%;
        height: 100%;
        transform-style: preserve-3d;
      }

      /* æ”¹é€²çš„éŠæˆ²ç‹€æ…‹è¨Šæ¯ */
      .status {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 15px;
        padding: 1rem;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        position: relative;
        z-index: 1;
      }

      .memory-target {
        position: absolute;
        width: 60px;
        height: 60px;
        border-radius: 50%;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        color: white;
        text-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
        animation: float 2s ease-in-out infinite;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        border: 2px solid rgba(255, 255, 255, 0.3);
        backdrop-filter: blur(5px);
      }

      .memory-target.layer-1 {
        background: linear-gradient(45deg, #ff6b6b, #ee5a52);
        transform: translateZ(0px);
      }

      .memory-target.layer-2 {
        background: linear-gradient(45deg, #4ecdc4, #44a08d);
        transform: translateZ(50px);
      }

      .memory-target.layer-3 {
        background: linear-gradient(45deg, #45b7d1, #96c93d);
        transform: translateZ(100px);
      }

      .memory-target:hover {
        border-color: rgba(255, 255, 255, 0.6);
        box-shadow: 
          0 10px 25px rgba(0, 0, 0, 0.4),
          0 0 20px rgba(255, 255, 255, 0.3);
      }

      .memory-target.clicked {
        animation: clickPulse 0.3s ease;
      }

      .memory-target.correct {
        background: linear-gradient(45deg, #2ecc71, #27ae60) !important;
      }

      .memory-target.wrong {
        background: linear-gradient(45deg, #e74c3c, #c0392b) !important;
      }

      @keyframes float {
        0%,
        100% {
          transform: translateY(0px) rotateY(0deg);
        }
        50% {
          transform: translateY(-10px) rotateY(180deg);
        }
      }

      @keyframes clickPulse {
        0% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.3);
        }
        100% {
          transform: scale(1);
        }
      }

      .controls {
        display: flex;
        gap: 15px;
        justify-content: center;
        flex-wrap: wrap;
      }

      .btn {
        padding: 12px 25px;
        background: linear-gradient(45deg, #667eea, #764ba2);
        color: white;
        border: none;
        border-radius: 25px;
        cursor: pointer;
        font-size: 1em;
        font-weight: bold;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      }

      .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
      }

      .difficulty-select {
        margin-bottom: 20px;
      }

      .difficulty-btn {
        margin: 0 5px;
        padding: 8px 16px;
        font-size: 0.9em;
      }

      .difficulty-btn.active {
        background: linear-gradient(45deg, #2ecc71, #27ae60);
      }

      /* å¹«åŠ©æ¨¡æ…‹æ¡†æ¨£å¼ */
      .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        backdrop-filter: blur(10px);
        align-items: center;
        justify-content: center;
      }

      .modal-content {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        padding: 30px;
        border-radius: 20px;
        max-width: 600px;
        max-height: 80vh;
        overflow-y: auto;
        color: white;
        position: relative;
        border: 2px solid rgba(255, 255, 255, 0.3);
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
      }

      .modal h2 {
        margin-bottom: 20px;
        text-align: center;
        font-size: 2em;
        text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
      }

      .modal h3 {
        margin: 20px 0 10px 0;
        color: #fff;
        font-size: 1.3em;
      }

      .modal p,
      .modal li {
        margin: 10px 0;
        line-height: 1.6;
        font-size: 1.1em;
      }

      .modal ul {
        margin-left: 20px;
      }

      .close-help {
        position: absolute;
        top: 15px;
        right: 20px;
        color: white;
        font-size: 28px;
        font-weight: bold;
        cursor: pointer;
        background: none;
        border: none;
        padding: 0;
        line-height: 1;
      }

      .close-help:hover {
        color: #ff6b6b;
        transform: scale(1.1);
      }

      @media (max-width: 768px) {
        .game-container {
          width: 95vw;
          height: 95vh;
          padding: 20px;
        }

        h1 {
          font-size: 2em;
        }

        .memory-target {
          width: 50px;
          height: 50px;
          font-size: 0.9em;
        }

        .game-area {
          height: 350px;
        }

        .controls-header {
          top: 10px;
          right: 10px;
          gap: 5px;
        }

        .game-info {
          flex-direction: column;
          align-items: center;
          gap: 1rem;
        }

        .info-item {
          min-width: 100px;
          padding: 0.8rem 1rem;
        }
      }
    </style>
  </head>  <body data-theme="light">
    <!-- ä¸»é¡Œå’Œèªè¨€åˆ‡æ› -->
    <div class="controls-header">
      <button id="theme-toggle" aria-label="åˆ‡æ›ä¸»é¡Œ">
        <span class="theme-icon light-icon active">â˜€ï¸</span>
        <span class="theme-icon dark-icon">ğŸŒ™</span>
      </button>
      <button id="language-toggle" aria-label="åˆ‡æ›èªè¨€">
        <span class="lang-icon lang-zh active">ä¸­</span>
        <span class="lang-icon lang-en">EN</span>
      </button>
      <button class="btn" onclick="window.location.href='index.html'" data-translate="btn.back">
        <i class="fas fa-arrow-left"></i> è¿”å›
      </button>
    </div>

    <div class="game-container">
      <h1 class="game-title" data-translate="games.timeSpaceTracker">âš¡ æ™‚ç©ºè¿½è¹¤è€…</h1>      <div class="game-info">
        <div class="info-item">
          <div class="info-label" data-translate="game.level">ç­‰ç´š</div>
          <div class="info-value" id="level">1</div>
        </div>
        <div class="info-item">
          <div class="info-label" data-translate="game.score">åˆ†æ•¸</div>
          <div class="info-value" id="score">0</div>
        </div>
        <div class="info-item">
          <div class="info-label" data-translate="game.time">æ™‚é–“</div>
          <div class="info-value" id="timer">--</div>
        </div>
      </div>

      <div class="progress-bar">
        <div class="progress-fill" id="progressFill"></div>
      </div>      <div class="difficulty-select">
        <button class="btn difficulty-btn active" data-difficulty="easy" data-translate="difficulty.easy">
          ç°¡å–®
        </button>
        <button class="btn difficulty-btn" data-difficulty="normal" data-translate="difficulty.normal">
          æ™®é€š
        </button>
        <button class="btn difficulty-btn" data-difficulty="hard" data-translate="difficulty.hard">å›°é›£</button>
        <button class="btn difficulty-btn" data-difficulty="expert" data-translate="difficulty.expert">
          å°ˆå®¶
        </button>
      </div>

      <div class="status" id="status">
        é»æ“Šé–‹å§‹éŠæˆ²ï¼Œè¨˜ä½ç›®æ¨™å‡ºç¾çš„é †åºå’Œä½ç½®ï¼
      </div>

      <div class="game-area" id="gameArea">
        <div class="dimension-layer" id="dimensionLayer"></div>
        <div class="countdown" id="countdown" style="display: none"></div>
      </div>      <div class="controls">
        <button class="btn primary-button" id="startBtn" data-translate="btn.start">é–‹å§‹éŠæˆ²</button>
        <button class="btn secondary-button" id="resetBtn" data-translate="btn.restart">é‡æ–°é–‹å§‹</button>
        <button class="btn warning" id="pauseBtn" style="display: none" data-translate="btn.pause">æš«åœ</button>
        <button class="btn info" id="helpBtn" data-translate="btn.help">éŠæˆ²èªªæ˜</button>
      </div>
    </div>

    <!-- å¹«åŠ©æ¨¡æ…‹æ¡† -->
    <div id="helpModal" class="modal">
      <div class="modal-content">
        <button class="close-help">&times;</button>
        <h2>âš¡ æ™‚ç©ºè¿½è¹¤è€… - éŠæˆ²èªªæ˜</h2>

        <h3>ğŸ¯ éŠæˆ²ç›®æ¨™</h3>
        <p>
          åœ¨å¤šç¶­ç©ºé–“ä¸­è¨˜ä½ç›®æ¨™å‡ºç¾çš„é †åºå’Œä½ç½®ï¼Œç„¶å¾ŒæŒ‰ç…§æ­£ç¢ºé †åºé»æ“Šå®ƒå€‘ï¼æ¸¬è©¦ä½ çš„ç©ºé–“è¨˜æ†¶èƒ½åŠ›ï¼
        </p>

        <h3>ğŸ® æ“ä½œæ–¹å¼</h3>
        <ul>
          <li>
            <strong>è§€å¯Ÿéšæ®µ</strong>ï¼šä»”ç´°è§€çœ‹ç›®æ¨™åœ¨ä¸åŒç©ºé–“å±¤ç´šä¸­é–ƒç¾çš„é †åº
          </li>
          <li><strong>è¨˜æ†¶éšæ®µ</strong>ï¼šè¨˜ä½æ¯å€‹ç›®æ¨™çš„å‡ºç¾é †åºå’Œä½ç½®</li>
          <li><strong>å›ç­”éšæ®µ</strong>ï¼šæŒ‰ç…§è¨˜æ†¶ä¸­çš„é †åºé»æ“Šç›®æ¨™</li>
        </ul>

        <h3>ğŸŒŒ ç©ºé–“å±¤ç´š</h3>
        <ul>
          <li><strong>ç¬¬1å±¤</strong>ï¼šç´…è‰²ç›®æ¨™ï¼Œä½æ–¼åŸºç¤ç©ºé–“å±¤</li>
          <li><strong>ç¬¬2å±¤</strong>ï¼šé’è‰²ç›®æ¨™ï¼Œä½æ–¼ä¸­ç­‰ç©ºé–“æ·±åº¦</li>
          <li><strong>ç¬¬3å±¤</strong>ï¼šç¶ è‰²ç›®æ¨™ï¼Œä½æ–¼æœ€æ·±ç©ºé–“å±¤ç´š</li>
        </ul>

        <h3>ğŸ“Š è¨ˆåˆ†ç³»çµ±</h3>
        <ul>
          <li><strong>é—œå¡åˆ†æ•¸</strong>ï¼šå®Œæˆæ¯é—œç²å¾—åŸºç¤åˆ†æ•¸</li>
          <li><strong>æ™‚é–“çå‹µ</strong>ï¼šå‰©é¤˜æ™‚é–“è¶Šå¤šï¼Œç²å¾—è¶Šå¤šæ™‚é–“çå‹µ</li>
          <li><strong>é›£åº¦åŠ æˆ</strong>ï¼šæ›´é«˜é›£åº¦æä¾›æ›´å¤šåˆ†æ•¸å€ç‡</li>
          <li><strong>é€£çºŒå®Œæˆ</strong>ï¼šé€£çºŒå®Œæˆé—œå¡ç²å¾—é¡å¤–çå‹µ</li>
        </ul>

        <h3>âš™ï¸ é›£åº¦è¨­å®š</h3>
        <ul>
          <li><strong>ç°¡å–®</strong>ï¼š3å€‹ç›®æ¨™ï¼Œ2å€‹ç©ºé–“å±¤ï¼Œé¡¯ç¤ºæ™‚é–“é•·</li>
          <li><strong>æ™®é€š</strong>ï¼š4å€‹ç›®æ¨™ï¼Œ2å€‹ç©ºé–“å±¤ï¼Œæ¨™æº–æ™‚é–“</li>
          <li><strong>å›°é›£</strong>ï¼š5å€‹ç›®æ¨™ï¼Œ3å€‹ç©ºé–“å±¤ï¼Œé¡¯ç¤ºæ™‚é–“çŸ­</li>
          <li><strong>å°ˆå®¶</strong>ï¼š6å€‹ç›®æ¨™ï¼Œ3å€‹ç©ºé–“å±¤ï¼Œæ¥µçŸ­æ™‚é–“</li>
        </ul>

        <h3>ğŸ’¡ éŠæˆ²æŠ€å·§</h3>
        <ul>
          <li>å°ˆæ³¨è§€å¯Ÿæ¯å€‹ç›®æ¨™çš„ä½ç½®å’Œé †åº</li>
          <li>åˆ©ç”¨ç©ºé–“å±¤ç´šçš„é¡è‰²ä¾†å¹«åŠ©è¨˜æ†¶</li>
          <li>åœ¨å¿ƒä¸­è¤‡è¿°ç›®æ¨™å‡ºç¾çš„é †åº</li>
          <li>ä¿æŒå†·éœï¼Œä¸è¦æ€¥æ–¼é»æ“Š</li>
          <li>éš¨è‘—é—œå¡é€²è¡Œï¼Œç›®æ¨™æ•¸é‡æœƒå¢åŠ </li>
        </ul>
      </div>    </div>

    <script src="languageManager.js"></script>
    <script src="themeManager.js"></script>
    <script>
      class TimeSpaceTracker {
        constructor() {
          this.gameArea = document.getElementById("gameArea");
          this.dimensionLayer = document.getElementById("dimensionLayer");
          this.startBtn = document.getElementById("startBtn");
          this.resetBtn = document.getElementById("resetBtn");
          this.pauseBtn = document.getElementById("pauseBtn");
          this.status = document.getElementById("status");
          this.scoreEl = document.getElementById("score");
          this.levelEl = document.getElementById("level");
          this.timerEl = document.getElementById("timer");
          this.progressFill = document.getElementById("progressFill");
          this.countdown = document.getElementById("countdown");

          this.score = 0;
          this.level = 1;
          this.timeLeft = 0;
          this.gameActive = false;
          this.showingSequence = false;
          this.playerTurn = false;
          this.sequence = [];
          this.playerSequence = [];
          this.currentStep = 0;
          this.difficulty = "easy";
          this.timerInterval = null;

          this.difficulties = {
            easy: { targets: 3, showTime: 1500, layers: 2, timeLimit: 30 },
            normal: { targets: 4, showTime: 1200, layers: 2, timeLimit: 25 },
            hard: { targets: 5, showTime: 1000, layers: 3, timeLimit: 20 },
            expert: { targets: 6, showTime: 800, layers: 3, timeLimit: 15 },
          };

          this.initializeGame();
        }
        initializeGame() {
          this.startBtn.addEventListener("click", () => this.startGame());
          this.resetBtn.addEventListener("click", () => this.resetGame());
          this.pauseBtn.addEventListener("click", () => this.pauseGame());

          // å¹«åŠ©æŒ‰éˆ•äº‹ä»¶
          document
            .getElementById("helpBtn")
            .addEventListener("click", () => this.showHelp());

          document.querySelectorAll(".difficulty-btn").forEach((btn) => {
            btn.addEventListener("click", (e) =>
              this.setDifficulty(e.target.dataset.difficulty)
            );
          });

          this.updateDisplay();
        }

        setDifficulty(diff) {
          if (this.gameActive) return;

          this.difficulty = diff;
          document.querySelectorAll(".difficulty-btn").forEach((btn) => {
            btn.classList.remove("active");
          });
          document
            .querySelector(`[data-difficulty="${diff}"]`)
            .classList.add("active");
        }

        startGame() {
          this.gameActive = true;
          this.score = 0;
          this.level = 1;
          this.setupLevel();
          this.startBtn.style.display = "none";
          this.pauseBtn.style.display = "inline-block";
          this.updateDisplay();
        }

        setupLevel() {
          const config = this.difficulties[this.difficulty];
          this.timeLeft = config.timeLimit;
          this.sequence = [];
          this.playerSequence = [];
          this.currentStep = 0;

          this.clearTargets();
          this.generateSequence();
          this.showCountdown(() => this.showSequence());
        }

        generateSequence() {
          const config = this.difficulties[this.difficulty];
          const sequenceLength = Math.min(
            config.targets + Math.floor(this.level / 3),
            8
          );

          for (let i = 0; i < sequenceLength; i++) {
            const layer = Math.floor(Math.random() * config.layers) + 1;
            const x = Math.random() * (this.gameArea.offsetWidth - 60);
            const y = Math.random() * (this.gameArea.offsetHeight - 60);

            this.sequence.push({
              id: i,
              x: x,
              y: y,
              layer: layer,
              order: i + 1,
            });
          }
        }

        showCountdown(callback) {
          this.countdown.style.display = "block";
          let count = 3;

          const countInterval = setInterval(() => {
            if (count > 0) {
              this.countdown.textContent = count;
              count--;
            } else {
              this.countdown.textContent = "é–‹å§‹ï¼";
              setTimeout(() => {
                this.countdown.style.display = "none";
                callback();
              }, 500);
              clearInterval(countInterval);
            }
          }, 1000);
        }

        showSequence() {
          this.showingSequence = true;
          this.status.textContent = "è¨˜ä½é †åºå’Œä½ç½®ï¼";
          this.playerTurn = false;

          let index = 0;
          const showNext = () => {
            if (index < this.sequence.length) {
              const target = this.sequence[index];
              this.createTarget(target, true);

              setTimeout(() => {
                this.clearTargets();
                index++;
                if (index < this.sequence.length) {
                  setTimeout(showNext, 200);
                } else {
                  this.startPlayerTurn();
                }
              }, this.difficulties[this.difficulty].showTime);
            }
          };

          showNext();
        }

        startPlayerTurn() {
          this.showingSequence = false;
          this.playerTurn = true;
          this.currentStep = 0;
          this.playerSequence = [];

          // é¡¯ç¤ºæ‰€æœ‰ç›®æ¨™
          this.sequence.forEach((target) => {
            this.createTarget(target, false);
          });

          this.status.textContent = `æŒ‰ç…§é †åºé»æ“Šç›®æ¨™ï¼(${
            this.currentStep + 1
          }/${this.sequence.length})`;
          this.startTimer();
        }

        createTarget(targetData, isShow) {
          const target = document.createElement("div");
          target.className = `memory-target layer-${targetData.layer}`;
          target.style.left = targetData.x + "px";
          target.style.top = targetData.y + "px";
          target.dataset.id = targetData.id;
          target.dataset.order = targetData.order;

          if (isShow) {
            target.textContent = targetData.order;
            target.style.transform = `scale(1.2) translateZ(${
              (targetData.layer - 1) * 50
            }px)`;
          } else {
            target.addEventListener("click", () =>
              this.handleTargetClick(targetData)
            );
          }

          this.dimensionLayer.appendChild(target);
        }

        handleTargetClick(targetData) {
          if (!this.playerTurn || this.showingSequence) return;

          const expectedTarget = this.sequence[this.currentStep];
          const target = document.querySelector(`[data-id="${targetData.id}"]`);
          target.classList.add("clicked");

          if (targetData.id === expectedTarget.id) {
            target.classList.add("correct");
            this.playerSequence.push(targetData);
            this.currentStep++;

            if (this.currentStep >= this.sequence.length) {
              this.levelComplete();
            } else {
              this.status.textContent = `æ­£ç¢ºï¼ç¹¼çºŒ... (${
                this.currentStep + 1
              }/${this.sequence.length})`;
              this.updateProgress();
            }
          } else {
            target.classList.add("wrong");
            this.gameOver("é †åºéŒ¯èª¤ï¼");
          }
        }

        levelComplete() {
          this.playerTurn = false;
          clearInterval(this.timerInterval);

          const timeBonus = Math.floor(this.timeLeft * 10);
          const levelBonus = this.level * 100;
          this.score += levelBonus + timeBonus;
          this.level++;

          this.status.textContent = `ç¬¬ ${this.level - 1} é—œå®Œæˆï¼ç²å¾— ${
            levelBonus + timeBonus
          } åˆ†ï¼`;
          this.updateDisplay();

          setTimeout(() => {
            if (this.level <= 10) {
              this.setupLevel();
            } else {
              this.gameWin();
            }
          }, 2000);
        }

        gameWin() {
          this.gameActive = false;
          this.status.textContent = `ğŸ‰ æ­å–œå®Œæˆæ‰€æœ‰é—œå¡ï¼æœ€çµ‚åˆ†æ•¸: ${this.score}`;
          this.endGame();
        }

        gameOver(reason) {
          this.gameActive = false;
          this.status.textContent = `âŒ éŠæˆ²çµæŸï¼${reason} æœ€çµ‚åˆ†æ•¸: ${this.score}`;
          this.endGame();
        }

        startTimer() {
          this.timerInterval = setInterval(() => {
            this.timeLeft--;
            this.updateDisplay();

            if (this.timeLeft <= 0) {
              this.gameOver("æ™‚é–“åˆ°ï¼");
            }
          }, 1000);
        }

        updateProgress() {
          const progress = (this.currentStep / this.sequence.length) * 100;
          this.progressFill.style.width = progress + "%";
        }

        updateDisplay() {
          this.scoreEl.textContent = this.score;
          this.levelEl.textContent = this.level;
          this.timerEl.textContent = this.gameActive ? this.timeLeft : "--";
        }

        clearTargets() {
          this.dimensionLayer.innerHTML = "";
        }

        endGame() {
          clearInterval(this.timerInterval);
          this.clearTargets();
          this.startBtn.style.display = "inline-block";
          this.pauseBtn.style.display = "none";
          this.progressFill.style.width = "0%";
        }

        pauseGame() {
          if (this.gameActive) {
            this.gameActive = false;
            clearInterval(this.timerInterval);
            this.status.textContent = "éŠæˆ²å·²æš«åœ";
            this.pauseBtn.textContent = "ç¹¼çºŒ";
          } else {
            this.gameActive = true;
            if (this.playerTurn) {
              this.startTimer();
            }
            this.status.textContent = "éŠæˆ²ç¹¼çºŒ";
            this.pauseBtn.textContent = "æš«åœ";
          }
        }

        resetGame() {
          this.gameActive = false;
          clearInterval(this.timerInterval);
          this.score = 0;
          this.level = 1;
          this.timeLeft = 0;
          this.clearTargets();
          this.updateDisplay();
          this.status.textContent = "é»æ“Šé–‹å§‹éŠæˆ²ï¼Œè¨˜ä½ç›®æ¨™å‡ºç¾çš„é †åºå’Œä½ç½®ï¼";
          this.startBtn.style.display = "inline-block";
          this.pauseBtn.style.display = "none";
          this.progressFill.style.width = "0%";
        }

        closeHelp() {
          document.getElementById("helpModal").style.display = "none";
        }

        showHelp() {
          const modal = document.getElementById("helpModal");
          if (modal) {
            modal.style.display = "flex";

            // Set up close button event listener
            const closeBtn = modal.querySelector(".close-help");
            if (closeBtn) {
              closeBtn.onclick = () => this.closeHelp();
            }

            // Close when clicking outside the modal
            modal.addEventListener("click", (e) => {
              if (e.target === modal) {
                this.closeHelp();
              }
            });

            // Close with escape key
            document.addEventListener("keydown", (e) => {
              if (e.key === "Escape") {
                this.closeHelp();
              }
            });
          }
        }
      }

      // åˆå§‹åŒ–éŠæˆ²
      window.addEventListener("load", () => {
        new TimeSpaceTracker();
      });
    </script>
  </body>
</html>
