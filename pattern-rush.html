<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>åœ–æ¡ˆå¿«æ‰“ - ç¶²é å°éŠæˆ²</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Arial", sans-serif;
        background: linear-gradient(135deg, #ff6b6b 0%, #4ecdc4 100%);
        min-height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        color: white;
      }

      .game-container {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 20px;
        padding: 30px;
        text-align: center;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        max-width: 900px;
        width: 95%;
      }

      h1 {
        margin-bottom: 20px;
        font-size: 2.5rem;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
      }

      .controls {
        margin-bottom: 20px;
        display: flex;
        justify-content: center;
        gap: 15px;
        flex-wrap: wrap;
      }

      .btn {
        background: rgba(255, 255, 255, 0.2);
        border: 1px solid rgba(255, 255, 255, 0.3);
        color: white;
        padding: 12px 24px;
        border-radius: 25px;
        cursor: pointer;
        font-size: 1rem;
        transition: all 0.3s ease;
        backdrop-filter: blur(5px);
      }

      .btn:hover {
        background: rgba(255, 255, 255, 0.3);
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      }

      .btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        transform: none;
      }

      .difficulty-selector {
        margin: 20px 0;
        display: flex;
        justify-content: center;
        gap: 10px;
        flex-wrap: wrap;
      }

      .difficulty-btn {
        padding: 8px 16px;
        font-size: 0.9rem;
        min-width: 80px;
      }

      .difficulty-btn.active {
        background: rgba(76, 175, 80, 0.7);
        border-color: #4caf50;
      }

      .game-info {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
        gap: 15px;
        margin: 20px 0;
      }

      .info-item {
        background: rgba(255, 255, 255, 0.1);
        padding: 10px;
        border-radius: 10px;
        border: 1px solid rgba(255, 255, 255, 0.2);
      }

      .info-label {
        font-size: 0.8rem;
        opacity: 0.8;
        margin-bottom: 5px;
      }

      .info-value {
        font-size: 1.2rem;
        font-weight: bold;
      }

      .pattern-display {
        background: rgba(255, 255, 255, 0.1);
        border: 2px solid rgba(255, 255, 255, 0.2);
        border-radius: 15px;
        padding: 20px;
        margin: 20px 0;
        min-height: 120px;
        display: flex;
        justify-content: center;
        align-items: center;
        position: relative;
      }

      .pattern {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        justify-content: center;
        align-items: center;
      }

      .pattern-symbol {
        width: 60px;
        height: 60px;
        background: rgba(255, 255, 255, 0.2);
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-radius: 10px;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 1.5rem;
        font-weight: bold;
        transition: all 0.3s ease;
      }

      .pattern-symbol.highlight {
        background: rgba(255, 255, 255, 0.4);
        box-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
        transform: scale(1.1);
      }

      .input-area {
        background: rgba(255, 255, 255, 0.1);
        border: 2px solid rgba(255, 255, 255, 0.2);
        border-radius: 15px;
        padding: 20px;
        margin: 20px 0;
      }

      .symbol-buttons {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
        gap: 10px;
        max-width: 600px;
        margin: 0 auto;
      }

      .symbol-btn {
        width: 80px;
        height: 80px;
        background: rgba(255, 255, 255, 0.2);
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-radius: 15px;
        color: white;
        font-size: 1.8rem;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        justify-content: center;
        align-items: center;
      }

      .symbol-btn:hover {
        background: rgba(255, 255, 255, 0.3);
        transform: scale(1.05);
      }

      .symbol-btn:active {
        transform: scale(0.95);
      }

      .progress-bar {
        width: 100%;
        height: 10px;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 5px;
        overflow: hidden;
        margin: 10px 0;
      }

      .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #4caf50, #8bc34a);
        border-radius: 5px;
        transition: width 0.3s ease;
      }

      .input-display {
        margin: 15px 0;
        font-size: 1.5rem;
        font-weight: bold;
        min-height: 2rem;
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 10px;
      }

      .input-symbol {
        padding: 5px 10px;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 8px;
        border: 1px solid rgba(255, 255, 255, 0.3);
      }

      .input-symbol.correct {
        background: rgba(76, 175, 80, 0.7);
        border-color: #4caf50;
      }

      .input-symbol.incorrect {
        background: rgba(244, 67, 54, 0.7);
        border-color: #f44336;
      }

      .countdown {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 4rem;
        font-weight: bold;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        z-index: 100;
      }

      .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(5px);
      }

      .modal-content {
        background: rgba(255, 255, 255, 0.95);
        color: #333;
        margin: 5% auto;
        padding: 30px;
        border-radius: 15px;
        width: 90%;
        max-width: 500px;
        position: relative;
        backdrop-filter: blur(10px);
      }

      .close {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
        cursor: pointer;
        position: absolute;
        right: 15px;
        top: 10px;
      }

      .close:hover {
        color: #000;
      }

      @media (max-width: 768px) {
        .game-container {
          padding: 20px;
          margin: 10px;
        }

        h1 {
          font-size: 2rem;
        }

        .pattern-symbol {
          width: 50px;
          height: 50px;
          font-size: 1.2rem;
        }

        .symbol-btn {
          width: 70px;
          height: 70px;
          font-size: 1.5rem;
        }

        .controls {
          flex-direction: column;
          align-items: center;
        }

        .btn {
          width: 200px;
        }
      }
    </style>
  </head>
  <body>
    <div class="game-container">
      <h1><i class="fas fa-puzzle-piece"></i> åœ–æ¡ˆå¿«æ‰“</h1>

      <div class="controls">
        <button class="btn" onclick="startGame()" id="startBtn">
          <i class="fas fa-play"></i> é–‹å§‹éŠæˆ²
        </button>
        <button class="btn" onclick="pauseGame()" id="pauseBtn" disabled>
          <i class="fas fa-pause"></i> æš«åœ
        </button>
        <button class="btn" onclick="resetGame()">
          <i class="fas fa-redo"></i> é‡ç½®
        </button>
        <button class="btn" onclick="showHelp()">
          <i class="fas fa-question-circle"></i> èªªæ˜
        </button>
        <button class="btn" onclick="window.location.href='index.html'">
          <i class="fas fa-home"></i> è¿”å›é¸å–®
        </button>
      </div>

      <div class="difficulty-selector">
        <button
          class="btn difficulty-btn active"
          onclick="setDifficulty('easy')"
        >
          ç°¡å–®
        </button>
        <button class="btn difficulty-btn" onclick="setDifficulty('medium')">
          ä¸­ç­‰
        </button>
        <button class="btn difficulty-btn" onclick="setDifficulty('hard')">
          å›°é›£
        </button>
        <button class="btn difficulty-btn" onclick="setDifficulty('expert')">
          å°ˆå®¶
        </button>
      </div>

      <div class="game-info">
        <div class="info-item">
          <div class="info-label">åˆ†æ•¸</div>
          <div class="info-value" id="score">0</div>
        </div>
        <div class="info-item">
          <div class="info-label">é—œå¡</div>
          <div class="info-value" id="level">1</div>
        </div>
        <div class="info-item">
          <div class="info-label">é€£æ“Š</div>
          <div class="info-value" id="streak">0</div>
        </div>
        <div class="info-item">
          <div class="info-label">æº–ç¢ºç‡</div>
          <div class="info-value" id="accuracy">100%</div>
        </div>
        <div class="info-item">
          <div class="info-label">æœ€é«˜åˆ†</div>
          <div class="info-value" id="bestScore">0</div>
        </div>
      </div>

      <div class="pattern-display" id="patternDisplay">
        <div style="font-size: 1.5rem; opacity: 0.7">
          é¸æ“‡é›£åº¦ä¸¦é»æ“Šé–‹å§‹éŠæˆ²
        </div>
      </div>

      <div class="progress-bar">
        <div class="progress-fill" id="progressFill" style="width: 0%"></div>
      </div>

      <div class="input-area">
        <div class="input-display" id="inputDisplay">ç­‰å¾…è¼¸å…¥...</div>

        <div class="symbol-buttons" id="symbolButtons">
          <!-- ç¬¦è™ŸæŒ‰éˆ•å°‡ç”± JavaScript ç”Ÿæˆ -->
        </div>

        <div style="margin-top: 15px">
          <button class="btn" onclick="clearInput()">
            <i class="fas fa-eraser"></i> æ¸…é™¤
          </button>
          <button class="btn" onclick="submitInput()">
            <i class="fas fa-check"></i> ç¢ºèª
          </button>
        </div>
      </div>
    </div>

    <!-- èªªæ˜æ¨¡æ…‹æ¡† -->
    <div id="helpModal" class="modal">
      <div class="modal-content">
        <span class="close" onclick="closeHelp()">&times;</span>
        <h2><i class="fas fa-info-circle"></i> åœ–æ¡ˆå¿«æ‰“èªªæ˜</h2>
        <h3>éŠæˆ²è¦å‰‡ï¼š</h3>
        <ul style="margin: 15px 0; padding-left: 20px">
          <li>è§€å¯Ÿé¡¯ç¤ºçš„åœ–æ¡ˆåºåˆ—</li>
          <li>åœ¨æ™‚é–“é™åˆ¶å…§å¿«é€Ÿé‡ç¾ç›¸åŒåºåˆ—</li>
          <li>ä½¿ç”¨ä¸‹æ–¹æŒ‰éˆ•è¼¸å…¥å°æ‡‰ç¬¦è™Ÿ</li>
          <li>å®Œæˆæ­£ç¢ºåºåˆ—ç²å¾—åˆ†æ•¸ä¸¦é€²å…¥ä¸‹ä¸€é—œ</li>
          <li>éŒ¯èª¤è¼¸å…¥æœƒæ¸›å°‘ç”Ÿå‘½å€¼</li>
        </ul>
        <h3>é›£åº¦å·®ç•°ï¼š</h3>
        <ul style="margin: 15px 0; padding-left: 20px">
          <li><strong>ç°¡å–®ï¼š</strong>3-4å€‹ç¬¦è™Ÿï¼Œè¼ƒé•·æ™‚é–“é™åˆ¶</li>
          <li><strong>ä¸­ç­‰ï¼š</strong>4-5å€‹ç¬¦è™Ÿï¼Œä¸­ç­‰æ™‚é–“é™åˆ¶</li>
          <li><strong>å›°é›£ï¼š</strong>5-6å€‹ç¬¦è™Ÿï¼Œè¼ƒçŸ­æ™‚é–“é™åˆ¶</li>
          <li><strong>å°ˆå®¶ï¼š</strong>6-8å€‹ç¬¦è™Ÿï¼Œæœ€çŸ­æ™‚é–“é™åˆ¶</li>
        </ul>
        <h3>è¨ˆåˆ†ç³»çµ±ï¼š</h3>
        <ul style="margin: 15px 0; padding-left: 20px">
          <li>å®Œæˆåºåˆ—ç²å¾—åŸºç¤åˆ†æ•¸</li>
          <li>é€£çºŒæ­£ç¢ºæœ‰é€£æ“ŠåŠ æˆ</li>
          <li>å‰©é¤˜æ™‚é–“è¶Šå¤šç²å¾—æ™‚é–“çå‹µ</li>
          <li>é—œå¡è¶Šé«˜åˆ†æ•¸å€æ•¸è¶Šå¤§</li>
        </ul>
        <h3>æ“ä½œæç¤ºï¼š</h3>
        <ul style="margin: 15px 0; padding-left: 20px">
          <li>å¯ä»¥ä½¿ç”¨ã€Œæ¸…é™¤ã€æŒ‰éˆ•é‡æ–°è¼¸å…¥</li>
          <li>æŒ‰ã€Œç¢ºèªã€æäº¤ç­”æ¡ˆ</li>
          <li>æ”¯æ´éµç›¤å¿«é€Ÿéµæ“ä½œ</li>
        </ul>
      </div>
    </div>

    <script src="gameUtils.js"></script>
    <script>
      let gameState = "idle"; // idle, playing, paused, gameOver
      let score = 0;
      let level = 1;
      let streak = 0;
      let totalAttempts = 0;
      let correctAttempts = 0;
      let currentPattern = [];
      let userInput = [];
      let timeLeft = 0;
      let maxTime = 0;
      let gameTimer = null;
      let currentDifficulty = "easy";

      // ç¬¦è™Ÿé›†åˆ
      const symbols = [
        "â­",
        "â¤ï¸",
        "ğŸ”¥",
        "âš¡",
        "ğŸ¯",
        "ğŸ®",
        "ğŸš€",
        "ğŸ’",
        "ğŸŒŸ",
        "ğŸ¨",
        "ğŸª",
        "ğŸ­",
      ];

      const difficulties = {
        easy: {
          name: "ç°¡å–®",
          minLength: 3,
          maxLength: 4,
          timePerSymbol: 3,
          symbolCount: 6,
        },
        medium: {
          name: "ä¸­ç­‰",
          minLength: 4,
          maxLength: 5,
          timePerSymbol: 2.5,
          symbolCount: 8,
        },
        hard: {
          name: "å›°é›£",
          minLength: 5,
          maxLength: 6,
          timePerSymbol: 2,
          symbolCount: 10,
        },
        expert: {
          name: "å°ˆå®¶",
          minLength: 6,
          maxLength: 8,
          timePerSymbol: 1.5,
          symbolCount: 12,
        },
      };

      // å¾æœ¬åœ°å­˜å„²è¼‰å…¥æœ€é«˜åˆ†
      function loadBestScore() {
        const saved = localStorage.getItem(`patternRush_${currentDifficulty}`);
        return saved ? parseInt(saved) : 0;
      }

      // ä¿å­˜æœ€é«˜åˆ†
      function saveBestScore() {
        const bestScore = loadBestScore();
        if (score > bestScore) {
          localStorage.setItem(
            `patternRush_${currentDifficulty}`,
            score.toString()
          );
          return true;
        }
        return false;
      }

      // è¨­ç½®é›£åº¦
      function setDifficulty(difficulty) {
        if (gameState === "playing") return;

        currentDifficulty = difficulty;

        // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
        document.querySelectorAll(".difficulty-btn").forEach((btn) => {
          btn.classList.remove("active");
        });
        event.target.classList.add("active");

        // æ›´æ–°æœ€é«˜åˆ†é¡¯ç¤º
        updateBestScore();

        // é‡æ–°ç”Ÿæˆç¬¦è™ŸæŒ‰éˆ•
        generateSymbolButtons();
      }

      // æ›´æ–°æœ€é«˜åˆ†é¡¯ç¤º
      function updateBestScore() {
        document.getElementById("bestScore").textContent = loadBestScore();
      }

      // ç”Ÿæˆç¬¦è™ŸæŒ‰éˆ•
      function generateSymbolButtons() {
        const container = document.getElementById("symbolButtons");
        const difficulty = difficulties[currentDifficulty];
        const availableSymbols = symbols.slice(0, difficulty.symbolCount);

        container.innerHTML = availableSymbols
          .map(
            (symbol) =>
              `<button class="symbol-btn" onclick="addSymbol('${symbol}')">${symbol}</button>`
          )
          .join("");
      }

      // é–‹å§‹éŠæˆ²
      function startGame() {
        if (gameState === "playing") return;

        gameState = "playing";
        score = 0;
        level = 1;
        streak = 0;
        totalAttempts = 0;
        correctAttempts = 0;

        document.getElementById("startBtn").disabled = true;
        document.getElementById("pauseBtn").disabled = false;

        updateUI();
        startCountdown();
      }

      // é–‹å§‹å€’æ•¸
      function startCountdown() {
        let count = 3;
        showCountdown(count);

        const countdownTimer = setInterval(() => {
          count--;
          if (count > 0) {
            showCountdown(count);
          } else {
            hideCountdown();
            generateNewPattern();
            clearInterval(countdownTimer);
          }
        }, 1000);
      }

      // é¡¯ç¤ºå€’æ•¸
      function showCountdown(count) {
        const patternDisplay = document.getElementById("patternDisplay");
        patternDisplay.innerHTML = `<div class="countdown">${count}</div>`;
      }

      // éš±è—å€’æ•¸
      function hideCountdown() {
        // å€’æ•¸çµæŸå¾Œæœƒè¢«æ–°åœ–æ¡ˆæ›¿æ›
      }

      // ç”Ÿæˆæ–°åœ–æ¡ˆ
      function generateNewPattern() {
        if (gameState !== "playing") return;

        const difficulty = difficulties[currentDifficulty];
        const availableSymbols = symbols.slice(0, difficulty.symbolCount);

        // è¨ˆç®—åœ–æ¡ˆé•·åº¦ï¼ˆéš¨é—œå¡å¢åŠ ï¼‰
        const baseLength = difficulty.minLength + Math.floor((level - 1) / 3);
        const patternLength = Math.min(baseLength, difficulty.maxLength);

        // ç”Ÿæˆéš¨æ©Ÿåœ–æ¡ˆ
        currentPattern = [];
        for (let i = 0; i < patternLength; i++) {
          currentPattern.push(
            availableSymbols[
              Math.floor(Math.random() * availableSymbols.length)
            ]
          );
        }

        // è¨ˆç®—æ™‚é–“é™åˆ¶
        maxTime = Math.ceil(currentPattern.length * difficulty.timePerSymbol);
        timeLeft = maxTime;

        // é¡¯ç¤ºåœ–æ¡ˆ
        displayPattern();

        // æ¸…ç©ºç”¨æˆ¶è¼¸å…¥
        userInput = [];
        updateInputDisplay();

        // é–‹å§‹è¨ˆæ™‚
        startTimer();
      }

      // é¡¯ç¤ºåœ–æ¡ˆ
      function displayPattern() {
        const patternDisplay = document.getElementById("patternDisplay");
        patternDisplay.innerHTML = `
                <div class="pattern">
                    ${currentPattern
                      .map(
                        (symbol, index) =>
                          `<div class="pattern-symbol" style="animation-delay: ${
                            index * 0.2
                          }s">${symbol}</div>`
                      )
                      .join("")}
                </div>
            `;

        // é€å€‹é«˜äº®é¡¯ç¤º
        const symbols = patternDisplay.querySelectorAll(".pattern-symbol");
        symbols.forEach((symbolElement, index) => {
          setTimeout(() => {
            symbolElement.classList.add("highlight");
            setTimeout(() => symbolElement.classList.remove("highlight"), 500);
          }, index * 300);
        });
      }

      // é–‹å§‹è¨ˆæ™‚
      function startTimer() {
        clearInterval(gameTimer);
        gameTimer = setInterval(() => {
          timeLeft--;
          updateProgressBar();

          if (timeLeft <= 0) {
            timeUp();
          }
        }, 1000);
      }

      // æ›´æ–°é€²åº¦æ¢
      function updateProgressBar() {
        const progress = (timeLeft / maxTime) * 100;
        document.getElementById("progressFill").style.width = progress + "%";
      }

      // æ·»åŠ ç¬¦è™Ÿåˆ°è¼¸å…¥
      function addSymbol(symbol) {
        if (gameState !== "playing") return;
        if (userInput.length >= currentPattern.length) return;

        userInput.push(symbol);
        updateInputDisplay();

        // è‡ªå‹•æª¢æŸ¥æ˜¯å¦å®Œæˆ
        if (userInput.length === currentPattern.length) {
          setTimeout(submitInput, 500);
        }
      }

      // æ¸…é™¤è¼¸å…¥
      function clearInput() {
        if (gameState !== "playing") return;
        userInput = [];
        updateInputDisplay();
      }

      // æ›´æ–°è¼¸å…¥é¡¯ç¤º
      function updateInputDisplay() {
        const inputDisplay = document.getElementById("inputDisplay");

        if (userInput.length === 0) {
          inputDisplay.innerHTML = "ç­‰å¾…è¼¸å…¥...";
          return;
        }

        inputDisplay.innerHTML = userInput
          .map((symbol, index) => {
            let className = "input-symbol";
            if (index < currentPattern.length) {
              if (symbol === currentPattern[index]) {
                className += " correct";
              } else {
                className += " incorrect";
              }
            }
            return `<span class="${className}">${symbol}</span>`;
          })
          .join("");
      }

      // æäº¤è¼¸å…¥
      function submitInput() {
        if (gameState !== "playing" || userInput.length === 0) return;

        totalAttempts++;
        const isCorrect = arraysEqual(userInput, currentPattern);

        if (isCorrect) {
          correctAttempts++;
          streak++;

          // è¨ˆç®—åˆ†æ•¸
          const baseScore = currentPattern.length * 100;
          const timeBonus = Math.floor(timeLeft * 10);
          const streakBonus = streak * 50;
          const levelMultiplier = 1 + (level - 1) * 0.1;

          const roundScore = Math.floor(
            (baseScore + timeBonus + streakBonus) * levelMultiplier
          );
          score += roundScore;

          level++;

          // é¡¯ç¤ºæˆåŠŸæ•ˆæœ
          showSuccess(roundScore);

          // å»¶é²ç”Ÿæˆä¸‹ä¸€é—œ
          setTimeout(() => {
            generateNewPattern();
          }, 1500);
        } else {
          streak = 0;

          // é¡¯ç¤ºå¤±æ•—æ•ˆæœ
          showFailure();

          // é‡æ–°é–‹å§‹ç•¶å‰é—œå¡
          setTimeout(() => {
            generateNewPattern();
          }, 1500);
        }

        updateUI();
      }

      // é¡¯ç¤ºæˆåŠŸæ•ˆæœ
      function showSuccess(roundScore) {
        const patternDisplay = document.getElementById("patternDisplay");
        patternDisplay.innerHTML = `
                <div style="color: #4CAF50; font-size: 2rem; font-weight: bold;">
                    <i class="fas fa-check-circle"></i><br>
                    æ­£ç¢ºï¼<br>
                    <span style="font-size: 1.2rem;">+${roundScore} åˆ†</span>
                </div>
            `;
      }

      // é¡¯ç¤ºå¤±æ•—æ•ˆæœ
      function showFailure() {
        const patternDisplay = document.getElementById("patternDisplay");
        patternDisplay.innerHTML = `
                <div style="color: #f44336; font-size: 2rem; font-weight: bold;">
                    <i class="fas fa-times-circle"></i><br>
                    éŒ¯èª¤ï¼<br>
                    <span style="font-size: 1rem;">æ­£ç¢ºç­”æ¡ˆï¼š${currentPattern.join(
                      " "
                    )}</span>
                </div>
            `;
      }

      // æ™‚é–“åˆ°
      function timeUp() {
        clearInterval(gameTimer);
        streak = 0;
        totalAttempts++;

        const patternDisplay = document.getElementById("patternDisplay");
        patternDisplay.innerHTML = `
                <div style="color: #ff9800; font-size: 2rem; font-weight: bold;">
                    <i class="fas fa-clock"></i><br>
                    æ™‚é–“åˆ°ï¼<br>
                    <span style="font-size: 1rem;">æ­£ç¢ºç­”æ¡ˆï¼š${currentPattern.join(
                      " "
                    )}</span>
                </div>
            `;

        updateUI();

        // é‡æ–°é–‹å§‹ç•¶å‰é—œå¡
        setTimeout(() => {
          generateNewPattern();
        }, 2000);
      }

      // æš«åœéŠæˆ²
      function pauseGame() {
        if (gameState !== "playing") return;

        gameState = "paused";
        clearInterval(gameTimer);

        document.getElementById("startBtn").disabled = false;
        document.getElementById("pauseBtn").disabled = true;

        const patternDisplay = document.getElementById("patternDisplay");
        patternDisplay.innerHTML = `
                <div style="font-size: 2rem; font-weight: bold;">
                    <i class="fas fa-pause"></i><br>
                    éŠæˆ²å·²æš«åœ
                </div>
            `;
      }

      // é‡ç½®éŠæˆ²
      function resetGame() {
        gameState = "idle";
        clearInterval(gameTimer);

        score = 0;
        level = 1;
        streak = 0;
        totalAttempts = 0;
        correctAttempts = 0;
        currentPattern = [];
        userInput = [];
        timeLeft = 0;

        document.getElementById("startBtn").disabled = false;
        document.getElementById("pauseBtn").disabled = true;

        const patternDisplay = document.getElementById("patternDisplay");
        patternDisplay.innerHTML = `
                <div style="font-size: 1.5rem; opacity: 0.7;">
                    é¸æ“‡é›£åº¦ä¸¦é»æ“Šé–‹å§‹éŠæˆ²
                </div>
            `;

        document.getElementById("inputDisplay").innerHTML = "ç­‰å¾…è¼¸å…¥...";
        document.getElementById("progressFill").style.width = "0%";

        updateUI();
      }

      // æ¯”è¼ƒæ•¸çµ„æ˜¯å¦ç›¸ç­‰
      function arraysEqual(a, b) {
        if (a.length !== b.length) return false;
        for (let i = 0; i < a.length; i++) {
          if (a[i] !== b[i]) return false;
        }
        return true;
      }

      // æ›´æ–°UI
      function updateUI() {
        document.getElementById("score").textContent = score;
        document.getElementById("level").textContent = level;
        document.getElementById("streak").textContent = streak;

        const accuracy =
          totalAttempts > 0
            ? Math.round((correctAttempts / totalAttempts) * 100)
            : 100;
        document.getElementById("accuracy").textContent = accuracy + "%";
      }

      // éµç›¤äº‹ä»¶
      document.addEventListener("keydown", (e) => {
        if (gameState !== "playing") return;

        if (e.code === "Backspace") {
          e.preventDefault();
          if (userInput.length > 0) {
            userInput.pop();
            updateInputDisplay();
          }
        } else if (e.code === "Enter") {
          e.preventDefault();
          submitInput();
        } else if (e.code === "Escape") {
          e.preventDefault();
          clearInput();
        }
      });

      // é¡¯ç¤ºèªªæ˜
      function showHelp() {
        document.getElementById("helpModal").style.display = "block";
      }

      // é—œé–‰èªªæ˜
      function closeHelp() {
        document.getElementById("helpModal").style.display = "none";
      }

      // é»æ“Šæ¨¡æ…‹æ¡†å¤–éƒ¨é—œé–‰
      window.onclick = function (event) {
        const modal = document.getElementById("helpModal");
        if (event.target === modal) {
          modal.style.display = "none";
        }
      };

      // åˆå§‹åŒ–
      document.addEventListener("DOMContentLoaded", () => {
        updateBestScore();
        generateSymbolButtons();
        updateUI();
      });
    </script>
  </body>
</html>
