<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>å–®å­—æ‹¼åœ– - ç¶²é å°éŠæˆ²</title>
    <meta name="game-id" content="word-scramble" />
    <meta name="game-name" content="å–®å­—æ‹¼åœ–" />
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="styles.css" />
    <style>
      .game-container {
        position: relative;
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 20px;
      }

      .word-scramble-container {
        width: 100%;
        max-width: 700px;
        margin: 0 auto;
        background-color: #fff;
        border-radius: 8px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        padding: 20px;
      }

      .game-header-info {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        flex-wrap: wrap;
        gap: 15px;
      }

      .game-stats {
        display: flex;
        gap: 15px;
      }

      .stat-item {
        padding: 10px 15px;
        background-color: #f5f5f5;
        border-radius: 5px;
        text-align: center;
        min-width: 80px;
      }

      .stat-label {
        font-size: 14px;
        color: #666;
        margin-bottom: 5px;
      }

      .stat-value {
        font-size: 20px;
        font-weight: bold;
        color: var(--primary-color);
      }

      .timer {
        display: flex;
        align-items: center;
        padding: 8px 15px;
        background-color: var(--primary-color);
        color: white;
        border-radius: 5px;
        font-weight: 500;
        gap: 8px;
      }

      .timer-icon {
        font-size: 20px;
      }

      .timer-value {
        font-size: 20px;
        font-family: "Courier New", monospace;
      }

      .word-display {
        text-align: center;
        margin-bottom: 30px;
      }

      .scrambled-word {
        font-size: 2.5rem;
        font-weight: bold;
        letter-spacing: 5px;
        margin-bottom: 10px;
        color: #333;
      }

      .word-hint {
        font-size: 1rem;
        color: #666;
        margin-top: 10px;
      }

      .guess-section {
        margin-bottom: 25px;
      }

      .guess-input-container {
        display: flex;
        margin-bottom: 15px;
      }

      .guess-input {
        flex: 1;
        padding: 12px 15px;
        font-size: 18px;
        border: 2px solid #ccc;
        border-radius: 5px 0 0 5px;
        outline: none;
        transition: border-color 0.2s;
      }

      .guess-input:focus {
        border-color: var(--primary-color);
      }

      .submit-btn {
        padding: 12px 25px;
        font-size: 18px;
        background-color: var(--primary-color);
        color: white;
        border: none;
        border-radius: 0 5px 5px 0;
        cursor: pointer;
        transition: all 0.2s;
      }

      .submit-btn:hover {
        background-color: var(--primary-hover);
      }

      .feedback {
        padding: 12px 15px;
        border-radius: 5px;
        font-weight: 500;
        margin-top: 10px;
        display: none;
      }

      .feedback.correct {
        display: block;
        background-color: rgba(76, 175, 80, 0.2);
        color: #2e7d32;
      }

      .feedback.incorrect {
        display: block;
        background-color: rgba(244, 67, 54, 0.2);
        color: #c62828;
      }

      .letter-buttons {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        margin-bottom: 20px;
        justify-content: center;
      }

      .letter-btn {
        width: 50px;
        height: 50px;
        font-size: 20px;
        font-weight: bold;
        background-color: #f0f0f0;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .letter-btn:hover {
        background-color: #e0e0e0;
        transform: translateY(-2px);
      }

      .letter-btn.selected {
        background-color: var(--primary-color);
        color: white;
      }

      .hint-btn {
        background-color: #ff9800;
        color: white;
        border: none;
        border-radius: 5px;
        padding: 10px 15px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        gap: 5px;
      }

      .hint-btn:hover {
        background-color: #f57c00;
      }

      .hint-icon {
        font-size: 18px;
      }

      .skip-btn {
        background-color: #9e9e9e;
        color: white;
        border: none;
        border-radius: 5px;
        padding: 10px 15px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        gap: 5px;
      }

      .skip-btn:hover {
        background-color: #757575;
      }

      .skip-icon {
        font-size: 18px;
      }

      .action-buttons {
        display: flex;
        gap: 10px;
        justify-content: center;
        margin-top: 20px;
      }

      .progress-bar-container {
        width: 100%;
        height: 10px;
        background-color: #e0e0e0;
        border-radius: 5px;
        margin-top: 20px;
        overflow: hidden;
      }

      .progress-bar {
        height: 100%;
        background-color: var(--primary-color);
        width: 0%;
        transition: width 0.3s;
      }

      .language-selector {
        margin-bottom: 20px;
        text-align: center;
      }

      .language-buttons {
        display: flex;
        gap: 10px;
        justify-content: center;
        margin-top: 10px;
      }

      .language-btn {
        background-color: #e0e0e0;
        border: none;
        border-radius: 5px;
        padding: 8px 15px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s;
      }

      .language-btn:hover {
        background-color: #d0d0d0;
      }

      .language-btn.active {
        background-color: var(--primary-color);
        color: white;
      }

      .difficulty-selector {
        margin-bottom: 20px;
        text-align: center;
      }

      .difficulty-buttons {
        display: flex;
        gap: 10px;
        justify-content: center;
        margin-top: 10px;
      }

      .difficulty-btn {
        background-color: #e0e0e0;
        border: none;
        border-radius: 5px;
        padding: 8px 15px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s;
      }

      .difficulty-btn:hover {
        background-color: #d0d0d0;
      }

      .difficulty-btn.active {
        background-color: var(--primary-color);
        color: white;
      }

      .game-controls {
        display: flex;
        justify-content: center;
        gap: 15px;
        margin-top: 20px;
      }

      .control-btn {
        background-color: var(--primary-color);
        color: white;
        border: none;
        border-radius: 5px;
        padding: 10px 20px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s;
      }

      .control-btn:hover {
        background-color: var(--primary-hover);
      }

      @media (max-width: 600px) {
        .game-header-info {
          flex-direction: column;
          align-items: stretch;
        }

        .game-stats {
          justify-content: space-between;
        }

        .timer {
          justify-content: center;
        }

        .scrambled-word {
          font-size: 2rem;
          letter-spacing: 3px;
        }

        .letter-btn {
          width: 40px;
          height: 40px;
        }
      }
    </style>
  </head>
  <body>
    <header class="site-header">
      <div class="container">
        <a href="index.html" class="site-title">ç¶²é å°éŠæˆ²</a>
        <nav class="site-nav">
          <ul>
            <li><a href="index.html#games">éŠæˆ²åˆ—è¡¨</a></li>
            <li><a href="index.html#about">é—œæ–¼</a></li>
          </ul>
        </nav>
      </div>
    </header>

    <main class="container">
      <div class="game-header">
        <h1>å–®å­—æ‹¼åœ–</h1>
        <div class="game-toolbar">
          <button id="helpButton" class="tool-button">éŠæˆ²èªªæ˜</button>
          <button id="pauseButton" class="tool-button">æš«åœ</button>
          <button id="restartButton" class="tool-button">é‡æ–°é–‹å§‹</button>
          <button id="homeButton" class="tool-button">è¿”å›é¦–é </button>
        </div>
      </div>

      <div class="game-container">
        <div class="language-selector">
          <h3>é¸æ“‡èªè¨€</h3>
          <div class="language-buttons">
            <button class="language-btn active" data-lang="zh-TW">
              ç¹é«”ä¸­æ–‡
            </button>
            <button class="language-btn" data-lang="en">è‹±æ–‡</button>
          </div>
        </div>

        <div class="difficulty-selector">
          <h3>é¸æ“‡é›£åº¦</h3>
          <div class="difficulty-buttons">
            <button class="difficulty-btn active" data-difficulty="easy">
              ç°¡å–®
            </button>
            <button class="difficulty-btn" data-difficulty="medium">
              ä¸­ç­‰
            </button>
            <button class="difficulty-btn" data-difficulty="hard">å›°é›£</button>
          </div>
        </div>

        <div class="word-scramble-container">
          <div class="game-header-info">
            <div class="game-stats">
              <div class="stat-item">
                <div class="stat-label">åˆ†æ•¸</div>
                <div class="stat-value" id="score">0</div>
              </div>
              <div class="stat-item">
                <div class="stat-label">é—œå¡</div>
                <div class="stat-value" id="level">1/10</div>
              </div>
            </div>
            <div class="timer">
              <span class="timer-icon">â±ï¸</span>
              <span class="timer-value" id="timer">60</span>
            </div>
          </div>

          <div class="word-display">
            <div class="scrambled-word" id="scrambledWord">å–®å­—æ‹¼åœ–</div>
            <div class="word-hint" id="wordHint"></div>
          </div>

          <div class="guess-section">
            <div class="guess-input-container">
              <input
                type="text"
                id="guessInput"
                class="guess-input"
                placeholder="è¼¸å…¥ä½ çš„ç­”æ¡ˆ..."
                autocomplete="off"
              />
              <button id="submitBtn" class="submit-btn">ç¢ºå®š</button>
            </div>
            <div id="feedback" class="feedback"></div>
          </div>

          <div class="letter-buttons" id="letterButtons"></div>

          <div class="action-buttons">
            <button id="hintBtn" class="hint-btn">
              <span class="hint-icon">ğŸ’¡</span>
              <span>æç¤º</span>
            </button>
            <button id="skipBtn" class="skip-btn">
              <span class="skip-icon">â­ï¸</span>
              <span>è·³é</span>
            </button>
          </div>

          <div class="progress-bar-container">
            <div class="progress-bar" id="progressBar"></div>
          </div>
        </div>

        <div class="game-controls">
          <button id="newGameBtn" class="control-btn">æ–°éŠæˆ²</button>
        </div>
      </div>

      <div id="gamePaused" class="game-paused">æš«åœä¸­</div>
    </main>

    <script src="gameUtils.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // åˆå§‹åŒ–éŠæˆ²å·¥å…·
        const helpModal = new GameUtils.Modal(
          "helpModal",
          "éŠæˆ²èªªæ˜",
          `
          <h3>å–®å­—æ‹¼åœ–éŠæˆ²èªªæ˜</h3>
          <p>å–®å­—æ‹¼åœ–æ˜¯ä¸€æ¬¾æ–‡å­—è§£è¬éŠæˆ²ï¼Œä½ éœ€è¦å°‡æ‰“äº‚çš„å­—æ¯é‡æ–°æ’åˆ—æˆæ­£ç¢ºçš„å–®å­—ã€‚</p>
          <h4>éŠæˆ²è¦å‰‡ï¼š</h4>
          <ul>
            <li>æ¯é—œæœƒçµ¦ä½ ä¸€å€‹å­—æ¯é †åºè¢«æ‰“äº‚çš„å–®å­—</li>
            <li>ä½ éœ€è¦åœ¨æ™‚é–“å…§çŒœå‡ºæ­£ç¢ºçš„åŸå§‹å–®å­—</li>
            <li>å¯ä»¥ç›´æ¥è¼¸å…¥ç­”æ¡ˆæˆ–é»æ“Šä¸‹æ–¹å­—æ¯æŒ‰éˆ•çµ„åˆç­”æ¡ˆ</li>
            <li>æ¯é—œæœ‰60ç§’çš„æ™‚é–“é™åˆ¶</li>
            <li>æ­£ç¢ºç­”æ¡ˆå¯ä»¥ç²å¾—åˆ†æ•¸ï¼Œè¶Šé›£çš„å–®å­—åˆ†æ•¸è¶Šé«˜</li>
          </ul>
          <h4>åŠŸèƒ½èªªæ˜ï¼š</h4>
          <ul>
            <li><strong>æç¤ºæŒ‰éˆ•</strong>ï¼šæ­ç¤ºä¸€å€‹æœªçŸ¥çš„å­—æ¯ä½ç½®ï¼Œä½†æœƒæ‰£é™¤åˆ†æ•¸</li>
            <li><strong>è·³éæŒ‰éˆ•</strong>ï¼šè·³éç•¶å‰å–®å­—ï¼Œä½†ä¸æœƒç²å¾—åˆ†æ•¸</li>
            <li><strong>èªè¨€é¸æ“‡</strong>ï¼šå¯é¸æ“‡ç¹é«”ä¸­æ–‡æˆ–è‹±æ–‡å–®å­—</li>
            <li><strong>é›£åº¦é¸æ“‡</strong>ï¼šå½±éŸ¿å–®å­—çš„é•·åº¦å’Œè¤‡é›œåº¦</li>
          </ul>
          <h4>è¨ˆåˆ†æ–¹å¼ï¼š</h4>
          <ul>
            <li>åŸºç¤åˆ†æ•¸ï¼šæ ¹æ“šå–®å­—é•·åº¦å’Œé›£åº¦æ±ºå®š(5-20åˆ†)</li>
            <li>æ™‚é–“çå‹µï¼šå‰©é¤˜æ™‚é–“è¶Šå¤šï¼Œçå‹µåˆ†æ•¸è¶Šé«˜</li>
            <li>é€£çºŒç­”å°çå‹µï¼šé€£çºŒç­”å°æœƒæœ‰é¡å¤–åŠ åˆ†</li>
            <li>ä½¿ç”¨æç¤ºæ‰£åˆ†ï¼šæ¯æ¬¡æç¤ºæ‰£é™¤2åˆ†</li>
          </ul>
          <p>å®Œæˆæ‰€æœ‰é—œå¡å¾Œï¼Œå°‡ç²å¾—é¡å¤–çš„å®Œæˆçå‹µï¼</p>
        `
        );

        const gameController = new GameUtils.GameController();
        const scoreManager = new GameUtils.ScoreManager("wordScrambleScore", 0);

        // DOM å…ƒç´ 
        const scrambledWordDisplay = document.getElementById("scrambledWord");
        const wordHintDisplay = document.getElementById("wordHint");
        const guessInput = document.getElementById("guessInput");
        const submitBtn = document.getElementById("submitBtn");
        const feedbackDisplay = document.getElementById("feedback");
        const scoreDisplay = document.getElementById("score");
        const levelDisplay = document.getElementById("level");
        const timerDisplay = document.getElementById("timer");
        const letterButtons = document.getElementById("letterButtons");
        const hintBtn = document.getElementById("hintBtn");
        const skipBtn = document.getElementById("skipBtn");
        const progressBar = document.getElementById("progressBar");
        const newGameBtn = document.getElementById("newGameBtn");
        const languageButtons = document.querySelectorAll(".language-btn");
        const difficultyButtons = document.querySelectorAll(".difficulty-btn");

        // éŠæˆ²è®Šæ•¸
        let currentWord = "";
        let scrambledWord = "";
        let currentHint = "";
        let revealedLetters = [];
        let currentLevel = 0;
        let maxLevels = 10;
        let language = "zh-TW"; // zh-TW æˆ– en
        let difficulty = "easy"; // easy, medium, hard
        let timer = 60;
        let timerInterval = null;
        let gameActive = false;
        let streak = 0; // é€£çºŒç­”å°æ¬¡æ•¸
        let usedWords = []; // å·²ä½¿ç”¨çš„å–®å­—

        // å–®å­—è³‡æ–™åº«
        const wordDatabase = {
          "zh-TW": {
            easy: [
              { word: "è˜‹æœ", hint: "å¸¸è¦‹çš„ç´…è‰²æ°´æœ" },
              { word: "é¦™è•‰", hint: "é»ƒè‰²å½æ›²çš„æ°´æœ" },
              { word: "é›»è…¦", hint: "ç”¨ä¾†å·¥ä½œå’Œä¸Šç¶²çš„è¨­å‚™" },
              { word: "æ›¸æœ¬", hint: "é–±è®€çš„ç‰©å“" },
              { word: "æ™‚é–“", hint: "ç„¡æ³•å€’æµçš„æ±è¥¿" },
              { word: "æœ‹å‹", hint: "ç”Ÿæ´»ä¸­é‡è¦çš„äºº" },
              { word: "å­¸æ ¡", hint: "å­¸ç¿’çš„åœ°æ–¹" },
              { word: "å¤©ç©º", hint: "æŠ¬é ­çœ‹è¦‹çš„æ™¯è±¡" },
              { word: "éŸ³æ¨‚", hint: "è½è¦ºçš„è—è¡“" },
              { word: "åŸå¸‚", hint: "äººå£å¯†é›†çš„åœ°å€" },
              { word: "èŠ±æœµ", hint: "ç¾éº—çš„æ¤ç‰©" },
              { word: "æœˆäº®", hint: "å¤œç©ºä¸­çš„å¤©é«”" },
              { word: "é¢¨é›¨", hint: "å¸¸è¦‹çš„å¤©æ°£ç¾è±¡" },
              { word: "é™½å…‰", hint: "å¤ªé™½ç™¼å‡ºçš„å…‰èŠ’" },
              { word: "æµ·æ´‹", hint: "å¤§ç‰‡çš„æ°´åŸŸ" },
            ],
            medium: [
              { word: "é›»è…¦ç¨‹å¼", hint: "æŒ‡ç¤ºé›»è…¦åŸ·è¡Œä»»å‹™çš„æŒ‡ä»¤é›†" },
              { word: "äººå·¥æ™ºèƒ½", hint: "æ¨¡æ“¬äººé¡æ€è€ƒçš„æŠ€è¡“" },
              { word: "ç”Ÿç‰©ç§‘æŠ€", hint: "åˆ©ç”¨ç”Ÿç‰©ç³»çµ±çš„ç§‘å­¸" },
              { word: "ç’°å¢ƒä¿è­·", hint: "ç¶­è­·è‡ªç„¶ç”Ÿæ…‹çš„è¡Œå‹•" },
              { word: "æ–‡åŒ–å‚³æ‰¿", hint: "å°‡å‚³çµ±åƒ¹å€¼ä»£ä»£ç›¸å‚³" },
              { word: "ç¶“æ¿Ÿç™¼å±•", hint: "ç¤¾æœƒè²¡å¯Œå¢é•·éç¨‹" },
              { word: "åœ‹éš›é—œä¿‚", hint: "åœ‹å®¶ä¹‹é–“çš„äº’å‹•" },
              { word: "ç¤¾æœƒç§‘å­¸", hint: "ç ”ç©¶äººé¡ç¤¾æœƒçš„å­¸ç§‘" },
              { word: "æ­·å²éºè·¡", hint: "éå»æ–‡æ˜çš„å¯¦ç‰©éºç•™" },
              { word: "è—è¡“å‰µä½œ", hint: "è¡¨é”æƒ…æ„Ÿå’Œæ€æƒ³çš„ä½œå“" },
              { word: "æ•™è‚²æ”¹é©", hint: "æå‡å­¸ç¿’æ•ˆæœçš„è®Šé©" },
              { word: "ç§‘å­¸å¯¦é©—", hint: "é©—è­‰å‡è¨­çš„éç¨‹" },
              { word: "å¥åº·ç”Ÿæ´»", hint: "ç¶­æŒèº«å¿ƒå¹³è¡¡çš„æ–¹å¼" },
              { word: "å‰µæ–°æ€ç¶­", hint: "çªç ´å¸¸è¦çš„æƒ³æ³•" },
              { word: "ç¶²è·¯å®‰å…¨", hint: "ä¿è­·æ•¸ä½è³‡æ–™çš„æªæ–½" },
            ],
            hard: [
              { word: "é‡å­åŠ›å­¸ç†è«–", hint: "æè¿°å¾®è§€ä¸–ç•Œçš„ç‰©ç†å­¸åˆ†æ”¯" },
              { word: "ç”Ÿç‰©å¤šæ¨£æ€§ä¿è‚²", hint: "ä¿è­·å„ç¨®ç”Ÿç‰©ç‰©ç¨®çš„è¡Œå‹•" },
              { word: "äººé¡åŸºå› çµ„è¨ˆåŠƒ", hint: "è§£ç¢¼äººé¡DNAåºåˆ—çš„ç ”ç©¶" },
              { word: "å…¨çƒæ°£å€™è®Šé·è¶¨å‹¢", hint: "åœ°çƒæ°£å€™é•·æœŸæ”¹è®Šçš„æ–¹å‘" },
              { word: "æ–‡è—å¾©èˆˆæ™‚æœŸè—è¡“", hint: "14-17ä¸–ç´€æ­æ´²çš„è—è¡“é‹å‹•" },
              { word: "ç¶“æ¿Ÿå…¨çƒåŒ–å½±éŸ¿", hint: "ä¸–ç•Œç¶“æ¿Ÿæ•´åˆçš„çµæœ" },
              { word: "ç¥ç¶“ç§‘å­¸ç ”ç©¶é€²å±•", hint: "äº†è§£å¤§è…¦åŠŸèƒ½çš„æœ€æ–°ç™¼ç¾" },
              { word: "å¤ªç©ºæ¢ç´¢æŠ€è¡“ç™¼å±•", hint: "ç”¨æ–¼æ¢ç´¢å®‡å®™çš„ç§‘æŠ€é€²æ­¥" },
              { word: "äººå·¥æ™ºèƒ½å€«ç†å•é¡Œ", hint: "AIç™¼å±•å¸¶ä¾†çš„é“å¾·è€ƒé‡" },
              { word: "æ–‡åŒ–éºç”¢æ•¸ä½ä¿å­˜", hint: "ç”¨æ•¸ä½æ–¹å¼è¨˜éŒ„æ–‡åŒ–éºç”¢" },
              { word: "æ•™è‚²é«”åˆ¶æ”¹é©æ–¹å‘", hint: "å­¸æ ¡æ•™è‚²ç³»çµ±çš„è®Šé©è¶¨å‹¢" },
              { word: "ç’°å¢ƒå¯æŒçºŒç™¼å±•ç­–ç•¥", hint: "ä¸æå®³æœªä¾†çš„ç™¼å±•æ¨¡å¼" },
              { word: "ç¶²è·¯å®‰å…¨é˜²è­·æªæ–½", hint: "ä¿è­·æ•¸ä½ç³»çµ±çš„æ–¹æ³•" },
              { word: "å…¬å…±è¡›ç”Ÿå±æ©Ÿç®¡ç†", hint: "æ‡‰å°å¤§è¦æ¨¡å¥åº·å¨è„…çš„æ–¹æ³•" },
              { word: "è—è¡“å‰µä½œå¿ƒç†æ­·ç¨‹", hint: "è—è¡“å®¶å‰µä½œæ™‚çš„å¿ƒç†æ´»å‹•" },
            ],
          },
          en: {
            easy: [
              { word: "apple", hint: "A common red fruit" },
              { word: "water", hint: "Essential liquid for life" },
              { word: "house", hint: "A place to live" },
              { word: "music", hint: "Sounds that are pleasant to hear" },
              { word: "happy", hint: "Feeling joy" },
              { word: "light", hint: "Makes things visible" },
              { word: "sleep", hint: "Rest at night" },
              { word: "plant", hint: "Living organism that grows in soil" },
              { word: "river", hint: "Flowing body of water" },
              { word: "cloud", hint: "White mass in the sky" },
              { word: "table", hint: "Furniture with a flat top" },
              { word: "bread", hint: "Food made from flour" },
              { word: "chair", hint: "Furniture for sitting" },
              { word: "dance", hint: "Moving to music" },
              { word: "smile", hint: "Expression of happiness" },
            ],
            medium: [
              {
                word: "computer",
                hint: "Electronic device for processing data",
              },
              { word: "mountain", hint: "Large natural elevation of earth" },
              { word: "education", hint: "Process of learning" },
              { word: "adventure", hint: "Exciting or dangerous experience" },
              { word: "chemistry", hint: "Science of matter and substances" },
              { word: "language", hint: "System of communication" },
              {
                word: "telescope",
                hint: "Instrument to observe distant objects",
              },
              { word: "beautiful", hint: "Pleasing to the senses" },
              { word: "exercise", hint: "Physical activity for fitness" },
              {
                word: "industry",
                hint: "Economic activity of processing goods",
              },
              { word: "challenge", hint: "Task that tests abilities" },
              { word: "universe", hint: "All of space and time" },
              { word: "painting", hint: "Art form using colors on surface" },
              { word: "balanced", hint: "Equal distribution of weight" },
              { word: "question", hint: "Request for information" },
            ],
            hard: [
              {
                word: "encyclopaedia",
                hint: "Reference work with information on all branches of knowledge",
              },
              {
                word: "photosynthesis",
                hint: "Process by which plants convert light to energy",
              },
              {
                word: "entrepreneurship",
                hint: "Process of starting and running a business",
              },
              {
                word: "communication",
                hint: "Exchange of information between individuals",
              },
              {
                word: "biodiversity",
                hint: "Variety of plant and animal life in a habitat",
              },
              {
                word: "philosophical",
                hint: "Relating to the study of fundamental nature of knowledge",
              },
              {
                word: "extraterrestrial",
                hint: "Originating or existing outside earth",
              },
              {
                word: "sustainability",
                hint: "Ability to maintain at a certain rate or level",
              },
              {
                word: "technological",
                hint: "Relating to or involving technology",
              },
              {
                word: "responsibility",
                hint: "State of being accountable for something",
              },
              { word: "contemporary", hint: "Belonging to the present time" },
              { word: "advantageous", hint: "Providing an advantage" },
              {
                word: "collaboration",
                hint: "Working with others to produce something",
              },
              {
                word: "enthusiastic",
                hint: "Having or showing intense interest",
              },
              {
                word: "constitutional",
                hint: "Relating to an established set of principles",
              },
            ],
          },
        };

        // æ‰“äº‚å–®å­—
        function scrambleWord(word) {
          const wordArray = Array.from(word);
          // ç¢ºä¿æ‰“äº‚å¾Œçš„å–®å­—èˆ‡åŸå–®å­—ä¸åŒ
          let scrambled;
          do {
            // Fisher-Yates æ´—ç‰Œç®—æ³•
            for (let i = wordArray.length - 1; i > 0; i--) {
              const j = Math.floor(Math.random() * (i + 1));
              [wordArray[i], wordArray[j]] = [wordArray[j], wordArray[i]];
            }
            scrambled = wordArray.join("");
          } while (scrambled === word);

          return scrambled;
        }

        // é¸æ“‡å–®å­—
        function selectWord() {
          const words = wordDatabase[language][difficulty];

          // éæ¿¾å‡ºæœªä½¿ç”¨éçš„å–®å­—
          const availableWords = words.filter(
            (w) => !usedWords.includes(w.word)
          );

          // å¦‚æœæ‰€æœ‰å–®å­—éƒ½ç”¨éäº†ï¼Œé‡ç½®å·²ç”¨å–®å­—åˆ—è¡¨
          if (availableWords.length === 0) {
            usedWords = [];
            return words[Math.floor(Math.random() * words.length)];
          }

          // éš¨æ©Ÿé¸æ“‡ä¸€å€‹æœªä½¿ç”¨çš„å–®å­—
          const selectedWord =
            availableWords[Math.floor(Math.random() * availableWords.length)];
          usedWords.push(selectedWord.word);

          return selectedWord;
        }

        // å‰µå»ºå­—æ¯æŒ‰éˆ•
        function createLetterButtons(word) {
          letterButtons.innerHTML = "";

          const letters = Array.from(word);

          letters.forEach((letter) => {
            const button = document.createElement("button");
            button.className = "letter-btn";
            button.textContent = letter;
            button.addEventListener("click", () => {
              if (!gameActive || gameController.paused) return;

              // æ·»åŠ å­—æ¯åˆ°è¼¸å…¥æ¡†
              guessInput.value += letter;

              // ç¦ç”¨æŒ‰éˆ•
              button.disabled = true;
              button.classList.add("selected");
            });

            letterButtons.appendChild(button);
          });
        }

        // é‡ç½®å­—æ¯æŒ‰éˆ•
        function resetLetterButtons() {
          const buttons = letterButtons.querySelectorAll(".letter-btn");
          buttons.forEach((button) => {
            button.disabled = false;
            button.classList.remove("selected");
          });
        }

        // é¡¯ç¤ºä¸‹ä¸€å€‹å–®å­—
        function showNextWord() {
          if (currentLevel >= maxLevels) {
            completeGame();
            return;
          }

          currentLevel++;
          levelDisplay.textContent = `${currentLevel}/${maxLevels}`;

          // é¸æ“‡å–®å­—
          const wordData = selectWord();
          currentWord = wordData.word;
          currentHint = wordData.hint;

          // æ‰“äº‚å–®å­—
          scrambledWord = scrambleWord(currentWord);

          // é¡¯ç¤ºæ‰“äº‚çš„å–®å­—å’Œæç¤º
          scrambledWordDisplay.textContent = scrambledWord;
          wordHintDisplay.textContent = "";

          // é‡ç½®å·²æ­ç¤ºçš„å­—æ¯
          revealedLetters = Array(currentWord.length).fill(false);

          // å‰µå»ºå­—æ¯æŒ‰éˆ•
          createLetterButtons(scrambledWord);

          // æ¸…ç©ºè¼¸å…¥æ¡†å’Œåé¥‹
          guessInput.value = "";
          feedbackDisplay.className = "feedback";
          feedbackDisplay.style.display = "none";

          // æ›´æ–°é€²åº¦æ¢
          progressBar.style.width = `${(currentLevel / maxLevels) * 100}%`;

          // é‡ç½®è¨ˆæ™‚å™¨
          resetTimer();
        }

        // æª¢æŸ¥ç­”æ¡ˆ
        function checkAnswer() {
          if (!gameActive || gameController.paused) return;

          const guess = guessInput.value.trim();

          if (guess === "") {
            return;
          }

          if (guess === currentWord) {
            // ç­”å°
            feedbackDisplay.className = "feedback correct";
            feedbackDisplay.textContent = "ç­”å°äº†ï¼";
            feedbackDisplay.style.display = "block";

            // è¨ˆç®—å¾—åˆ†
            let baseScore;
            switch (difficulty) {
              case "easy":
                baseScore = 5;
                break;
              case "medium":
                baseScore = 10;
                break;
              case "hard":
                baseScore = 15;
                break;
              default:
                baseScore = 5;
            }

            // é¡å¤–åŠ åˆ† - å–®å­—é•·åº¦
            const lengthBonus = Math.floor(currentWord.length / 2);

            // é¡å¤–åŠ åˆ† - å‰©é¤˜æ™‚é–“
            const timeBonus = Math.floor(timer / 10);

            // é€£çºŒç­”å°çå‹µ
            streak++;
            const streakBonus = Math.floor(streak / 3);

            const totalScore =
              baseScore + lengthBonus + timeBonus + streakBonus;
            scoreManager.add(totalScore);
            scoreDisplay.textContent = scoreManager.getCurrentScore();

            // å»¶é²é¡¯ç¤ºä¸‹ä¸€é¡Œ
            setTimeout(() => {
              showNextWord();
            }, 1500);
          } else {
            // ç­”éŒ¯
            feedbackDisplay.className = "feedback incorrect";
            feedbackDisplay.textContent = "ä¸æ­£ç¢ºï¼Œè«‹å†è©¦ä¸€æ¬¡ï¼";
            feedbackDisplay.style.display = "block";

            // é‡è¨­é€£çºŒç­”å°
            streak = 0;
          }

          // æ¸…ç©ºè¼¸å…¥æ¡†ä¸¦é‡ç½®å­—æ¯æŒ‰éˆ•
          guessInput.value = "";
          resetLetterButtons();
        }

        // æä¾›æç¤º
        function showHint() {
          if (!gameActive || gameController.paused) return;

          // è¨­ç½®æç¤ºæ–‡å­—
          if (wordHintDisplay.textContent === "") {
            wordHintDisplay.textContent = `æç¤º: ${currentHint}`;

            // æ‰£åˆ†
            const penalty = 2;
            const newScore = Math.max(
              0,
              scoreManager.getCurrentScore() - penalty
            );
            scoreManager.set(newScore);
            scoreDisplay.textContent = newScore;

            // é¡¯ç¤ºæç¤ºçµ¦äºˆçš„åé¥‹
            feedbackDisplay.className = "feedback";
            feedbackDisplay.textContent = `å·²é¡¯ç¤ºæç¤º (-${penalty}åˆ†)`;
            feedbackDisplay.style.display = "block";

            // è‡ªå‹•éš±è—åé¥‹
            setTimeout(() => {
              feedbackDisplay.style.display = "none";
            }, 2000);
          } else {
            // æ­ç¤ºä¸€å€‹å­—æ¯
            // æ‰¾å‡ºé‚„æœªæ­ç¤ºçš„å­—æ¯ä½ç½®
            const hiddenPositions = revealedLetters
              .map((revealed, index) => ({ revealed, index }))
              .filter((item) => !item.revealed)
              .map((item) => item.index);

            if (hiddenPositions.length > 0) {
              // éš¨æ©Ÿé¸æ“‡ä¸€å€‹æœªæ­ç¤ºçš„ä½ç½®
              const randomIndex = Math.floor(
                Math.random() * hiddenPositions.length
              );
              const position = hiddenPositions[randomIndex];

              // æ›´æ–°å·²æ­ç¤ºçš„å­—æ¯é™£åˆ—
              revealedLetters[position] = true;

              // åœ¨è¼¸å…¥æ¡†ä¸­é¡¯ç¤ºé€™å€‹å­—æ¯
              const letter = currentWord[position];

              // åœ¨è¼¸å…¥æ¡†çš„æ­£ç¢ºä½ç½®å¡«å…¥å­—æ¯
              let currentGuess = guessInput.value;
              while (currentGuess.length < position) {
                currentGuess += " "; // ç”¨ç©ºæ ¼å¡«å……
              }

              if (currentGuess.length === position) {
                currentGuess += letter;
              } else {
                // æ›¿æ›æŒ‡å®šä½ç½®çš„å­—ç¬¦
                currentGuess =
                  currentGuess.substring(0, position) +
                  letter +
                  currentGuess.substring(position + 1);
              }

              guessInput.value = currentGuess;

              // æ‰£åˆ†
              const penalty = 2;
              const newScore = Math.max(
                0,
                scoreManager.getCurrentScore() - penalty
              );
              scoreManager.set(newScore);
              scoreDisplay.textContent = newScore;

              // é¡¯ç¤ºæç¤ºçµ¦äºˆçš„åé¥‹
              feedbackDisplay.className = "feedback";
              feedbackDisplay.textContent = `å·²æ­ç¤ºä¸€å€‹å­—æ¯ (-${penalty}åˆ†)`;
              feedbackDisplay.style.display = "block";

              // è‡ªå‹•éš±è—åé¥‹
              setTimeout(() => {
                feedbackDisplay.style.display = "none";
              }, 2000);
            } else {
              // æ‰€æœ‰å­—æ¯éƒ½å·²æ­ç¤º
              feedbackDisplay.className = "feedback";
              feedbackDisplay.textContent = `æ‰€æœ‰å­—æ¯å·²ç¶“æ­ç¤ºï¼Œç­”æ¡ˆæ˜¯: ${currentWord}`;
              feedbackDisplay.style.display = "block";
            }
          }
        }

        // è·³éç•¶å‰å–®å­—
        function skipWord() {
          if (!gameActive || gameController.paused) return;

          feedbackDisplay.className = "feedback";
          feedbackDisplay.textContent = `å·²è·³éï¼Œæ­£ç¢ºç­”æ¡ˆæ˜¯: ${currentWord}`;
          feedbackDisplay.style.display = "block";

          // é‡è¨­é€£çºŒç­”å°
          streak = 0;

          // å»¶é²é¡¯ç¤ºä¸‹ä¸€é¡Œ
          setTimeout(() => {
            showNextWord();
          }, 2000);
        }

        // æ›´æ–°è¨ˆæ™‚å™¨
        function updateTimer() {
          if (timer > 0) {
            timer--;
            timerDisplay.textContent = timer;

            // æ™‚é–“å°‘æ–¼10ç§’æ™‚ï¼Œæ·»åŠ è¦–è¦ºæç¤º
            if (timer <= 10) {
              timerDisplay.style.color = "#f44336";
            } else {
              timerDisplay.style.color = "white";
            }
          } else {
            // æ™‚é–“ç”¨å®Œ
            clearInterval(timerInterval);

            feedbackDisplay.className = "feedback incorrect";
            feedbackDisplay.textContent = `æ™‚é–“åˆ°ï¼æ­£ç¢ºç­”æ¡ˆæ˜¯: ${currentWord}`;
            feedbackDisplay.style.display = "block";

            // é‡è¨­é€£çºŒç­”å°
            streak = 0;

            // å»¶é²é¡¯ç¤ºä¸‹ä¸€é¡Œ
            setTimeout(() => {
              showNextWord();
            }, 2000);
          }
        }

        // é‡ç½®è¨ˆæ™‚å™¨
        function resetTimer() {
          clearInterval(timerInterval);
          timer = 60;
          timerDisplay.textContent = timer;
          timerDisplay.style.color = "white";

          if (gameActive) {
            timerInterval = setInterval(updateTimer, 1000);
          }
        }

        // å®ŒæˆéŠæˆ²
        function completeGame() {
          gameActive = false;
          clearInterval(timerInterval);

          // è¨ˆç®—å®Œæˆçå‹µ
          const completionBonus =
            50 * (difficulty === "easy" ? 1 : difficulty === "medium" ? 2 : 3);
          scoreManager.add(completionBonus);
          scoreDisplay.textContent = scoreManager.getCurrentScore();

          // ä¿å­˜æœ€é«˜åˆ†
          const bestScoreKey = `wordScramble_best_score_${language}_${difficulty}`;
          const currentBestScore = localStorage.getItem(bestScoreKey) || 0;

          if (scoreManager.getCurrentScore() > currentBestScore) {
            localStorage.setItem(bestScoreKey, scoreManager.getCurrentScore());
          }

          // é¡¯ç¤ºå®Œæˆè¨Šæ¯
          scrambledWordDisplay.textContent = "éŠæˆ²å®Œæˆï¼";
          wordHintDisplay.textContent = "";

          gameController.endGame(
            scoreManager.getCurrentScore(),
            `æ­å–œï¼ä½ å®Œæˆäº†æ‰€æœ‰ ${maxLevels} é—œï¼\n` +
              `æœ€çµ‚åˆ†æ•¸: ${scoreManager.getCurrentScore()}\n` +
              `å®Œæˆçå‹µ: +${completionBonus}`
          );
        }

        // åˆ‡æ›èªè¨€
        function switchLanguage(lang) {
          language = lang;

          // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
          languageButtons.forEach((btn) => {
            btn.classList.toggle("active", btn.dataset.lang === language);
          });
        }

        // åˆ‡æ›é›£åº¦
        function switchDifficulty(diff) {
          difficulty = diff;

          // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
          difficultyButtons.forEach((btn) => {
            btn.classList.toggle(
              "active",
              btn.dataset.difficulty === difficulty
            );
          });

          // æ ¹æ“šé›£åº¦è¨­ç½®é—œå¡æ•¸
          switch (difficulty) {
            case "easy":
              maxLevels = 10;
              break;
            case "medium":
              maxLevels = 15;
              break;
            case "hard":
              maxLevels = 20;
              break;
            default:
              maxLevels = 10;
          }
        }

        // é–‹å§‹æ–°éŠæˆ²
        function startNewGame() {
          // é‡ç½®éŠæˆ²è®Šæ•¸
          currentLevel = 0;
          usedWords = [];
          streak = 0;

          // é‡ç½®åˆ†æ•¸
          scoreManager.reset();
          scoreDisplay.textContent = "0";

          // å•Ÿå‹•éŠæˆ²
          gameActive = true;

          // é¡¯ç¤ºç¬¬ä¸€å€‹å–®å­—
          showNextWord();
        }

        // è¨­ç½®äº‹ä»¶ç›£è½å™¨
        submitBtn.addEventListener("click", checkAnswer);

        guessInput.addEventListener("keypress", (e) => {
          if (e.key === "Enter") {
            checkAnswer();
          }
        });

        hintBtn.addEventListener("click", showHint);
        skipBtn.addEventListener("click", skipWord);
        newGameBtn.addEventListener("click", startNewGame);

        languageButtons.forEach((btn) => {
          btn.addEventListener("click", () => {
            if (
              gameActive &&
              !confirm("åˆ‡æ›èªè¨€å°‡é‡æ–°é–‹å§‹éŠæˆ²ï¼Œç¢ºå®šè¦ç¹¼çºŒå—ï¼Ÿ")
            ) {
              return;
            }

            switchLanguage(btn.dataset.lang);
            startNewGame();
          });
        });

        difficultyButtons.forEach((btn) => {
          btn.addEventListener("click", () => {
            if (
              gameActive &&
              !confirm("åˆ‡æ›é›£åº¦å°‡é‡æ–°é–‹å§‹éŠæˆ²ï¼Œç¢ºå®šè¦ç¹¼çºŒå—ï¼Ÿ")
            ) {
              return;
            }

            switchDifficulty(btn.dataset.difficulty);
            startNewGame();
          });
        });

        // è¨­ç½®éŠæˆ²æ§åˆ¶å™¨
        gameController.setPauseHandler(() => {
          if (gameActive) {
            clearInterval(timerInterval);
          }
        });

        gameController.setResumeHandler(() => {
          if (gameActive) {
            timerInterval = setInterval(updateTimer, 1000);
          }
        });

        gameController.setRestartHandler(() => {
          startNewGame();
        });

        // é–‹å§‹éŠæˆ²å‹•ç•«
        gameController.showStartAnimation(() => {
          startNewGame();
        });
      });
    </script>
  </body>
</html>
