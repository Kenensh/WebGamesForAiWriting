<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>æ¥µé€Ÿé€£æ“Š - Combo Storm</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        min-height: 100vh;
        background: linear-gradient(135deg, #ff9a56 0%, #ff6b95 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        font-family: "Arial", sans-serif;
        overflow: hidden;
      }

      .game-container {
        width: 90vw;
        height: 90vh;
        max-width: 900px;
        max-height: 700px;
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        border: 1px solid rgba(255, 255, 255, 0.2);
        padding: 30px;
        text-align: center;
        position: relative;
      }

      h1 {
        color: white;
        font-size: 2.5em;
        margin-bottom: 20px;
        text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
      }

      .game-stats {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 15px;
        margin-bottom: 20px;
        color: white;
        font-size: 1.1em;
      }

      .stat-box {
        background: rgba(255, 255, 255, 0.1);
        padding: 10px;
        border-radius: 10px;
        border: 1px solid rgba(255, 255, 255, 0.2);
      }

      .game-area {
        width: 100%;
        height: 400px;
        background: rgba(0, 0, 0, 0.2);
        border-radius: 15px;
        position: relative;
        margin: 20px 0;
        overflow: hidden;
      }

      .combo-target {
        position: absolute;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        color: white;
        text-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
        transition: all 0.2s ease;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      }

      .combo-target.type-normal {
        background: linear-gradient(45deg, #3498db, #2980b9);
      }

      .combo-target.type-fast {
        background: linear-gradient(45deg, #e74c3c, #c0392b);
        animation: pulse 0.8s infinite;
      }

      .combo-target.type-double {
        background: linear-gradient(45deg, #f39c12, #d68910);
        border: 3px solid #fff;
      }

      .combo-target.type-chain {
        background: linear-gradient(45deg, #9b59b6, #8e44ad);
        box-shadow: 0 0 20px rgba(155, 89, 182, 0.6);
      }

      .combo-target:hover {
        transform: scale(1.1);
      }

      .combo-target.clicked {
        animation: clickExplode 0.3s ease;
      }

      @keyframes pulse {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.1);
        }
      }

      @keyframes clickExplode {
        0% {
          transform: scale(1);
          opacity: 1;
        }
        50% {
          transform: scale(1.5);
          opacity: 0.7;
        }
        100% {
          transform: scale(2);
          opacity: 0;
        }
      }

      .combo-multiplier {
        position: absolute;
        top: 20px;
        right: 20px;
        font-size: 3em;
        color: #f39c12;
        font-weight: bold;
        text-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
        transform: scale(1);
        transition: all 0.3s ease;
      }

      .combo-multiplier.active {
        transform: scale(1.3);
        color: #e74c3c;
      }

      .chain-indicator {
        position: absolute;
        top: 20px;
        left: 20px;
        color: #9b59b6;
        font-size: 2em;
        font-weight: bold;
        text-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
      }

      .power-up-bar {
        width: 100%;
        height: 15px;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 7px;
        margin: 15px 0;
        overflow: hidden;
      }

      .power-up-fill {
        height: 100%;
        background: linear-gradient(90deg, #e74c3c, #f39c12);
        border-radius: 7px;
        transition: width 0.3s ease;
        width: 0%;
      }

      .controls {
        display: flex;
        gap: 15px;
        justify-content: center;
        flex-wrap: wrap;
      }

      /* å¹«åŠ©æ¨¡æ…‹æ¡†æ¨£å¼ */
      .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        backdrop-filter: blur(10px);
        align-items: center;
        justify-content: center;
      }

      .modal-content {
        background: linear-gradient(135deg, #ff9a56 0%, #ff6b95 100%);
        padding: 30px;
        border-radius: 20px;
        max-width: 600px;
        max-height: 80vh;
        overflow-y: auto;
        color: white;
        position: relative;
        border: 2px solid rgba(255, 255, 255, 0.3);
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
      }

      .modal h2 {
        margin-bottom: 20px;
        text-align: center;
        font-size: 2em;
        text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
      }

      .modal h3 {
        margin: 20px 0 10px 0;
        color: #fff;
        font-size: 1.3em;
      }

      .modal p,
      .modal li {
        margin: 10px 0;
        line-height: 1.6;
        font-size: 1.1em;
      }

      .modal ul {
        margin-left: 20px;
      }

      .close-help {
        position: absolute;
        top: 15px;
        right: 20px;
        color: white;
        font-size: 28px;
        font-weight: bold;
        cursor: pointer;
        background: none;
        border: none;
        padding: 0;
        line-height: 1;
      }

      .close-help:hover {
        color: #ff6b6b;
        transform: scale(1.1);
      }

      @keyframes scoreFloat {
        0% {
          opacity: 1;
          transform: translateY(0) scale(1);
        }
        100% {
          opacity: 0;
          transform: translateY(-50px) scale(1.2);
        }
      }

      @media (max-width: 768px) {
        .game-container {
          width: 95vw;
          height: 95vh;
          padding: 20px;
        }

        h1 {
          font-size: 2em;
        }

        .game-stats {
          grid-template-columns: repeat(2, 1fr);
          font-size: 1em;
        }

        .combo-target {
          width: 45px;
          height: 45px;
        }

        .game-area {
          height: 350px;
        }
      }
    </style>
  </head>
  <body>
    <div class="game-container">
      <h1>âš¡ æ¥µé€Ÿé€£æ“Š</h1>

      <div class="game-stats">
        <div class="stat-box">åˆ†æ•¸: <span id="score">0</span></div>
        <div class="stat-box">é€£æ“Š: <span id="combo">0</span></div>
        <div class="stat-box">æ™‚é–“: <span id="timer">60</span></div>
        <div class="stat-box">æœ€é«˜é€£æ“Š: <span id="maxCombo">0</span></div>
      </div>

      <div class="power-up-bar">
        <div class="power-up-fill" id="powerUpFill"></div>
      </div>

      <div class="difficulty-select">
        <button class="btn difficulty-btn active" data-difficulty="normal">
          æ™®é€š
        </button>
        <button class="btn difficulty-btn" data-difficulty="hard">å›°é›£</button>
        <button class="btn difficulty-btn" data-difficulty="extreme">
          æ¥µé™
        </button>
      </div>

      <div class="status" id="status">
        æº–å‚™é€²è¡Œæ¥µé€Ÿé€£æ“ŠæŒ‘æˆ°ï¼é»æ“Šç›®æ¨™ç´¯ç©é€£æ“Šåˆ†æ•¸ï¼
      </div>

      <div class="game-area" id="gameArea">
        <div class="combo-multiplier" id="comboMultiplier">x1</div>
        <div class="chain-indicator" id="chainIndicator">âš¡0</div>
      </div>
      <div class="controls">
        <button class="btn" id="startBtn">é–‹å§‹éŠæˆ²</button>
        <button class="btn" id="pauseBtn" style="display: none">æš«åœ</button>
        <button class="btn" id="resetBtn">é‡æ–°é–‹å§‹</button>
        <button class="btn" id="helpBtn">éŠæˆ²èªªæ˜</button>
      </div>
    </div>

    <!-- å¹«åŠ©æ¨¡æ…‹æ¡† -->
    <div id="helpModal" class="modal">
      <div class="modal-content">
        <button class="close-help">&times;</button>
        <h2>âš¡ æ¥µé€Ÿé€£æ“Š - éŠæˆ²èªªæ˜</h2>

        <h3>ğŸ¯ éŠæˆ²ç›®æ¨™</h3>
        <p>
          å¿«é€Ÿé»æ“Šå‡ºç¾çš„ç›®æ¨™ï¼Œå»ºç«‹å¼·å¤§çš„é€£æ“Šçµ„åˆï¼æ¯æ¬¡æˆåŠŸæ“Šä¸­éƒ½æœƒå¢åŠ é€£æ“Šè¨ˆæ•¸ï¼Œé”åˆ°æ›´é«˜çš„åˆ†æ•¸ï¼
        </p>

        <h3>ğŸ® æ“ä½œæ–¹å¼</h3>
        <ul>
          <li><strong>é»æ“Šç›®æ¨™</strong>ï¼šç”¨æ»‘é¼ é»æ“Šè¢å¹•ä¸Šå‡ºç¾çš„å½©è‰²åœ“å½¢ç›®æ¨™</li>
          <li><strong>å¿«é€Ÿåæ‡‰</strong>ï¼šç›®æ¨™æœƒåœ¨çŸ­æ™‚é–“å…§æ¶ˆå¤±ï¼Œè¦å¿«é€Ÿé»æ“Š</li>
          <li><strong>é€£çºŒæ“Šä¸­</strong>ï¼šä¸è¦éŒ¯éä»»ä½•ç›®æ¨™ï¼Œä¿æŒé€£æ“Šä¸æ–·</li>
        </ul>

        <h3>ğŸ”´ ç›®æ¨™é¡å‹</h3>
        <ul>
          <li><strong>è—è‰²ç›®æ¨™</strong>ï¼šæ™®é€šç›®æ¨™ï¼Œæä¾›åŸºç¤åˆ†æ•¸</li>
          <li><strong>ç´…è‰²ç›®æ¨™</strong>ï¼šå¿«é€Ÿç›®æ¨™ï¼Œå‡ºç¾æ™‚é–“çŸ­ä½†åˆ†æ•¸é«˜</li>
          <li><strong>é‡‘è‰²ç›®æ¨™</strong>ï¼šé›™å€ç›®æ¨™ï¼Œæä¾›é›™å€åˆ†æ•¸çå‹µ</li>
          <li><strong>ç¶ è‰²ç›®æ¨™</strong>ï¼šé€£é–ç›®æ¨™ï¼Œå¯è§¸ç™¼é€£é–åæ‡‰</li>
        </ul>

        <h3>ğŸ“Š è¨ˆåˆ†ç³»çµ±</h3>
        <ul>
          <li><strong>åŸºç¤åˆ†æ•¸</strong>ï¼šæ¯å€‹ç›®æ¨™çš„åŸºæœ¬åˆ†æ•¸</li>
          <li><strong>é€£æ“Šçå‹µ</strong>ï¼šé€£æ“Šæ•¸è¶Šé«˜ï¼Œåˆ†æ•¸å€ç‡è¶Šå¤§</li>
          <li><strong>é€Ÿåº¦çå‹µ</strong>ï¼šåæ‡‰è¶Šå¿«ï¼Œç²å¾—é¡å¤–åˆ†æ•¸</li>
          <li><strong>ç‰¹æ®Šçå‹µ</strong>ï¼šæ“Šä¸­ç‰¹æ®Šç›®æ¨™ç²å¾—å¤§é‡åˆ†æ•¸</li>
        </ul>

        <h3>ğŸ’¡ éŠæˆ²æŠ€å·§</h3>
        <ul>
          <li>ä¿æŒå°ˆæ³¨ï¼Œå¿«é€Ÿè­˜åˆ¥ç›®æ¨™é¡å‹</li>
          <li>å„ªå…ˆæ“Šä¸­é«˜åƒ¹å€¼çš„ç‰¹æ®Šç›®æ¨™</li>
          <li>ç¶­æŒé€£æ“Šï¼Œé¿å…éŒ¯éç›®æ¨™</li>
          <li>ç·´ç¿’æ‰‹çœ¼å”èª¿å’Œåæ‡‰é€Ÿåº¦</li>
          <li>è§€å¯Ÿç›®æ¨™å‡ºç¾çš„æ¨¡å¼å’Œè¦å¾‹</li>
        </ul>
      </div>
    </div>

    <script>
      class ComboStorm {
        constructor() {
          this.gameArea = document.getElementById("gameArea");
          this.startBtn = document.getElementById("startBtn");
          this.pauseBtn = document.getElementById("pauseBtn");
          this.resetBtn = document.getElementById("resetBtn");
          this.status = document.getElementById("status");
          this.scoreEl = document.getElementById("score");
          this.comboEl = document.getElementById("combo");
          this.timerEl = document.getElementById("timer");
          this.maxComboEl = document.getElementById("maxCombo");
          this.comboMultiplier = document.getElementById("comboMultiplier");
          this.chainIndicator = document.getElementById("chainIndicator");
          this.powerUpFill = document.getElementById("powerUpFill");

          this.score = 0;
          this.combo = 0;
          this.maxCombo = 0;
          this.timeLeft = 60;
          this.gameActive = false;
          this.isPaused = false;
          this.difficulty = "normal";
          this.powerUpEnergy = 0;
          this.chainLevel = 0;
          this.multiplier = 1;

          this.timerInterval = null;
          this.spawnInterval = null;
          this.targets = [];

          this.difficulties = {
            normal: { spawnRate: 1500, targetLife: 3000, speed: 1 },
            hard: { spawnRate: 1200, targetLife: 2500, speed: 1.3 },
            extreme: { spawnRate: 900, targetLife: 2000, speed: 1.6 },
          };

          this.targetTypes = {
            normal: { score: 10, weight: 60 },
            fast: { score: 25, weight: 20 },
            double: { score: 20, weight: 15 },
            chain: { score: 30, weight: 5 },
          };

          this.initializeGame();
        }

        initializeGame() {
          this.startBtn.addEventListener("click", () => this.startGame());
          this.pauseBtn.addEventListener("click", () => this.pauseGame());
          this.resetBtn.addEventListener("click", () => this.resetGame());

          document.querySelectorAll(".difficulty-btn").forEach((btn) => {
            btn.addEventListener("click", (e) =>
              this.setDifficulty(e.target.dataset.difficulty)
            );
          });

          // å¹«åŠ©ç³»çµ±
          document
            .getElementById("helpBtn")
            .addEventListener("click", () => this.showHelp());

          this.updateDisplay();
        }

        setDifficulty(diff) {
          if (this.gameActive) return;

          this.difficulty = diff;
          document.querySelectorAll(".difficulty-btn").forEach((btn) => {
            btn.classList.remove("active");
          });
          document
            .querySelector(`[data-difficulty="${diff}"]`)
            .classList.add("active");
        }

        startGame() {
          this.gameActive = true;
          this.isPaused = false;
          this.score = 0;
          this.combo = 0;
          this.timeLeft = 60;
          this.powerUpEnergy = 0;
          this.chainLevel = 0;
          this.multiplier = 1;

          this.clearTargets();
          this.updateDisplay();
          this.startTimer();
          this.startSpawning();

          this.startBtn.style.display = "none";
          this.pauseBtn.style.display = "inline-block";
          this.status.textContent = "éŠæˆ²é–‹å§‹ï¼é»æ“Šç›®æ¨™ç²å¾—åˆ†æ•¸ï¼";
        }

        startTimer() {
          this.timerInterval = setInterval(() => {
            if (!this.isPaused) {
              this.timeLeft--;
              this.updateDisplay();

              if (this.timeLeft <= 0) {
                this.endGame();
              }
            }
          }, 1000);
        }

        startSpawning() {
          const config = this.difficulties[this.difficulty];

          this.spawnInterval = setInterval(() => {
            if (!this.isPaused && this.gameActive) {
              this.spawnTarget();
            }
          }, config.spawnRate);
        }

        spawnTarget() {
          const type = this.getRandomTargetType();
          const config = this.difficulties[this.difficulty];

          const target = {
            id: Date.now() + Math.random(),
            type: type,
            x: Math.random() * (this.gameArea.offsetWidth - 60),
            y: Math.random() * (this.gameArea.offsetHeight - 120) + 60,
            life: config.targetLife,
            element: null,
          };

          this.createTargetElement(target);
          this.targets.push(target);

          // è¨­ç½®ç›®æ¨™ç”Ÿå‘½é€±æœŸ
          setTimeout(() => {
            this.removeTarget(target.id);
            if (this.gameActive) {
              this.combo = 0;
              this.multiplier = 1;
              this.updateDisplay();
            }
          }, target.life);
        }

        getRandomTargetType() {
          const rand = Math.random() * 100;
          let cumulative = 0;

          for (const [type, data] of Object.entries(this.targetTypes)) {
            cumulative += data.weight;
            if (rand <= cumulative) {
              return type;
            }
          }
          return "normal";
        }

        createTargetElement(target) {
          const element = document.createElement("div");
          element.className = `combo-target type-${target.type}`;
          element.style.left = target.x + "px";
          element.style.top = target.y + "px";
          element.dataset.id = target.id;

          // è¨­ç½®ç›®æ¨™å…§å®¹
          switch (target.type) {
            case "normal":
              element.textContent = "â—";
              break;
            case "fast":
              element.textContent = "âš¡";
              break;
            case "double":
              element.textContent = "Ã—2";
              break;
            case "chain":
              element.textContent = "âš¡âš¡";
              break;
          }

          element.addEventListener("click", () => this.hitTarget(target));
          target.element = element;
          this.gameArea.appendChild(element);
        }

        hitTarget(target) {
          if (!this.gameActive || this.isPaused) return;

          const baseScore = this.targetTypes[target.type].score;
          let earnedScore = baseScore;

          // è¨ˆç®—é€£æ“ŠåŠ æˆ
          this.combo++;
          this.multiplier = Math.min(Math.floor(this.combo / 5) + 1, 10);
          earnedScore = Math.floor(baseScore * this.multiplier);

          // ç‰¹æ®Šç›®æ¨™æ•ˆæœ
          switch (target.type) {
            case "double":
              earnedScore *= 2;
              break;
            case "chain":
              this.chainLevel++;
              this.powerUpEnergy = Math.min(this.powerUpEnergy + 20, 100);
              break;
            case "fast":
              this.powerUpEnergy = Math.min(this.powerUpEnergy + 10, 100);
              break;
          }

          this.score += earnedScore;
          this.maxCombo = Math.max(this.maxCombo, this.combo);

          // é¡¯ç¤ºåˆ†æ•¸å½ˆå‡º
          this.showScorePopup(target.x, target.y, earnedScore);

          // ç›®æ¨™é»æ“Šå‹•ç•«
          target.element.classList.add("clicked");
          setTimeout(() => this.removeTarget(target.id), 300);

          // æª¢æŸ¥å¼·åŒ–æ¨¡å¼
          if (this.powerUpEnergy >= 100) {
            this.activatePowerUp();
          }

          this.updateDisplay();
        }

        activatePowerUp() {
          this.powerUpEnergy = 0;
          this.status.textContent = "ğŸ”¥ å¼·åŒ–æ¨¡å¼å•Ÿå‹•ï¼é›™å€åˆ†æ•¸æŒçºŒ 5 ç§’ï¼";

          // è‡¨æ™‚æå‡åˆ†æ•¸å€ç‡
          const originalMultiplier = this.multiplier;
          this.multiplier *= 2;

          setTimeout(() => {
            this.multiplier = originalMultiplier;
            this.status.textContent = "ç¹¼çºŒé€£æ“Šç²å¾—æ›´é«˜åˆ†æ•¸ï¼";
          }, 5000);
        }

        showScorePopup(x, y, score) {
          const popup = document.createElement("div");
          popup.className = "score-popup";
          popup.textContent = `+${score}`;
          popup.style.left = x + "px";
          popup.style.top = y + "px";

          this.gameArea.appendChild(popup);

          setTimeout(() => {
            if (popup.parentNode) {
              popup.parentNode.removeChild(popup);
            }
          }, 1000);
        }

        removeTarget(targetId) {
          const index = this.targets.findIndex((t) => t.id === targetId);
          if (index !== -1) {
            const target = this.targets[index];
            if (target.element && target.element.parentNode) {
              target.element.parentNode.removeChild(target.element);
            }
            this.targets.splice(index, 1);
          }
        }

        clearTargets() {
          this.targets.forEach((target) => {
            if (target.element && target.element.parentNode) {
              target.element.parentNode.removeChild(target.element);
            }
          });
          this.targets = [];
        }

        updateDisplay() {
          this.scoreEl.textContent = this.score;
          this.comboEl.textContent = this.combo;
          this.timerEl.textContent = this.timeLeft;
          this.maxComboEl.textContent = this.maxCombo;
          this.comboMultiplier.textContent = `x${this.multiplier}`;
          this.chainIndicator.textContent = `âš¡${this.chainLevel}`;
          this.powerUpFill.style.width = this.powerUpEnergy + "%";

          // é€£æ“Šå€ç‡è¦–è¦ºæ•ˆæœ
          if (this.combo > 0 && this.combo % 5 === 0) {
            this.comboMultiplier.classList.add("active");
            setTimeout(() => {
              this.comboMultiplier.classList.remove("active");
            }, 500);
          }
        }

        pauseGame() {
          if (this.gameActive) {
            this.isPaused = !this.isPaused;
            this.pauseBtn.textContent = this.isPaused ? "ç¹¼çºŒ" : "æš«åœ";
            this.status.textContent = this.isPaused ? "éŠæˆ²å·²æš«åœ" : "éŠæˆ²ç¹¼çºŒ";
          }
        }

        endGame() {
          this.gameActive = false;
          clearInterval(this.timerInterval);
          clearInterval(this.spawnInterval);
          this.clearTargets();

          this.status.textContent = `ğŸ‰ éŠæˆ²çµæŸï¼æœ€çµ‚åˆ†æ•¸: ${this.score} | æœ€é«˜é€£æ“Š: ${this.maxCombo}`;
          this.startBtn.style.display = "inline-block";
          this.pauseBtn.style.display = "none";
        }

        resetGame() {
          this.gameActive = false;
          this.isPaused = false;
          clearInterval(this.timerInterval);
          clearInterval(this.spawnInterval);

          this.score = 0;
          this.combo = 0;
          this.maxCombo = 0;
          this.timeLeft = 60;
          this.powerUpEnergy = 0;
          this.chainLevel = 0;
          this.multiplier = 1;

          this.clearTargets();
          this.updateDisplay();

          this.status.textContent =
            "æº–å‚™é€²è¡Œæ¥µé€Ÿé€£æ“ŠæŒ‘æˆ°ï¼é»æ“Šç›®æ¨™ç´¯ç©é€£æ“Šåˆ†æ•¸ï¼";
          this.startBtn.style.display = "inline-block";
          this.pauseBtn.style.display = "none";
        }

        showHelp() {
          document.getElementById("helpModal").style.display = "flex";

          // ç‚ºé—œé–‰æŒ‰éˆ•æ·»åŠ äº‹ä»¶ç›£è½å™¨
          const closeBtn = document.querySelector("#helpModal .close-help");
          if (closeBtn) {
            closeBtn.onclick = () => this.closeHelp();
          }

          // é»æ“Šæ¨¡æ…‹æ¡†èƒŒæ™¯é—œé–‰
          const modal = document.getElementById("helpModal");
          modal.onclick = (e) => {
            if (e.target === modal) {
              this.closeHelp();
            }
          };

          // ESCéµé—œé–‰
          const handleEsc = (e) => {
            if (e.key === "Escape") {
              this.closeHelp();
              document.removeEventListener("keydown", handleEsc);
            }
          };
          document.addEventListener("keydown", handleEsc);
        }

        closeHelp() {
          document.getElementById("helpModal").style.display = "none";
        }
      }

      // åˆå§‹åŒ–éŠæˆ²
      window.addEventListener("load", () => {
        new ComboStorm();
      });
    </script>
  </body>
</html>
