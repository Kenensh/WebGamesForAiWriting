<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>å½©è‰²è¡åˆº - Color Rush</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
    />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Noto Sans TC", sans-serif;
        background: linear-gradient(
          45deg,
          #ff6b6b,
          #4ecdc4,
          #45b7d1,
          #96ceb4,
          #feca57,
          #ff9ff3
        );
        background-size: 400% 400%;
        animation: gradientShift 8s ease infinite;
        min-height: 100vh;
        overflow: hidden;
        position: relative;
      }

      @keyframes gradientShift {
        0% {
          background-position: 0% 50%;
        }
        50% {
          background-position: 100% 50%;
        }
        100% {
          background-position: 0% 50%;
        }
      }

      .rainbow-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: radial-gradient(
            circle at 20% 30%,
            rgba(255, 0, 150, 0.2) 10%,
            transparent 20%
          ),
          radial-gradient(
            circle at 80% 70%,
            rgba(0, 255, 150, 0.2) 10%,
            transparent 20%
          ),
          radial-gradient(
            circle at 40% 80%,
            rgba(150, 0, 255, 0.2) 10%,
            transparent 20%
          );
        z-index: -1;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
        height: 100vh;
        display: flex;
        flex-direction: column;
        position: relative;
        z-index: 1;
      }

      .header {
        text-align: center;
        margin-bottom: 20px;
      }

      .title {
        font-size: 2.5rem;
        background: linear-gradient(45deg, #ff0080, #00ff80, #8000ff, #ff8000);
        background-clip: text;
        -webkit-background-clip: text;
        color: transparent;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        margin-bottom: 10px;
        font-weight: 700;
        animation: rainbowText 3s ease-in-out infinite;
      }

      @keyframes rainbowText {
        0%,
        100% {
          filter: hue-rotate(0deg);
        }
        25% {
          filter: hue-rotate(90deg);
        }
        50% {
          filter: hue-rotate(180deg);
        }
        75% {
          filter: hue-rotate(270deg);
        }
      }

      .subtitle {
        font-size: 1.2rem;
        color: #ffffff;
        margin-bottom: 20px;
        text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
      }

      .controls {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        flex-wrap: wrap;
        gap: 15px;
      }

      .score-info {
        display: flex;
        gap: 20px;
        align-items: center;
      }

      .score-item {
        background: rgba(255, 255, 255, 0.2);
        padding: 8px 16px;
        border-radius: 25px;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.3);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      }

      .score-label {
        font-size: 0.9rem;
        color: #ffffff;
        font-weight: 500;
      }

      .score-value {
        font-size: 1.1rem;
        color: #ffffff;
        font-weight: 700;
        text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
      }

      .action-buttons {
        display: flex;
        gap: 10px;
      }

      .btn {
        padding: 10px 20px;
        border: none;
        border-radius: 25px;
        cursor: pointer;
        font-family: inherit;
        font-weight: 500;
        font-size: 0.9rem;
        transition: all 0.3s ease;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 8px;
      }

      .btn-primary {
        background: linear-gradient(135deg, #ff0080, #8000ff);
        color: white;
        box-shadow: 0 4px 15px rgba(255, 0, 128, 0.3);
      }

      .btn-secondary {
        background: rgba(255, 255, 255, 0.2);
        color: #ffffff;
        border: 1px solid rgba(255, 255, 255, 0.3);
        backdrop-filter: blur(10px);
      }

      .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
      }

      .game-area {
        flex: 1;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 15px;
        padding: 20px;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        position: relative;
        overflow: hidden;
        display: flex;
        flex-direction: column;
      }

      .game-display {
        flex: 1;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        position: relative;
      }

      .target-color {
        width: 200px;
        height: 200px;
        border-radius: 50%;
        margin-bottom: 30px;
        border: 8px solid rgba(255, 255, 255, 0.5);
        box-shadow: 0 0 30px rgba(0, 0, 0, 0.3);
        position: relative;
        animation: pulse 2s ease-in-out infinite;
      }

      @keyframes pulse {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.05);
        }
      }

      .target-label {
        font-size: 1.5rem;
        color: #ffffff;
        margin-bottom: 20px;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        font-weight: 600;
        text-align: center;
      }

      .color-options {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
        gap: 15px;
        max-width: 400px;
        width: 100%;
      }

      .color-button {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        border: 4px solid rgba(255, 255, 255, 0.3);
        cursor: pointer;
        transition: all 0.3s ease;
        position: relative;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
      }

      .color-button:hover {
        transform: scale(1.1);
        border-color: rgba(255, 255, 255, 0.8);
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
      }

      .color-button.correct {
        animation: correctAnswer 0.5s ease;
      }

      .color-button.wrong {
        animation: wrongAnswer 0.5s ease;
      }

      @keyframes correctAnswer {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.2);
          border-color: #00ff00;
          box-shadow: 0 0 30px #00ff00;
        }
      }

      @keyframes wrongAnswer {
        0%,
        100% {
          transform: scale(1);
        }
        25%,
        75% {
          transform: scale(0.9) rotate(-5deg);
        }
        50% {
          transform: scale(0.9) rotate(5deg);
          border-color: #ff0000;
        }
      }

      .time-bar {
        width: 100%;
        height: 20px;
        background: rgba(0, 0, 0, 0.3);
        border-radius: 10px;
        margin-top: 30px;
        overflow: hidden;
        border: 2px solid rgba(255, 255, 255, 0.3);
      }

      .time-fill {
        height: 100%;
        background: linear-gradient(90deg, #00ff00, #ffff00, #ff8000, #ff0000);
        transition: width 0.1s linear;
        border-radius: 8px;
      }

      .streak-display {
        position: absolute;
        top: 20px;
        right: 20px;
        background: rgba(255, 215, 0, 0.2);
        padding: 10px 15px;
        border-radius: 15px;
        border: 2px solid rgba(255, 215, 0, 0.5);
        color: #ffffff;
        font-weight: 600;
        font-size: 1.1rem;
        text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
      }

      .level-display {
        position: absolute;
        top: 20px;
        left: 20px;
        background: rgba(138, 43, 226, 0.2);
        padding: 10px 15px;
        border-radius: 15px;
        border: 2px solid rgba(138, 43, 226, 0.5);
        color: #ffffff;
        font-weight: 600;
        font-size: 1.1rem;
        text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
      }

      .game-overlay {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        text-align: center;
        color: #ffffff;
        font-size: 2.5rem;
        font-weight: 700;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
        z-index: 10;
        background: rgba(0, 0, 0, 0.5);
        padding: 30px;
        border-radius: 15px;
        backdrop-filter: blur(10px);
      }

      .instructions {
        position: absolute;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(0, 0, 0, 0.7);
        padding: 15px 20px;
        border-radius: 10px;
        max-width: 400px;
        font-size: 0.9rem;
        color: #ffffff;
        text-align: center;
        border: 1px solid rgba(255, 255, 255, 0.3);
      }

      .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.8);
        animation: fadeIn 0.3s ease;
      }

      .modal-content {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        margin: 5% auto;
        padding: 30px;
        border-radius: 15px;
        width: 90%;
        max-width: 500px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        position: relative;
        color: #ffffff;
      }

      .close {
        color: #ffffff;
        float: right;
        font-size: 28px;
        font-weight: bold;
        cursor: pointer;
        line-height: 1;
      }

      .close:hover {
        color: #ff6b6b;
        text-shadow: 0 0 10px rgba(255, 107, 107, 0.8);
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }

      @media (max-width: 768px) {
        .title {
          font-size: 2rem;
        }

        .controls {
          flex-direction: column;
          align-items: center;
        }

        .target-color {
          width: 150px;
          height: 150px;
        }

        .color-button {
          width: 60px;
          height: 60px;
        }

        .color-options {
          grid-template-columns: repeat(3, 1fr);
          max-width: 250px;
        }

        .instructions {
          position: static;
          margin-top: 20px;
          transform: none;
        }
      }
    </style>
  </head>
  <body>
    <div class="rainbow-overlay"></div>

    <div class="container">
      <div class="header">
        <h1 class="title">ğŸŒˆ å½©è‰²è¡åˆº</h1>
        <p class="subtitle">å¿«é€Ÿè¾¨è­˜é¡è‰²ï¼ŒæŒ‘æˆ°ä½ çš„åæ‡‰æ¥µé™ï¼</p>
      </div>

      <div class="controls">
        <div class="score-info">
          <div class="score-item">
            <div class="score-label">å¾—åˆ†</div>
            <div class="score-value" id="score">0</div>
          </div>
          <div class="score-item">
            <div class="score-label">æœ€é«˜åˆ†</div>
            <div class="score-value" id="highScore">0</div>
          </div>
          <div class="score-item">
            <div class="score-label">æ­£ç¢ºç‡</div>
            <div class="score-value" id="accuracy">100%</div>
          </div>
        </div>

        <div class="action-buttons">
          <button class="btn btn-secondary" onclick="showInstructions()">
            <i class="fas fa-question-circle"></i> èªªæ˜
          </button>
          <button class="btn btn-primary" onclick="startGame()">
            <i class="fas fa-play"></i> é–‹å§‹éŠæˆ²
          </button>
          <button class="btn btn-secondary" onclick="pauseGame()">
            <i class="fas fa-pause"></i> æš«åœ
          </button>
          <a href="index.html" class="btn btn-secondary">
            <i class="fas fa-arrow-left"></i> è¿”å›
          </a>
        </div>
      </div>

      <div class="game-area">
        <div class="level-display" id="levelDisplay">ç­‰ç´š 1</div>
        <div class="streak-display" id="streakDisplay">é€£æ“Š 0</div>

        <div class="game-display" id="gameDisplay">
          <div class="target-label" id="targetLabel">é»æ“Šé–‹å§‹éŠæˆ²</div>
          <div class="target-color" id="targetColor"></div>
          <div class="color-options" id="colorOptions"></div>
          <div class="time-bar">
            <div class="time-fill" id="timeFill" style="width: 100%"></div>
          </div>
        </div>

        <div class="game-overlay" id="gameOverlay" style="display: none">
          <div id="overlayText">æº–å‚™é–‹å§‹...</div>
        </div>

        <div class="instructions">
          <strong>æ“ä½œèªªæ˜ï¼š</strong>
          å¿«é€Ÿé»æ“Šèˆ‡ç›®æ¨™é¡è‰²ç›¸åŒçš„é¸é … â€¢ æ™‚é–“æœ‰é™ï¼Œé€Ÿåº¦è¶Šå¿«åˆ†æ•¸è¶Šé«˜
        </div>
      </div>
    </div>

    <!-- èªªæ˜æ¨¡æ…‹æ¡† -->
    <div id="instructionModal" class="modal">
      <div class="modal-content">
        <span class="close">&times;</span>
        <h2>ğŸŒˆ å½©è‰²è¡åˆº - éŠæˆ²èªªæ˜</h2>
        <br />
        <h3>ğŸ¯ éŠæˆ²ç›®æ¨™</h3>
        <p>
          åœ¨æ™‚é–“é™åˆ¶å…§ï¼Œå¿«é€Ÿè¾¨è­˜ä¸¦é»æ“Šèˆ‡ç›®æ¨™é¡è‰²ç›¸åŒçš„é¸é …ï¼ŒæŒ‘æˆ°ä½ çš„è¦–è¦ºåæ‡‰é€Ÿåº¦ï¼
        </p>
        <br />
        <h3>ğŸ® æ“ä½œæ–¹å¼</h3>
        <ul>
          <li><strong>è§€å¯Ÿç›®æ¨™ï¼š</strong>æ³¨æ„ç•«é¢ä¸­å¤®çš„ç›®æ¨™é¡è‰²</li>
          <li><strong>å¿«é€Ÿé¸æ“‡ï¼š</strong>é»æ“Šä¸‹æ–¹èˆ‡ç›®æ¨™ç›¸åŒçš„é¡è‰²æŒ‰éˆ•</li>
          <li><strong>æ™‚é–“ç«¶è³½ï¼š</strong>åœ¨æ™‚é–“æ¢æ­¸é›¶å‰å®Œæˆé¸æ“‡</li>
          <li><strong>é€£çºŒæŒ‘æˆ°ï¼š</strong>æ­£ç¢ºç­”æ¡ˆå¾Œç«‹å³é€²å…¥ä¸‹ä¸€é¡Œ</li>
        </ul>
        <br />
        <h3>ğŸ† è¨ˆåˆ†æ–¹å¼</h3>
        <ul>
          <li><strong>åŸºç¤åˆ†æ•¸ï¼š</strong>æ­£ç¢ºé¸æ“‡ç²å¾— 10 åˆ†</li>
          <li><strong>é€Ÿåº¦åŠ æˆï¼š</strong>å‰©é¤˜æ™‚é–“è¶Šå¤šï¼ŒåŠ åˆ†è¶Šå¤š</li>
          <li><strong>é€£æ“Šçå‹µï¼š</strong>é€£çºŒæ­£ç¢ºå¯ç²å¾—é¡å¤–åŠ æˆ</li>
          <li><strong>ç­‰ç´šæå‡ï¼š</strong>æ¯10é¡Œæ­£ç¢ºå¾Œç­‰ç´šæå‡ï¼Œåˆ†æ•¸å€å¢</li>
        </ul>
        <br />
        <h3>ğŸ¨ éŠæˆ²ç‰¹è‰²</h3>
        <ul>
          <li>æ¼¸é€²å¼é›£åº¦ï¼šéš¨ç­‰ç´šæå‡é¡è‰²ç›¸ä¼¼åº¦å¢åŠ </li>
          <li>å¤šç¨®é¡è‰²ï¼šåŒ…å«åŸºæœ¬è‰²å½©å’Œè¤‡é›œæ··åˆè‰²</li>
          <li>è¦–è¦ºæ•ˆæœï¼šè±å¯Œçš„å‹•ç•«å’Œç²’å­ç‰¹æ•ˆ</li>
          <li>çµ±è¨ˆè¿½è¹¤ï¼šè¨˜éŒ„æœ€é«˜åˆ†å’Œæ­£ç¢ºç‡</li>
        </ul>
        <br />
        <h3>âš¡ æŒ‘æˆ°æ¨¡å¼</h3>
        <ul>
          <li><strong>ç­‰ç´š1-2ï¼š</strong>4å€‹é¸é …ï¼ŒåŸºæœ¬é¡è‰²</li>
          <li><strong>ç­‰ç´š3-4ï¼š</strong>6å€‹é¸é …ï¼Œç›¸ä¼¼é¡è‰²</li>
          <li><strong>ç­‰ç´š5+ï¼š</strong>8å€‹é¸é …ï¼Œæ¥µé›£è¾¨è­˜</li>
        </ul>
        <br />
        <p><strong>æº–å‚™å¥½è¿æ¥å½©è‰²é¢¨æš´äº†å—ï¼ŸğŸŒˆ</strong></p>
      </div>
    </div>

    <script src="gameUtils.js"></script>
    <script>
      class ColorRushGame {
        constructor() {
          this.gameState = "waiting"; // waiting, playing, paused, gameOver
          this.score = 0;
          this.highScore = parseInt(
            localStorage.getItem("colorRush-highScore") || "0"
          );
          this.level = 1;
          this.streak = 0;
          this.totalAnswers = 0;
          this.correctAnswers = 0;
          this.timeLeft = 5000; // 5ç§’
          this.maxTime = 5000;

          this.currentTargetColor = null;
          this.colorOptions = [];
          this.gameTimer = null;
          this.countdownTimer = null;

          // é¡è‰²å®šç¾©
          this.colors = {
            basic: [
              { name: "ç´…è‰²", hex: "#FF0000" },
              { name: "è—è‰²", hex: "#0000FF" },
              { name: "ç¶ è‰²", hex: "#00FF00" },
              { name: "é»ƒè‰²", hex: "#FFFF00" },
              { name: "ç´«è‰²", hex: "#800080" },
              { name: "æ©™è‰²", hex: "#FFA500" },
              { name: "ç²‰è‰²", hex: "#FF69B4" },
              { name: "é’è‰²", hex: "#00FFFF" },
            ],
            intermediate: [
              { name: "æ·±ç´…", hex: "#8B0000" },
              { name: "æ·±è—", hex: "#000080" },
              { name: "æ·±ç¶ ", hex: "#006400" },
              { name: "é‡‘è‰²", hex: "#FFD700" },
              { name: "ç´«ç¾…è˜­", hex: "#8A2BE2" },
              { name: "æ·±æ©™", hex: "#FF8C00" },
              { name: "ç«ç‘°", hex: "#FF1493" },
              { name: "å¤©è—", hex: "#87CEEB" },
              { name: "çŸ³ç°", hex: "#32CD32" },
              { name: "çŠç‘š", hex: "#FF7F50" },
            ],
            advanced: [
              { name: "æš—ç´…", hex: "#A52A2A" },
              { name: "çš‡è—", hex: "#4169E1" },
              { name: "æ£®ç¶ ", hex: "#228B22" },
              { name: "æª¸æª¬", hex: "#FFFACD" },
              { name: "æ¢…è‰²", hex: "#DDA0DD" },
              { name: "æ©˜ç´…", hex: "#FF4500" },
              { name: "è˜­èŠ±", hex: "#DA70D6" },
              { name: "é‹¼è—", hex: "#4682B4" },
              { name: "æ©„æ¬–", hex: "#808000" },
              { name: "èŒ¶è‰²", hex: "#D2691E" },
              { name: "é›è‰²", hex: "#4B0082" },
              { name: "æ —è‰²", hex: "#800000" },
            ],
          };

          this.bindEvents();
          this.updateDisplay();
        }

        bindEvents() {
          // éµç›¤äº‹ä»¶
          document.addEventListener("keydown", (e) => {
            if (e.key === "Escape") {
              this.pauseGame();
            }
          });

          // èªªæ˜æ¨¡æ…‹æ¡†
          const modal = document.getElementById("instructionModal");
          const closeBtn = modal.querySelector(".close");

          closeBtn.onclick = () => (modal.style.display = "none");
          window.onclick = (e) => {
            if (e.target === modal) modal.style.display = "none";
          };
        }

        startGame() {
          if (this.gameState === "waiting" || this.gameState === "gameOver") {
            this.resetGame();
          }

          this.gameState = "playing";
          document.getElementById("gameOverlay").style.display = "none";
          this.generateRound();
        }

        pauseGame() {
          if (this.gameState === "playing") {
            this.gameState = "paused";
            this.stopTimers();
            document.getElementById("gameOverlay").style.display = "block";
            document.getElementById("overlayText").textContent = "éŠæˆ²æš«åœ";
          } else if (this.gameState === "paused") {
            this.gameState = "playing";
            document.getElementById("gameOverlay").style.display = "none";
            this.startRoundTimer();
          }
        }

        resetGame() {
          this.score = 0;
          this.level = 1;
          this.streak = 0;
          this.totalAnswers = 0;
          this.correctAnswers = 0;
          this.timeLeft = this.maxTime;
          this.stopTimers();
          this.updateDisplay();
        }

        generateRound() {
          // æ ¹æ“šç­‰ç´šé¸æ“‡é¡è‰²æ± 
          let colorPool = this.colors.basic;
          let optionCount = 4;

          if (this.level >= 5) {
            colorPool = this.colors.advanced;
            optionCount = 8;
          } else if (this.level >= 3) {
            colorPool = this.colors.intermediate;
            optionCount = 6;
          }

          // é¸æ“‡ç›®æ¨™é¡è‰²
          this.currentTargetColor =
            colorPool[Math.floor(Math.random() * colorPool.length)];

          // ç”Ÿæˆé¸é …ï¼ˆåŒ…å«æ­£ç¢ºç­”æ¡ˆï¼‰
          this.colorOptions = [this.currentTargetColor];

          // æ·»åŠ å¹²æ“¾é¸é …
          while (this.colorOptions.length < optionCount) {
            const randomColor =
              colorPool[Math.floor(Math.random() * colorPool.length)];
            if (!this.colorOptions.find((c) => c.hex === randomColor.hex)) {
              this.colorOptions.push(randomColor);
            }
          }

          // éš¨æ©Ÿæ’åˆ—é¸é …
          this.colorOptions = this.shuffleArray(this.colorOptions);

          // æ›´æ–°UI
          this.updateGameDisplay();

          // é‡ç½®ä¸¦é–‹å§‹è¨ˆæ™‚
          this.timeLeft = this.maxTime - (this.level - 1) * 200; // éš¨ç­‰ç´šæ¸›å°‘æ™‚é–“
          this.timeLeft = Math.max(2000, this.timeLeft); // æœ€å°‘2ç§’
          this.startRoundTimer();
        }

        updateGameDisplay() {
          // æ›´æ–°ç›®æ¨™é¡è‰²é¡¯ç¤º
          const targetColor = document.getElementById("targetColor");
          const targetLabel = document.getElementById("targetLabel");

          targetColor.style.background = this.currentTargetColor.hex;
          targetLabel.textContent = `æ‰¾å‡ºé€™å€‹é¡è‰²ï¼š${this.currentTargetColor.name}`;

          // æ›´æ–°é¸é …æŒ‰éˆ•
          const colorOptions = document.getElementById("colorOptions");
          colorOptions.innerHTML = "";

          this.colorOptions.forEach((color, index) => {
            const button = document.createElement("div");
            button.className = "color-button";
            button.style.background = color.hex;
            button.onclick = () => this.selectColor(color, button);
            colorOptions.appendChild(button);
          });
        }

        selectColor(selectedColor, buttonElement) {
          if (this.gameState !== "playing") return;

          this.stopTimers();
          this.totalAnswers++;

          if (selectedColor.hex === this.currentTargetColor.hex) {
            // æ­£ç¢ºç­”æ¡ˆ
            this.correctAnswers++;
            this.streak++;

            // è¨ˆç®—åˆ†æ•¸
            let points = 10;
            points += Math.floor(this.timeLeft / 100); // æ™‚é–“åŠ æˆ
            points += this.streak * 2; // é€£æ“ŠåŠ æˆ
            points *= this.level; // ç­‰ç´šå€æ•¸

            this.score += points;

            // è¦–è¦ºæ•ˆæœ
            buttonElement.classList.add("correct");
            this.createColorParticles(buttonElement, selectedColor.hex);

            // æª¢æŸ¥å‡ç´š
            if (this.correctAnswers % 10 === 0) {
              this.level++;
              this.showLevelUp();
            }

            // ä¸‹ä¸€è¼ª
            setTimeout(() => {
              if (this.gameState === "playing") {
                this.generateRound();
              }
            }, 800);
          } else {
            // éŒ¯èª¤ç­”æ¡ˆ
            this.streak = 0;
            buttonElement.classList.add("wrong");

            // é¡¯ç¤ºæ­£ç¢ºç­”æ¡ˆ
            const buttons = document.querySelectorAll(".color-button");
            buttons.forEach((btn) => {
              if (btn.style.background === this.currentTargetColor.hex) {
                btn.classList.add("correct");
              }
            });

            setTimeout(() => {
              this.gameOver();
            }, 1500);
          }

          this.updateDisplay();
        }

        startRoundTimer() {
          this.gameTimer = setInterval(() => {
            this.timeLeft -= 50;
            this.updateTimeBar();

            if (this.timeLeft <= 0) {
              this.timeUp();
            }
          }, 50);
        }

        stopTimers() {
          if (this.gameTimer) {
            clearInterval(this.gameTimer);
            this.gameTimer = null;
          }
          if (this.countdownTimer) {
            clearTimeout(this.countdownTimer);
            this.countdownTimer = null;
          }
        }

        updateTimeBar() {
          const timeFill = document.getElementById("timeFill");
          const percentage =
            (this.timeLeft / (this.maxTime - (this.level - 1) * 200)) * 100;
          timeFill.style.width = Math.max(0, percentage) + "%";
        }

        timeUp() {
          this.stopTimers();
          this.totalAnswers++;
          this.streak = 0;
          this.gameOver();
        }

        showLevelUp() {
          const overlay = document.getElementById("gameOverlay");
          const overlayText = document.getElementById("overlayText");

          overlay.style.display = "block";
          overlayText.innerHTML = `ğŸ‰<br>ç­‰ç´šæå‡ï¼<br>ç­‰ç´š ${this.level}`;

          setTimeout(() => {
            overlay.style.display = "none";
          }, 2000);
        }

        gameOver() {
          this.gameState = "gameOver";
          this.stopTimers();

          // æ›´æ–°æœ€é«˜åˆ†
          if (this.score > this.highScore) {
            this.highScore = this.score;
            localStorage.setItem(
              "colorRush-highScore",
              this.highScore.toString()
            );
          }

          // é¡¯ç¤ºçµæœ
          const overlay = document.getElementById("gameOverlay");
          const overlayText = document.getElementById("overlayText");

          overlay.style.display = "block";
          overlayText.innerHTML = `
                    éŠæˆ²çµæŸï¼<br>
                    <span style="font-size: 1.5rem;">å¾—åˆ†: ${this.score}</span><br>
                    ç­‰ç´š: ${this.level} | é€£æ“Š: ${this.streak}<br>
                    <span style="font-size: 1rem; margin-top: 10px; display: block;">é»æ“Šé‡æ–°é–‹å§‹</span>
                `;

          // ä¿å­˜éŠæˆ²æ•¸æ“š
          if (typeof saveGameData === "function") {
            saveGameData("color-rush", { score: this.score });
          }

          this.updateDisplay();
        }

        createColorParticles(element, color) {
          const rect = element.getBoundingClientRect();
          const centerX = rect.left + rect.width / 2;
          const centerY = rect.top + rect.height / 2;

          for (let i = 0; i < 8; i++) {
            const particle = document.createElement("div");
            particle.style.position = "fixed";
            particle.style.left = centerX + "px";
            particle.style.top = centerY + "px";
            particle.style.width = "8px";
            particle.style.height = "8px";
            particle.style.background = color;
            particle.style.borderRadius = "50%";
            particle.style.pointerEvents = "none";
            particle.style.zIndex = "1000";

            const angle = (i / 8) * Math.PI * 2;
            const velocity = 3;
            const vx = Math.cos(angle) * velocity;
            const vy = Math.sin(angle) * velocity;

            document.body.appendChild(particle);

            let x = 0,
              y = 0,
              opacity = 1;
            const animate = () => {
              x += vx;
              y += vy;
              opacity -= 0.02;

              particle.style.transform = `translate(${x}px, ${y}px)`;
              particle.style.opacity = opacity;

              if (opacity > 0) {
                requestAnimationFrame(animate);
              } else {
                particle.remove();
              }
            };

            requestAnimationFrame(animate);
          }
        }

        shuffleArray(array) {
          const newArray = [...array];
          for (let i = newArray.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
          }
          return newArray;
        }

        updateDisplay() {
          document.getElementById("score").textContent = this.score;
          document.getElementById("highScore").textContent = this.highScore;
          document.getElementById(
            "levelDisplay"
          ).textContent = `ç­‰ç´š ${this.level}`;
          document.getElementById(
            "streakDisplay"
          ).textContent = `é€£æ“Š ${this.streak}`;

          const accuracy =
            this.totalAnswers > 0
              ? Math.round((this.correctAnswers / this.totalAnswers) * 100)
              : 100;
          document.getElementById("accuracy").textContent = accuracy + "%";
        }
      }

      // åˆå§‹åŒ–éŠæˆ²
      let game;

      function initGame() {
        game = new ColorRushGame();
      }

      function startGame() {
        if (game) {
          game.startGame();
        }
      }

      function pauseGame() {
        if (game) {
          game.pauseGame();
        }
      }

      function showInstructions() {
        document.getElementById("instructionModal").style.display = "block";
      }

      // ç•¶é é¢è¼‰å…¥å®Œæˆæ™‚åˆå§‹åŒ–éŠæˆ²
      window.addEventListener("load", initGame);

      // éŠæˆ²å·¥å…·å‡½æ•¸
      if (typeof initializeGameUtils === "function") {
        initializeGameUtils("color-rush");
      }
    </script>
  </body>
</html>
